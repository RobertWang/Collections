> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [post.m.smzdm.com](https://post.m.smzdm.com/p/allenvxg/?send_by=3547620770&invite_code=zdm4ptnapkinv&zdm_ss=iOS_3547620770_&from=singlemessage)

> 前言平时经常在业余时间折腾一些东西，一部分成本比较低，剩下一部分成本特别低 & amp;nbsp;。折腾完之后自己挺高兴，家里领导完全不能理解，甚至因为

前言
--

平时经常在业余时间折腾一些东西，一部分成本比较低，剩下一部分成本特别低![](https://res.smzdm.com/images/emotions/155.gif) 。

折腾完之后自己挺高兴，家里领导完全不能理解，甚至因为这些东西还引发了额外的矛盾。

后来想想，不是每个人都对这些东西有兴趣，但是也不缺乏对类似东西有兴趣的人，索性尝试把一些折腾的记录分享到网上，一是一些搜集的资料和走过的弯路没准可以对其他人有些借鉴，另外也算是自己的一个交代，留个记录。

我对什么感兴趣：

*   首先是 PC，穷玩车富玩表
    
*   智能家居，从租房开始就瞎鼓捣，现在会围绕 Home Assistant、NodeRed 等等
    
*   摄影，毕业买了单反到现在投入时间太少
    
*   网络设备，这某种程度上是前面兴趣的衍生品
    
*   硬件 DIY，自动化出身，会一点点 PCB 和焊接
    

所以会不定期的更新一些相关的折腾记录，感兴趣的朋友可以关注一下。

需求
--

网上经常有小伙伴讨论，自己需不需要一台 NAS，这个确实因人而异，我最开始的需求是存照片，单反一张照片 10M 左右，现在手机也差不多这个量级了。

出去玩拍一次可能几百上千张，而且没有养成即使整理的习惯，就原片堆在那，事件长了空间占用还是不小的。所以 18 年的时候买了一台二手的 DS215j，花了 670，配合两块 4T 西数红盘组 raid1 保证安全（现在我西数一生黑，有机会可以展开聊聊）。后来 DS215j 性能着实不太够用，想着以后有扩展硬盘的需求，又收了一个 DS415+，1300，把 DS215j 卖了 612（三年花了 58 块钱，可真香）。

去年脑瓜一热买了个全景相机，insta360 one x2，好玩是挺好玩，但是空间占用可真大，基本上 128G 的内存卡，不到两个小时就占满了，去了趟新疆，直接小 2T 的空间。

![](https://qnam.smzdm.com/202203/20/6236ac99e91894581.png_e600.jpg)insta360 one X2

所以原本的 4T 空间就非常吃紧了，但是去年的硬盘价格可真贵，完全不想上车，就买了一块希捷 8T 的硬动硬盘，800，后来拆开知道是酷鱼，性价比很一般，但是算是解了燃眉之急。  

但是，一段时间之后，虽然我给 DS415 + 扩到了 8G 内存，我发现它资源可能不够了，主要体现在，用 docker 跑 unifi controller 和用虚拟机跑 haos 基本上是互斥的，内存只能保证一个应用正常运行，两个一块运行，必挂一个。于是在春节期间萌生了 diy 一台性能稍微好点的机器，7x24 小时运行，主要需要满足以下几个需求：

### unifi controller

UBNT 的全家桶要么买硬件的 controller，可能是 2000 多，要么就需要用软件的。UBNT 的界面做的还是不错的，用了一段时间下来，发现功能够用，运行稳定，操作（还算）方便。

![](https://qnam.smzdm.com/202203/20/6236ac9a107802415.png_e600.jpg)Unifi Controller 运行界面

### home assistant

折腾智能家居。在 DS415 + 上对比过 docker 和 os 方式之后，觉得单独一个虚拟机更靠谱，除了更完整的体验，可以通过完整备份虚拟机的方式完成对 ha 的备份。

而且最近折腾有一些可以分享的东西，之后有时间我都慢慢发出来，包括但不限于：

*   完美的卫生间人来灯开、人走灯灭的逻辑，避免坐马桶上灯灭的尴尬
    
*   卫生间根据温湿度自动加热、除湿
    
*   播放器以 apple tv 的方式接入 homekit，iPhone 充当遥控器
    
*   第三方新风系统以风扇的形式完美接入 homekit
    

所有这些操作都是在 Node-Red 内完成，不需要编程，只需要简单配置。

### qBittorrent

随着家庭影院的搭建，有了高清资源的需求，去年开始尝试玩 pt。

最开始只是下载影视资源，后来发现真的是新世界的大门，但是不能在公开场合宣传（😏）。

### 照片整理

白群辉升到了 DSM7.0，moments 和 ds photo 整合成了 photos，很多人都说是负优化。

简单使用还是能接受，但确实损失了之前 moments 之前的一些重复检测之类的功能。

黑群辉是 DSM6.2.3，可以继续使用 moments。

如果还不够，调研下开源的 photoprism。

### NAS

想想已经有一台 24 小时工作的机器了，不顺便充当一下 NAS 有点可惜了，而且后来没忍住还是上了万兆，主要是成本实在太低了，一张 PCIE 的双口万兆网卡只需要 140，四舍五入基本等于没要钱。但是为了测试万兆的性能，花了挺多功夫。

可选的有群辉（黑的）、TrueNas、unraid（和谐版）。

因为手里有白群辉，用的也比较习惯，所以做了一套黑群晖 ds918+。

大容量硬盘直通给黑群晖，这样之后可以无缝迁到白群辉。

像 qBittorrent 这种应用必须依赖硬盘的，也直接放在群辉里，反正群辉挂了，硬盘也读取不了。

部署之后发现黑群晖没有想象那么好，虽然是硬盘直通，但是还是经过了宿主系统的修改，比如硬盘温度就没办法显示。

### windows

这个倒是可有可无的，之后准备把手里的组装机处理掉，只留 mac。如果真有必须用网银之类的操作的时候，可以 windows 上面操作下。

不过这也是虚拟的，如果 mac 上面的虚拟机完成不了的任务，这个也完成不了，所以比较鸡肋。实测安装之后也基本没开过机。

### 影音服务器

Jellyfin plex emby 三个平台一个也没折腾明白呢，先把环境搭起来，之后再慢慢优化吧。

硬件平台选择
------

家境贫寒，对于硬件的选择只追求性价比，无意间了解到了一个前段时间挺火的 CPU E3 1283L V4，于是就去小黄鱼去找，当时正值春节期间，JS 都放假回家了，于是收了台整机，不知道原主会不会看到这个，出于求生欲，隐去了价格，懂得应该都知道，这个不会价格很高😤。

![](https://qnam.smzdm.com/202203/20/6236ac9b091698778.png_e600.jpg)闲鱼记录

16G 内存，有核显，整体上满足我的要求，在机箱的选择上用的是乔思伯 N1。

![](https://qnam.smzdm.com/202203/20/6236add520f872993.png_e600.jpg)配置清单

买来的整机还剩下一个小机箱，应该还能值个 300-400，当时知道机箱电源都用上还是买了，也是因为这个迎广肖邦之前有了解过，还是挺喜欢的，可能之后再用多余的硬件组个小机器。总价 2000 左右。  

### 硬盘选择

硬盘也是从闲鱼买的，水还是挺深的，我也不足够懂，保险起见，买了国行希捷 x18 16T 在保，收到货后，我还专门打了希捷的售后确认了序列号，大致没啥问题。

下面的建议来自我购买的闲鱼卖家，感觉还算靠谱，大家可以参考：

*   东芝的功耗低，温度低，希捷和西数的氦气，硬盘温度比东芝要高 4-8°。
    
*   我三家的硬盘我都用过，我的排名是：希捷 X18 - 东芝 MG08 - 希捷 X16 - 西数。
    
*   现在买小容量不是很划算，现在硬盘性价比最高的是 14T，市场需求许多的是 16T，除了希捷 X18 外，我推荐东芝的 MG08 系列，空气盘好像也出到 MG08 了，声音比西数小，温度比西数低
    

![](https://qnam.smzdm.com/202203/20/6236ac9aa73744012.png_e600.jpg)希捷硬盘

装机
--

最先买的是机箱，比较有亲切感是因为当时我组装的第一台电脑用的就是乔思伯 V3，虽然散热一般，但感觉全铝看起来挺踏实的。

![](https://qnam.smzdm.com/202203/20/6236ac9b98bcf7209.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236ac9d306557511.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236ac9e3dec87261.jpg_e600.jpg)

这个电脑纯属在 jd 上排了个序，选的价格最便宜的，因为这块我之后还有一个升级计划，用手里现在的海盗船替换下。

![](https://qnam.smzdm.com/202203/20/6236aca016b165393.jpg_e600.jpg)

收来的小机箱，还是非常小巧的，比一听可乐大一点点，但是缺点也是有的。

*   不支持 pci 扩展
    
*   1U 电源自带风扇有点吵
    

![](https://qnam.smzdm.com/202203/20/6236aca046b186226.jpg_e600.jpg)

小机箱拆开之后的样子

![](https://qnam.smzdm.com/202203/20/6236aca1c816d3761.jpg_e600.jpg)

只需要他的心脏，主板、内存、CPU、散热器。

![](https://qnam.smzdm.com/202203/20/6236aca38e1594687.jpg_e600.jpg)

装机的过程简单放几张，没有什么难度，注意 stat 线用弯头的就行。当然理线我也不是特别擅长![](https://res.smzdm.com/images/emotions/170.gif) 。

![](https://am.zdmimg.com/202203/20/6236aca3f38513368.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236aca552ab32023.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236aca6acb01465.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236aca877baf1191.jpg_e600.jpg)

![](https://qnam.smzdm.com/202203/20/6236aca964ab86187.jpg_e600.jpg)

其实目前，机器里面的硬盘结构是这样的：

*   一块希捷 16T
    
*   四块三星 840 EVO 120G
    

至于为什么这样，留在软件篇再说，🐶

![](https://qnam.smzdm.com/202203/20/6236ac97cf8282053.jpg_e600.jpg)

部署到弱电箱
------

![](https://qnam.smzdm.com/202203/20/6236ac986a9778352.jpg_e600.jpg)弱电箱非常拥挤

现在弱电箱里主要的设备是：

*   UBNT USG 路由器
    
*   UBNT us-8-60w 交换机
    
*   群辉 ds415+
    
*   施耐德 APC BK650M2-CH UPS
    
*   allinone 服务器
    

我简单画了一个俯视图，可以看到设备之间离得有点近，之后会进一步优化下布局。

![](https://qnam.smzdm.com/202203/20/6236ac9abefa45634.png_e600.jpg)

装上去之后测试了一下温度，硬盘 56，CPU60，有点偏高

> root@pve:~# hddtemp /dev/sdd  
> /dev/sdd: ST16000NM000J-xxxxx: 56°C  
> root@pve:~# sensors  
> coretemp-isa-0000  
> Adapter: ISA adapter  
> Package id 0: +61.0°C (high = +105.0°C, crit = +105.0°C)  
> Core 0: +61.0°C (high = +105.0°C, crit = +105.0°C)  
> Core 1: +60.0°C (high = +105.0°C, crit = +105.0°C)  
> Core 2: +60.0°C (high = +105.0°C, crit = +105.0°C)  
> Core 3: +60.0°C (high = +105.0°C, crit = +105.0°C)  

简单分析了一下，大概有两个原因：

*   乔思伯 N1 散热本来就不太好
    
*   UBNT 的设备温度本来就偏高，而我把 USG 和 us-8-60w 紧贴着乔思伯 N1 的外壳了
    

UBNT 的 USG 路由和 us-8-60w 交换机在室温 28℃环境下正常运行的温度高达 70℃左右，相比友商的民用级竞品这个温度超的不是一点点。不过大家也不用担心，因为从市场反馈和亲身体验来看，这样的温度并不会对设备运行有影响，其实这也是企业级设备与民用级设备的一大区别。

UBNT 的设备稳定性倒是不用太担心，但是我这个小闷罐能不能扛得住就得观察一段时间了。

至此，硬盘部分的介绍基本结束了，其实软件部分准备的也差不多了，我是先在下面调试好再放上去的，现在稳定了一周多了，一个小的 flag 是稳定运行一个月。

下篇我主要介绍一下在宿主系统 PVE 下我安了哪些虚拟机，分别有什么作用，下篇再见👋。

第一次把折腾的东西放上来，希望大家多包涵，如果感兴趣的话，我会分享更多。

作者声明本文无利益相关，欢迎值友理性交流，和谐讨论～