> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [post.m.smzdm.com](https://post.m.smzdm.com/p/a859320l/?send_by=3547620770&invite_code=zdm4ptnapkinv&zdm_ss=iOS_3547620770_&from=singlemessage)

> &nbsp; &nbsp; 大家 Docker 常用的 jellyfin 通常是官方的 jellyfin/jellyfin，以及基础库支持更完

大家 Docker 常用的 jellyfin 通常是官方的 jellyfin/jellyfin，以及基础库支持更完善的 Linuxsever/jellyfin，而今天我们将见到目前最强的 Nyanmisaka/jellyfin。

说到 nyanmisaka，如果大家访问过 github 的 jellyfin 官网，就知道 nyanmisaka 是官方开发人员。传说他跟阿塞拜疆有点联系，也说他是自己人。目前国内各大软硬件论坛博客都能看到他的留言，国外论坛上也有不少，一会儿英文，一会儿国语，看得我云里雾里。据我偷看了一眼，貌似此大佬专攻 jellyfin 硬件编解码方面，我记得还有好几个技术方向也看到他的专业提示，不过我最近忘了炒股，损失了好大一笔，精神不佳，导致记忆力衰退，都忘记是哪些领域了。不过，不少官方权威解答，ffmpeg 调试改进，都是此大佬。那么大佬 2 个月前也悄悄说过（说这话的论坛转型关闭了，关闭可真快... 眨眼都 1 个多月了），要做个国内特供版本，免受官方开源限制，直接集成更新的驱动和基础库，国内用户装上就用，不用再打补丁。。。。现在，他来了。  

据 nyanmisaka 不公开的秘密，他的 docker 主要强化了核显驱动、字库驱动、ffmpeg 优化参数以及 10.8.0alpha3 最新改进和改进还未发布的各种东东。其实 nyanmisaka 是有公开宣布的，但是他是用英文宣布的，我看不懂。既然视频优化上 nyanmisaka 大佬做了这么多工作，所以我也希望热衷硬解的小伙伴们能看到并试用这个版本的 jellyfin。毕竟使用的人越多，nyanmisaka 就越可能天天帮我们更新，有自己人真好。

如果你擅长于重装各种 Docker 版本的 jellyfin，请直接跳到后面的章节去看。文章贴图比较多，为了便于小伙伴快速跳转，先列出章节：

1.  **全新安装 nyanmisaka/jellyfin**
    
2.  **牛刀小试，改进的转码能力与效率**
    
3.  **jellyfin alpha3 几个小问题**
    
4.  **新的色调映射算法**
    
5.  **最后，很快会再见**
    

全新安装 nyanmisaka/jellyfin  

---------------------------

大家不要被标题全新安装吓到了，nyanmisaka 是官方开发人员。所以据我测试，nyanmisaka/jellyfin 兼容以前版本的 jellyfin/jellyfin，你可以直接使用 jellyfin/jellyfin 的配置目录无损升级。

那么，这个 docker 是不是装上就用呢，我还是要讲一讲全新安装一个 nyanmisaka/jellyfin。

首先，下载 docker，我们还是以群晖为背景，开工。

![](https://qnam.smzdm.com/202112/20/61c042642d9103001.png_e600.jpg)获取 nyanmisaka 版本

如上图，打开 docker 搜索到 nyanmisaka 的 jellyfin，双击下载 latest 版本。如果网络卡顿的小伙伴们，可以去 SSH 里面 pull，我们可以复习一下 pull 指令。

docker pull nyanmisaka/jellyfin:latest

因为 nyanmisaka 大佬想提供的是即装即用，所以以上命令行有点违背初衷，下次不再提示。

回顾 SSH 的闲暇功夫，映像应该下载完毕了，（如果没有完毕，请再看看 SSH.......），我们去为镜像启动一个新容器。

![](https://qnam.smzdm.com/202112/20/61c04512159b11167.png_e600.jpg)启动新容器

这里再复习一下为什么都推荐选 latest 版本，**因为今后有版本升级，我们直接再次拉取 latest 版本，等映像更新后，我们停止以前的容器 -> 选择重置 -> 再启动，就可以无损升级到最新版本了。**是不是感觉很不踏实，这么容易就升级了？？但是，很愉快吧？  

![](https://qnam.smzdm.com/202112/20/61c045d375dc98308.png_e600.jpg)进入高级设置

我们标注 1 位置填写容器名称，标注 2 位置勾选高权限以便于我们可以使用硬件解码，标注 3 位置启动资源限制，可以在标注 4 和 5 位置进行一下资源限制，最后在标注 6 位置打开高级设置。其中 **2 是必须的**，1,3,4,5 大家随意，如果你真的很随意只给 jellyfin 分配了 1MB 内存，我很想知道结果会。。。。怎么样。。。

点击【高级设置】我们要进一步设置。

![](https://qnam.smzdm.com/202112/20/61c04825e0a0b409.png_e600.jpg)高级设置启动

![](https://qnam.smzdm.com/202112/20/61c0483e36b3d3243.png_e600.jpg)网络模式

![](https://qnam.smzdm.com/202112/20/61c048041cb917046.png_e600.jpg)存储空间设置

高级设置里面建议勾选**自动启动**，网络模式选**【使用与 Docker Host 相同的网络】**，直接使用当前设备 IP 和端口。储存空间这里，标注 1 位置，选择**添加文件夹**，分别添加 cache，config 和 media 目录，nyanmisaka 的配置目录与官网的 jellyfin/jellyfin 相同。实际上，如果你以前有 jellyfin 官方的 docker 配置有目录，你可以直接指向你以前的配置目录，平滑升级无忧。这个我好像前面提过？。。。太平滑了，不得不再说一次。

标注 5 位置，我将 media 目录设置为只读，防止 jellyfin 里面误操作删除媒体源文件，安全第一。标注 6 位置为我在 NAS 里面对应的目录，大家目录不同，你不要说我写错了。

配置完成按【应用】回到创建容器界面，点击【下一步】。

![](https://qnam.smzdm.com/202112/20/61c04a7d615d34216.png_e600.jpg)摘要显示

这里再次确认我们的设置，如果有问题，请不要找我。。。。点击【应用】，马上开始多媒体之旅。

不得不说，启动 jellyfin 可真快，即使我左手点【应用】，右手开网页，都能马上打开 jellyfin。其实好像也没这么快，我键盘上找数字按字母，还带指甲太长按着老别扭，先去修理一下指甲。。。。

浏览器打开你的设备 IP 地址加上端口号 8096。

![](https://qnam.smzdm.com/202112/20/61c04bc60360b3330.png_e600.jpg)设置中文

当然选汉语了，奇怪 jellyfin 官方不是有自己人吗，怎么常见的中文这里是汉语。。。。

![](https://qnam.smzdm.com/202112/20/61c04bde4d0fe7743.png_e600.jpg)配置管理员账号

这里需要注册一个管理员，我就默认 root 用户名了吧。  

![](https://qnam.smzdm.com/202112/20/61c04ccd8ca492369.png_e600.jpg)添加一个媒体库

这个可以跳过，但是为了便于演示，我按要求先添加一个媒体库。

![](https://qnam.smzdm.com/202112/20/61c04d0c027258870.png_e600.jpg)媒体库设置

我这里媒体库只做最简单的电影类媒体库演示，还有剧集，音乐，相册等类型可供选择，小伙伴可以自行研究，我们会尽快过度到后期的转码效果测试，所以这里仅仅提供电影类媒体库设置作为参考。标注 1 位置选电影类，标注 2 位置取个霸气点的名字，比如：《最让人不讨厌的电影》，《厕所常用影院》。不过我还是觉得《经典电影》吐槽率高一点，万一我说经典你说不经典呢，是不是。

标注 3 位置按【＋】选择文件夹，就是我们前面【高级设置】里面设置的那个，如果你忘了是哪个高级设置，那忘了就忘了吧。

媒体库下载语言和地区，按图设置一下，今后刮削对应刮削中文。什么是刮削，这个你可以搜一下。本文不会深入介绍刮削，刮削可能遇到元数据下载器没法访问服务器的故障，这个需要改 hosts 或自建 DNS 代理。这个是常见问题，有很多文章介绍。我的解决方案是局域网自定义 DNS 代理，随时可以更新，整个内网都能同步更新刮削服务器地址（api.themoviedb.org 的 IP 时不时就不灵光了，常换常新吧）。但是这个方法有点安全隐患，这里就不展开了。我默认大家刮削是没有问题的，甚至是已经预先刮削好。

![](https://qnam.smzdm.com/202112/21/61c13b928dd8d5031.png_e600.jpg)媒体库建议选项

标注 1 位置是 10.8.0 带来的新特性，每个媒体库可以自动收集合集，我暂时把它关了。因为它会自己建了一个名叫**合集**的媒体库，更重要的是，因为刮削元数据的原因，它统计的合集并不准确，有时候系列名也不对。想试试的小伙伴可以打开，默认是勾选上的。元数据下载器这里，第一个 TheMovieDb，就是我们提到的会调用 api.themoviedb.org 来刮削，如果你有未刮削的电影，这个服务器基本都能刮削出来。第二个 The Open MovieDatabase 默认是勾选的。它可以补充第一服务器没刮削到的资料，比如获取烂番茄的评分。两个服务器的优先顺序可以用旁边的上下箭头调整。

标注 2 位置是新选项。按照音乐媒体库的同样选项解释，应该是指从电影文件内嵌的附件提取封面或海报图片。标注 3 位置建议取消，是刮削不了海报图片的时候从视频中截取画面。

如果你的电影已经刮削好，建议图片获取可以全部取消。

![](https://qnam.smzdm.com/202112/20/61c04e4955eae6562.png_e600.jpg)取消图片获取方式

即使你的电影已经刮削好，也建议保持元数据下载器的选项，比如你关闭了 TheMovieDb，那么你的演员表头像和演员信息，就不会再更新了。

点击【确定】，第一个媒体库配置完成，【下一个】。  

![](https://qnam.smzdm.com/202112/20/61c04eaf8c4aa7226.png_e600.jpg)元数据默认选项

这里提示我们将为后期的媒体库配置默认语言和地区。  

![](https://qnam.smzdm.com/202112/20/61c04ee7a77da2547.png_e600.jpg)默认远程访问

转码，当然还有个作用就是外网访问了，默认是勾选的，点击【下一个】。

![](https://qnam.smzdm.com/202112/20/61c04f38cf10c1193.png_e600.jpg)完成设置

若干个下一个后，终于有【完成】了，点击后会再次出现登录界面，登录我们的管理账号进去。

![](https://qnam.smzdm.com/202112/20/61c04f86a2bf28226.png_e600.jpg)左上角点击进入控制台

我们观看电影之前还有点事情要做，那就是设置硬件编解码。点击左上角，进入控制台。

![](https://qnam.smzdm.com/202112/20/61c056a5e09183688.png_e600.jpg)控制台

![](https://qnam.smzdm.com/202112/20/61c056c1ad8ec6971.png_e600.jpg)打开硬件解码

我们直接配置个目前官方 10.8.0alpha3 都不能干活的配置，如上图。注意标注 5 的下方、标注 8 和标注 9 这几个地方出现了新选项。标注 2、标注 7、标注 8 这个位置，我们会不同选择来进行一组简单的性能对比。这里先暂时不管，按图配置就能愉快的转码了。

对了，我们先回到媒体库看看。

![](https://qnam.smzdm.com/202112/20/61c070a263a76388.png_e600.jpg)已经默认支持中文字库

完美，我们没做任何补丁，媒体库字库已经支持中文，不会显示框框框框了。如果你的媒体库没有出现图片，请耐心等待它自己自动更新，如果已经更新完成还是没有显示图片和标题，那么可以选择手动刷新，来一波：  

![](https://qnam.smzdm.com/202112/20/61c0731c39ac4970.png_e600.jpg)手动刷新媒体库封面

按照标注顺序，执行三步等待刷新完成。这次出现图片和中文了吧。

到此，一个全新的 jellyfin 安装完毕，这个即装即用的硬解 jellyfin 究竟如何呢，接下来我们来试试。

牛刀小试，改进的转码能力与效率
---------------

大戏出场，我们选一部 4K 电影，先看看该视频元数据。

![](https://qnam.smzdm.com/202112/20/61c0748115cf63176.png_e600.jpg)视频参数

这部 4K 电影是 63Mbps 码率的 HDR 视频，需要 HDR 转 SDR、带烧录 PGS 字幕，转码目标分辨率为 1080，码率限制 15Mbps。分别在 QSV 和 VAAPI 解码方式下，采用 VPP 和 openCL 色调映射方式，查看在同一段场景稳定后的转换帧率。

![](https://qnam.smzdm.com/202112/20/61c0798ee78627488.png_e600.jpg)编解码速度对比

5 组数据分别是，1.QSV 转码 openCL 映射 108 fps，2.QSV 转码 VPP 映射 77 fps，3.VAAPI 转码 openCL 映射 48 fps，4.VAAPI 转码 VPP 映射 61 fps，5. 对比 10.7.7 版本 VAPI 转码 VPP 映射 46 fps。

再拿一部 60fps 的电影测试一下。  

![](https://qnam.smzdm.com/202112/20/61c07df44a2023760.png_e600.jpg)60fps 4K 测试

同样的选 QSV 转码 openCL 映射 稳定在 110 fps 左右。

以上数据测试硬件环境 intel 8 代 i5，intel UHD 核显 655，软件系统为黑裙 DSM6.2.3。测试的视频需要 HDR 转 SDR，烧录 PGS，缺少一项，转码速度都可能起飞达到 3xx fps 以上。

对比数据可以看到，nyanmisaka 自带的驱动和 ffmpeg，加上 jellyfin 功能支持，转码提升非常明显。

**转码功能：**如 nyanmisaka 大佬所说，**无脑安装完成，无须自己打补丁，即可支持完整硬件功能**。以前版本存在的 QSV 解码没有 openCL 色调映射选项，现在有了；QSV 解码烧录 PGS 卡在 19fps 的问题解决了；VAAPI 以前 openCL 无法烧录 PGS 字幕问题也解决了。

**转码能力：****QSV 整体转码能力优于 VAAPI**。与以前的版本相比，VAAPI 转码 VPP 映射（以前版本只有这个模式支持 PGS 烧录）帧率由 46fps 提高到 61fps，提升 33%。QSV 转码与 VAAPI 转码在映射方式上效率相反，QSV 在 openCL 映射方式下效率最高，而 VAAPI 转码在 VPP 映射方式下效率高于 openCL 映射。实际上，经过几天的连续转码试用，我更**推荐大家用 QSV 转码配合 openCL 色调映射来日常工作**，毕竟这个转码帧率能达到 110fps 左右，比以前的能用的模式（模式不一样哦）46fps，如果**直接对比的话提升 135%，称为吊打**也不过分。

**画质提升：**以前 VAAPI 转码的时候，如果大家仔细看画面，可以看到画面被切分为好几个矩形块，而相邻两个块交接线会看到轻微色差和亮度差。新的驱动和 ffmpeg 更新，已经消除了这个问题。

**结论：**Nyanmisaka/jellyfin 真的是装完就用，玩硬解的小伙伴们可以愉快的过度到这个版本来，nyanmisaka 大佬这几天也是火力全开，各大论坛都看到他在互动，docker 也在频繁更新，什么，好像刚刚又更新了。。。。

番外，nyanmisaka 带来的核心提升暂时测试结束，非常难得 nyanmisaka 大佬本人也来到 zdm 留言跟大家互动，所以下面附加一些 jellyfin 设置和使用方面的讨论，希望 nyanmisaka 大佬帮大家科普一下。

jellyfin alpha3 几个小问题
---------------------

**QSV 模式 TV 客户端底部色条**
---------------------

在 QSV 转码烧录 PGS 字幕的时候，TV 客户端默认 exoPlayer 播放画面底部出现明显的彩色横条，而且随着图像变换。肉眼看上去大概就是有几行。其实不烧录 PGS 字幕的时候也有。只是行数更少不容易发现而已。

看上去像是内存拷贝数据的时候错位了几行，底部几行没填满。而 VAAPI 转码就没有，或称为很轻微，仔细看好像有 1、2 行。

而同样模式在 PC 的 web 客户端、手机客户端 web/exoPlayer 方式都没发现问题。

**低功率编码**

新版本带来两个低功率编码器选项

![](https://qnam.smzdm.com/202112/20/61c07d857a0c52597.png_e600.jpg)新的选项

启动后并没有发现转码速度有提升，而且只能工作在 VAAPI 模式下，选 QSV 模式直接报错。

**ASS 字幕口口口口问题**

**敲黑板**，10.8.0 似乎已经支持 Web 端、exoplayer 客户端显示 ASS 字幕和 PGS 字幕，无需服务器端转码烧录。在做 web 端测试的时候，默认为自动的方式下 ASS 字幕将不会转码烧录。这时候 web 客户端直接显示 ASS 字幕，中文字幕还是会因为缺字体而显示口口口口。解决的方法是，启用备用字体。

![](https://qnam.smzdm.com/202112/20/61c088d246f8f8304.png_e600.jpg)启用备用字体

我们要进入控制台播放转码设置里面去标注 4 位置指定字体路径，勾选标注 5 位置**启用备用字体**。当然，我们自己要先找好支持中日韩文的. woff2 字体，如上图，我是放到 config 下 woff2 目录下的。

![](https://qnam.smzdm.com/202112/21/61c15a1bbb58b3340.png_e600.jpg)启用效果

标注 1 是默认交给客户端显示 ASS 字幕因为缺字库仍然出现口口口口，标注 2 是启用备用字库后，客户端 ASS 字幕显示正常。

ASS 字幕也可以强制烧录，通过用户设置页面来启动。

![](https://qnam.smzdm.com/202112/20/61c0877d0cea79392.png_e600.jpg)启用 ASS 烧录

进入**用户**设置菜单（注意不是进入控制台），烧录字幕选 **所有复杂格式字幕** 或 **全部** 都可以启用 ASS 字幕服务器端烧录。这样 nyanmisaka 大佬内嵌的中文字库支持就能派上用场了。

**这里敲黑板 2 次** 我推荐把 ASS 文件转为 PGS 字幕除了所见即所得之外，也在 jellyfin 中遇到很棘手的问题。每次服务器端转码烧录 ASS 字幕，都会疯狂读取视频文件，好像是全部读取才能获取 ASS 文件一样，有的长达几十秒客户端才开始播放（想想一部 4K 高码电影可有几十个 G），我一度以为 jellyfin 挂了。我测试了好多视频文件，都是如此。而 PGS 字幕就很正常。理解不了 ASS 和 PGS 转码预读差别为何这么巨大。如果说 ASS 文件需要全部读完才能获取所有特效，即使 MKV 封装将 ASS 文件封装到文件的最后，读取文件不是可以 SEEK 直接读取后段文件吗，一个 ASS 文件几百 K 而已。而一个 PGS 文件，一言不合就是几十 M，虽然 PGS 是按时间顺序一段一段的不需要首尾适应。但是作为预读的话，PGS 也可能在 MKV 封装的最后，读取量更大，为什么 PGS 不影响转码预读时间呢。。。唉，说得我都糊涂了。。。。。

总之，如果遇到 ASS 文件烧录播放不出画面的情况，jellyfin 并没有挂掉，它正在忙着呢，请耐心等待几十秒，奇迹会出现的。有句歌词：我等到花儿都谢了~~~

也许是我遇到的个别情况，不知道 nyanmisaka 大佬遇到过没有。

新的色调映射算法  

-----------

10.8.0 版本带来了 BT.2390 色调映射算法，全新安装已经默认启用该算法。如果手上有同一部电影的 SDR 和 HDR 版本的小伙伴，欢迎加入一起来测试。这里我就先贴图为敬了。

![](https://qnam.smzdm.com/202112/21/61c16bb5ceedd1957.png_e600.jpg)选择映射算法

在控制台选择播放转码设置，标注 1 位置选中启动色调映射，这个是 openCL 模式，启用 VPP 模式是没有参数可调的。

openCL 默认算法是 BT.2390，以前这里默认是 Hable。

![](https://qnam.smzdm.com/202112/21/61c16c86c4ac18559.png_e600.jpg)参数一览

除了算法选择，下面还有不少参数选项，以上参数有中文介绍，我们先保持建议值。上图最下面一个色调映射参数，默认是空着的，就是默认参数或不需要参数的意思，如果我们选不同的算法，如果有参数的话，在这里设置。先来一组默认参数效果贴图，第一张是作为参考的 SDR 视频画面。

![](https://qnam.smzdm.com/202112/21/61c17d67d1d015987.png_e600.jpg)SDR

必须承认，SDR 色彩亮度看上去是很舒服的，这部电影有点典型，就是我找到的 HDR 版本转换 SDR 都比较暗（默认参数，如果想调整，看后面），以下效果只代表一部分类似 HDR 电影，有很多电影的 HDR 也做得很好，默认参数转出来效果就不错。对比猛烈一点，大家也能看到差距，主要就是大家研究研究，不要认真就好，不要扔我砖头就好。。。。。

![](https://qnam.smzdm.com/202112/21/61c17d89580c96545.png_e600.jpg)HDR-VPP

这个是用 VPP 转出来的效果，没什么参数可调，就是这样，为什么黑，可能 VPP 就喜欢黑吧。。。。但是它的饱和度，说人话就是色彩看上去还是很丰富的，就是亮度不准，不知道如果 HDR 描述的亮度峰值不准的话，哪里可以强制 100nits 就好了，或许 VPP 算法默认 400 或 1000 没法改。。。。。以下 openCL 我也没找到这个设置，如果我们调整亮度，只有改该算法的参数来实现。如果有小伙伴找到可以设置 VPP 映射参数的地方，记得 @我。

![](https://qnam.smzdm.com/202112/21/61c17dc66d94263.png_e600.jpg)HDR-openCL-BT.2390

BT.2390 色调映射，nyanmisaka 大佬推荐算法。ffmpeg 官网我没查到具体说明，可能是最最最新支持，都没来得及写介绍。只知道是一种 “基于直接映射的转换方法”。这是我网上抄的，具体什么意思，好像很神秘，不过该方法饱和度（颜色）不错，，，以下不再解释饱和度，亮度没有参数可调，默认里面算不错的。

![](https://qnam.smzdm.com/202112/21/61c184f1abf092553.png_e600.jpg)HDR-openCL-Hable

算法 Hable，是原版本默认的转换方法，官方介绍是比 Reinhard 更好地展现深色和高亮度细节，但代价是会稍微使所有内容变暗。真的有点暗，难怪刚开始用 jellyfin 的时候，发现我的 HDR 视频怎么这么黑，我还拿着电筒对着电视照了半天，也亮不起来，唉。。。对了，Hable 算法没有参数可调，残念。。。。

![](https://qnam.smzdm.com/202112/21/61c18699d22698864.png_e600.jpg)HDR-openCL-None

算法 None，这个简单粗暴，就是直接对高亮度区域做去饱和。大概就是不要颜色，白色一片。好歹看得清楚衣服上的扣子了，不过也不支持参数调整。

![](https://qnam.smzdm.com/202112/21/61c1877d3c2558434.png_e600.jpg)HDR-openCL-Clip

算法 Clip，粗暴 x2，对于超出的部分硬剪辑。可以支持参数，默认为 1.0，调整 1.5 就是线性增加 50% 亮度的意思，反正你弄的太亮的地方，白就是了。不过，总算有个可以调整亮度的方法了。

![](https://qnam.smzdm.com/202112/21/61c1881dae8e79266.png_e600.jpg)HDR-openCL-Linear

算法 Linear，将整个参考色域拉伸为显示终端支持的线性倍数。好像就是最大和最小，拉根直线的意思。于是，这种有很亮场景的画面，我们看到比上面两个方法更暴力的出现了，这完全是黑啊，大哥。线性参数默认也是 1.0，要调到多少合适呢。

![](https://qnam.smzdm.com/202112/21/61c1888ce61841859.png_e600.jpg)HDR-openCL-Gamma

算法 Gamma，调过显示器 Gamma 的小伙伴应该熟悉，可调的对数曲线来进行转换。可以调整参数，默认值为 1.8。数学学得好的小伙伴们应该最爱了吧，来试两手？

![](https://qnam.smzdm.com/202112/21/61c18b9f6c74c4071.png_e600.jpg)HDR-openCL-Reinhard

算法 Reinhard，使用非线性对比度，通过简单的曲线保留整体图像亮度，从而实现细节变平和色彩精度下降。这个官方定义有点拗口，就是尽量保证亮度但是牺牲了细小的轮廓和颜色的平滑度。可以调整参数，默认 0.5，对应指色域内值的亮度大约是剪切时的一半同，如果调整到 0.75 或 0.8，亮度感官明显提升，同比颜色恢复也算不错，但是比 SDR 还是差一些。

![](https://qnam.smzdm.com/202112/21/61c18c4ef18569606.png_e600.jpg)HDR-openCL-Mobius

算法 Mobius，平滑地映射超出范围的值，同时尽可能保留范围内的对比度和颜色。如果你觉得色彩准确性比细节保留更重要时，推荐使用。默认参数 0.3，是指线性到 mobius 变换过度点，数学小能手又能看看这组参数怎么调了。

总之，以上方法大部分都对应一个转换曲线，有的可以用参数调整曲线的形状，比如简单的有斜线型、两头平滑中间倾斜类似足型，等等。然后以这个曲线为基础进行转换。。。。算了，我们还是看图吧。

![](https://qnam.smzdm.com/202112/21/61c18b6b819fa8258.png_e600.jpg)默认映射对比

我们对比一下，1. 标准 SDR，2. 无参数可调的 VPP 映射，3. 没找到参数可调的 BT.2390 映射，4. 没参数可调的 Hable 映射。可以看到 nyanmisaka 大佬推荐的 BT.2390 方法确实不错。

再看看下面这组  

![](https://qnam.smzdm.com/202112/21/61c18fde2eb501789.png_e600.jpg)全部方法对比

这组也全部采用默认参数，1. 标准 SDR，2. 算法 None，3. 算法 Clip，4. 算法 Linear，5. 算法 Gamma，6. 算法 Reinhard，7. 算法 Hable，8. 算法 Mobius，9. 算法 BT.2390。  

可以看到，默认参数下，None，Clip，Reinhard，Mobius，BT.2390 至少亮度上胜出。看了官方广告，我决定再试一组 Reinhard 和 BT.2390 的。其实也不是全看广告，我也看疗效的。能改参数的我都试了。Reinhard 参数直观，亮度和色彩还原综合也算不错，所以。。。还是看图吧。

![](https://qnam.smzdm.com/202112/21/61c19ddf9fb03224.png_e600.jpg)BT.2390 映射对比

这组 1 标准 SDR，2 算法 Reinhard 采用参数 0.8，3 算法 Reinhard 采用默认参数，4 标准 SDR，5 算法 Reinhard 参数 0.8，6 算法 Reinhard 默认参数，7 算法 Reinhard 参数 0.8, 8 算法 Reinhard 默认参数，9 算法 BT.2390 无参数。

这组测试主要展示了方法 Reinhard 参数设置到 0.8，见标注 2，可以获取比 SDR 更好的亮度效果，缺点是对比度稍差，颜色略清淡，可以【色调映射范围】强制改为 TV 模式，可以稍微提升一点色泽。为什么能提升，因为 TV 模式有负信号，相当于拉升了颜色的饱和度和亮度的对比度。。不过这个属于作弊吧，算了。

算法 Reinhard 同样的参数，在另一部视频对比中，亮度就有点过了，见标注 5。这说明不是所有 HDR 视频转换都需要提升亮度，如果有部分 HDR 转换偏暗无法忍受的话，建议小伙伴用算法 Reinhard，参数使用 0.75-0.8。

同时，在默认参数下，算法 BT.2390 直观感受比方法 Reinhard 转换效果还是好一点。见标注 9 和标注 8。

我们再次对比一下 BT.2390 和 Reinhard

![](https://am.zdmimg.com/202112/21/61c1a050ad7c09631.png_e600.jpg)推荐 BT.2390

如上图，1 标准 SDR，2 算法 BT.2390 无参数可调 3 算法 Reinhard 参数 0.8，4 算法 Reinhard 默认参数。可以看到还是 SDR 效果最好。。。我们还是去找 SDR 吧。。。。。。。这样的，小伙伴们能不能放大图看呢，标注 2 算法 BT.2390 转换的亮度跟标注 4 算法 Reinhard 默认参数的亮度差别不大，但是色彩丰富度要好一些。

贴了这么多图，我也不知道怎么建议，数学好的小伙伴们早就自己开始计算参数了吧。我只能说我觉得亮度不够的话，我就用算法 Reinhard 设置参数 0.8，免得我黑灯瞎火的找电筒。简单点，就跟着 nyanmisaka 大佬的用 BT.2390 吧，过几天说不定又有新算法。

不知道 nyanmisaka 大佬是不是在开发一种像相机 HDR 一样，高曝光一张，低曝光再一张，然后合成一张正常观感又能看到亮度细节的算法出来。这个不是 HDR 最先出来宣传的效果吗。HDR 不是来支持我们老设备看高亮画面的吗，怎么现在就要我不停的买买买买 HDR 设备呢，我还要存钱买 Dolby Vision 呢，这里面一定有很大的误解。。

最后，很快会再见  

-----------

nyanmisaka 透露，元旦前后 jellyfin 10.8.0 正式版会推出。不过相对于官方的 jellyfin/jellyfin，nyanmisaka/jellyfin 是帮我们集成了最新驱动、字库和相关基础库的，官网因为遵循开源协议的问题，这方面是比较被动的。

作为半官方加强版的 nyanmisaka/jellyfin，一起等待元旦节 10.8.0 正式版的发布吧。

作者声明本文无利益相关，欢迎值友理性交流，和谐讨论～