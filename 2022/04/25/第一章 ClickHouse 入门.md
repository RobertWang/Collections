> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [www.cnblogs.com](https://www.cnblogs.com/jhno1/p/14661712.html)

作者：[@青青子衿悠悠我心](https://home.cnblogs.com/u/jhno1/)  
本文为作者原创，转载请注明出处：[https://www.cnblogs.com/jhno1/p/14661712.html](https://www.cnblogs.com/jhno1/p/14661712.html)

```
ClickHouse 是俄罗斯的Yandex于2016年开源的列式存储数据库（DBMS），使用C++语言编写，主要用于在线分析处理查询（OLAP），能够使用SQL查询实时生成分析数据报告。


```

一、列式存储
------

```
以下面的表为例：


```

<table><thead><tr><th><strong>Id</strong></th><th><strong>Name</strong></th><th><strong>Age</strong></th></tr></thead><tbody><tr><td>1</td><td>张三</td><td>18</td></tr><tr><td>2</td><td>李四</td><td>22</td></tr><tr><td>3</td><td>王五</td><td>34</td></tr></tbody></table>

```
#1.采用行式存储时，数据在磁盘上的组织结构为：


```

<table><thead><tr><th>1</th><th>张三</th><th>18</th><th>2</th><th>李四</th><th>22</th><th>3</th><th>王五</th><th>34</th></tr></thead></table>

```
好处是想查某个人所有的属性时，可以通过一次磁盘查找加顺序读取就可以。但是当想查所有人的年龄时，需要不停的查找，或者全表扫描才行，遍历的很多数据都是不需要的。

#2.采用列式存储时，数据在磁盘上的组织结构为：


```

<table><thead><tr><th>1</th><th>2</th><th>3</th><th>张三</th><th>李四</th><th>王五</th><th>18</th><th>22</th><th>34</th></tr></thead></table>

```
这时想查所有人的年龄只需把年龄那一列拿出来就可以了


```

```
#3.列式储存的好处：
1）对于列的聚合，计数，求和等统计操作原因优于行式存储。
2）由于某一列的数据类型都是相同的，针对于数据存储更容易进行数据压缩，每一列选择更优的数据压缩算法，大大提高了数据的压缩比重。
3）由于数据压缩比更好，一方面节省了磁盘空间，另一方面对于 cache 也有了更大的发挥空间。


```

二、DBMS 的功能
----------

```
几乎覆盖了标准SQL的大部分语法，包括DDL和DML，以及配套的各种函数，用户管理及权限管理，数据的备份与恢复。


```

三、多样化引擎
-------

```
ClickHouse和MySQL类似，把表级的存储引擎插件化，根据表的不同需求可以设定不同的存储引擎。目前包括合并树、日志、接口和其他四大类20多种引擎。


```

四、高吞吐写入能力
---------

```
ClickHouse采用类LSM Tree的结构，数据写入后定期在后台Compaction。通过类LSM tree的结构，ClickHouse在数据导入时全部是顺序append写，写入后数据段不可更改，在后台compaction时也是多个段merge sort后顺序写回磁盘。顺序写的特性，充分利用了磁盘的吞吐能力，即便在HDD上也有着优异的写入性能。

官方公开benchmark测试显示能够达到 50MB-200MB/s 的写入吞吐能力，按照每行100Byte 估算，大约相当于50W-200W 条/s的写入速度。


```

五、 数据分区与线程级并行
-------------

```
ClickHouse 将数据划分为多个 partition，每个partition再进一步划分为多个index granularity(索引粒度)，然后通过多个CPU核心分别处理其中的一部分来实现并行数据处理。在这种设计下，单条 Query 就能利用整机所有CPU。极致的并行处理能力，极大的降低了查询延时。

所以，ClickHouse即使对于大量数据的查询也能够化整为零平行处理。但是有一个弊端就是对于单条查询使用多cpu，就不利于同时并发多条查询。所以对于高qps的查询业务，ClickHouse并不是强项。


```

六、 性能对比
-------

```
某网站精华帖，中对几款数据库做了性能对比。


```

### 1. **单表查询**

![](https://img2020.cnblogs.com/blog/2087967/202111/2087967-20211110175938938-1587026733.jpg)

### **2.** **关联查询**

![](https://img2020.cnblogs.com/blog/2087967/202111/2087967-20211110175942646-1801597219.jpg)

```
结论: ClickHouse像很多OLAP数据库一样，单表查询速度由于关联查询，而且ClickHouse的两者差距更为明显。


```

```
如果您觉得阅读本文对您有帮助，请点一下“推荐”按钮，您的“推荐”将是我最大的写作动力！欢迎各位转载，但是未经作者本人同意，转载文章之后必须在文章页面明显位置给出作者和原文连接，否则保留追究法律责任的权利。

```