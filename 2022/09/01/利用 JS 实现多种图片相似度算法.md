> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [juejin.cn](https://juejin.cn/post/6844904016686628877)

在阅读本文之前，**强烈建议**先阅读完阮一峰于多年所撰写的[《相似图片搜索的原理》](https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2011%2F07%2Fprinciple_of_similar_image_search.html "http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html")相关文章，本文所涉及的算法也来源于其中。

> 体验地址：[img-compare.netlify.com/](https://link.juejin.cn?target=https%3A%2F%2Fimg-compare.netlify.com%2F "https://img-compare.netlify.com/")

特征提取算法
======

为了便于理解，每种算法都会经过 “特征提取” 和“特征比对”两个步骤进行。接下来将着重对每种算法的 “特征提取” 步骤进行详细解读，而 “特征比对” 则单独进行阐述。

平均哈希算法
------

参考阮大的文章，“平均哈希算法” 主要由以下几步组成：

> 第一步，缩小尺寸为 8×8，以去除图片的细节，只保留结构、明暗等基本信息，摒弃不同尺寸、比例带来的图片差异。
> 
> 第二步，简化色彩。将缩小后的图片转为灰度图像。
> 
> 第三步，计算平均值。计算所有像素的灰度平均值。
> 
> 第四步，比较像素的灰度。将 64 个像素的灰度，与平均值进行比较。大于或等于平均值，记为 1；小于平均值，记为 0。
> 
> 第五步，计算哈希值。将上一步的比较结果，组合在一起，就构成了一个 64 位的整数，这就是这张图片的指纹。
> 
> 第六步，计算哈希值的差异，得出相似度（汉明距离或者余弦值）。

明白了 “平均哈希算法” 的原理及步骤以后，就可以开始编码工作了。为了让代码可读性更高，本文的所有例子我都将使用 typescript 来实现。

#### 图片压缩：

我们采用 canvas 的 `drawImage()` 方法实现图片压缩，后使用 `getImageData()` 方法获取 `ImageData` 对象。

```
export function compressImg (imgSrc: string, imgWidth: number = 8): Promise<ImageData> {
  return new Promise((resolve, reject) => {
    if (!imgSrc) {
      reject('imgSrc can not be empty!')
    }
    const canvas = document.createElement('canvas')
    const ctx = canvas.getContext('2d')
    const img = new Image()
    img.crossOrigin = 'Anonymous'
    img.onload = function () {
      canvas.width = imgWidth
      canvas.height = imgWidth
      ctx?.drawImage(img, 0, 0, imgWidth, imgWidth)
      const data = ctx?.getImageData(0, 0, imgWidth, imgWidth) as ImageData
      resolve(data)
    }
    img.src = imgSrc
  })
}
复制代码

```

可能有读者会问，为什么使用 canvas 可以实现图片压缩呢？简单来说，为了把 “大图片” 绘制到 “小画布” 上，一些相邻且颜色相近的像素往往会被删减掉，从而有效减少了图片的信息量，因此能够实现压缩的效果：

![](data:image/webp;base64,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)

在上面的 `compressImg()` 函数中，我们利用 `new Image()` 加载图片，然后设定一个预设的图片宽高值让图片压缩到指定的大小，最后获取到压缩后的图片的 `ImageData` 数据——这也意味着我们能获取到图片的每一个像素的信息。

> 关于 `ImageData`，可以参考 MDN 的[文档介绍](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FImageData "https://developer.mozilla.org/zh-CN/docs/Web/API/ImageData")。

#### 图片灰度化

为了把彩色的图片转化成灰度图，我们首先要明白 “灰度图” 的概念。在维基百科里是这么描述灰度图像的：

> 在计算机领域中，灰度（Gray scale）数字图像是每个像素只有一个采样颜色的图像。

大部分情况下，任何的颜色都可以通过三种颜色通道（R, G, B）的亮度以及一个色彩空间（A）来组成，而一个像素只显示一种颜色，因此可以得到 “像素 => RGBA” 的对应关系。而“每个像素只有一个采样颜色”，则意味着组成这个像素的三原色通道亮度相等，因此只需要算出 RGB 的平均值即可：

```
// 根据 RGBA 数组生成 ImageData
export function createImgData (dataDetail: number[]) {
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')
  const imgWidth = Math.sqrt(dataDetail.length / 4)
  const newImageData = ctx?.createImageData(imgWidth, imgWidth) as ImageData
  for (let i = 0; i < dataDetail.length; i += 4) {
    let R = dataDetail[i]
    let G = dataDetail[i + 1]
    let B = dataDetail[i + 2]
    let Alpha = dataDetail[i + 3]

    newImageData.data[i] = R
    newImageData.data[i + 1] = G
    newImageData.data[i + 2] = B
    newImageData.data[i + 3] = Alpha
  }
  return newImageData
}

export function createGrayscale (imgData: ImageData) {
  const newData: number[] = Array(imgData.data.length)
  newData.fill(0)
  imgData.data.forEach((_data, index) => {
    if ((index + 1) % 4 === 0) {
      const R = imgData.data[index - 3]
      const G = imgData.data[index - 2]
      const B = imgData.data[index - 1]

      const gray = ~~((R + G + B) / 3)
      newData[index - 3] = gray
      newData[index - 2] = gray
      newData[index - 1] = gray
      newData[index] = 255 // Alpha 值固定为255
    }
  })
  return createImgData(newData)
}
复制代码

```

`ImageData.data` 是一个 [Uint8ClampedArray](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FJavaScript%2FReference%2FGlobal_Objects%2FUint8ClampedArray "https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Uint8ClampedArray") 数组，可以理解为 “RGBA 数组”，数组中的每个数字取值为 0~255，每 4 个数字为一组，表示一个像素的 RGBA 值。由于`ImageData` 为只读对象，所以要另外写一个 `creaetImageData()` 方法，利用 `context.createImageData()` 来创建新的 `ImageData` 对象。

拿到灰度图像以后，就可以进行指纹提取的操作了。

#### 指纹提取

在 “平均哈希算法” 中，若灰度图的某个像素的灰度值大于平均值，则视为 1，否则为 0。把这部分信息组合起来就是图片的指纹。由于我们已经拿到了灰度图的 `ImageData` 对象，要提取指纹也就变得很容易了：

```
export function getHashFingerprint (imgData: ImageData) {
  const grayList = imgData.data.reduce((pre: number[], cur, index) => {
    if ((index + 1) % 4 === 0) {
      pre.push(imgData.data[index - 1])
    }
    return pre
  }, [])
  const length = grayList.length
  const grayAverage = grayList.reduce((pre, next) => (pre + next), 0) / length
  return grayList.map(gray => (gray >= grayAverage ? 1 : 0)).join('')
}
复制代码

```

![](data:image/webp;base64,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)

通过上述一连串的步骤，我们便可以通过 “平均哈希算法” 获取到一张图片的指纹信息（示例是大小为 8×8 的灰度图）：

![](data:image/webp;base64,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ifueEMEYXksxUSPt1DUyJT31c40Snvq5xolPeaIdj2g796O4loSjz3izvD2eQnVeMtSmSH09RZShQ3xHnAW3aAe5qXYeLmfjpYxH82rnGdU6gQm6tVnOSRDwWaja5R5LGicJgNQirmmjZEyE+3ih31c4ziPc+raQ7pPLZV/gAd2X1KeWPMGi/UqL2KUtAJf7esPhLU+RFn5PENjshi8UtxCrfxTGvikrVc40Snvq5xokzERqBRuCislwQH2iK1XOLktU6Wbs9ZYqqST5PnmITVxxkP+bKLifyitVdOmu1UQ8HmyDutQzcjwc8gKLuzD4X45wGK6dbVGwzDIPjP9lsZekdStSMxRjQr+RGccqmmKVV4nqQJGEj6BEp76ucaJT31c40SaIQScaJTVoJONEp76ucaJT31c40Snvq5xolMuLIl2KgKsFGc4sh/NjRWmHoXC7fsShuqmkaDt9xTd7U+rR0FBQSU99XONEp76ucaJT31c40Snvq5xolPfVzjRKe+rnGiU99XHEpXcHQzKu++4XueZy73W2L8LPpdXn6dz+ZuknGDra4YLq6qewuhZLU44i6I8XF7Vga+GjbRKe+rnGiU99XOLDbItAH0EcAJ6Nsi38orVc40Snvq5xolPfVzjRJdxu86w6/Zu03G6jkETBYzH1ijoXwhB4lHq9WrI4SS8h7eRvhIKyYV7qoH4Xkpn3+bVzjRKe+rnGiU99XONEp76ucaJT31c40Snvq5xolPfVzjRKe+rnGiU1z+UVqubm8oKCSnvq5xolPfVzjRKe+rnGiU99XONEp76ucaJT31c40Snvq5xolPfVzjRKe+rnGiU99XONEp76ucaJT31c40Snvq5xolPfVzjRKe+rnGiU99XONEp76ucaJT31c40SnvLeAqXVmKJ0/5cIjDHSZaileNCHpgFqEQTJ/OfZ/ijNPArm9ed5EK9ZTB31c40Snvq5xolPfVzjRKe+rnGiU99XONEp76ucaJT31c40Snvq5xolPeSJvuwM49mmOQica4soX4ZCfljJMOSQDg9YsqL/tSzxgTW49Dc9OIM6jEn2PEWuRZ3/nYtEp76ucaJT31c40Snvq5xolPfVzjRKe+rnGiU99XONEp76ucaJT31c40Snvq5xokygAP7/HOgAAAAAAAAAAAArXAg5kuycwme4gAAAL3+AAAAbtzg1betDx4yMS5+caolE12AdUzTQeK2Mng/cMQO4BMoIwnnnzYPpo1BUG4G0nhdIPOdf+KgLor/Vf3f1VmuFsol39NKsCMb1x0qtVGZ5qU4sQIcM207REYeSo2TGpEZPf5wsg20HVZrM/fEk7Cr07RE11b7p6QPqJRUDpn+5MQq6bCKvnbyQvG0hhtwCfNEPFb//rBak/EHY+tPp7XnUwD8hYP1+uQuWQ2n5yu7SvCiqPIowwtzTsIwGOhVE30KlFbvuiT47gDLA8GvmYrE4lPBx9oaRGHJProzWrcisi5Pnrt/Jf4+RL5wlly2geVVmCGq2mL91/6Kh6KL87bITXgI8vO5253iCuQIprGWApzuK8z3wmYI7aa/4yiXoa+RIAewzPR+NXUY4b7PIJ+JYecQMAfnWHtgeDA0QVSNZuT8YPyGnQpqRRkURFGFtKKyDrqj3LugAALncH5uguPn6+jsYYnToze2lTSpaX4C6+uxJG1b58sB9QYuscoSMQ0/JPQMRVC9M42zkXT5O8ZVtoEpZFMhrpwcO9cB5hN4bxr5uPE+FK8nMh/umNhhWATmk1EIekpTeG8bAaswI3N0QUyraXq8TSJk5KNZ6WnR4p3Y3J6PfB0P/cj89zH1gz+ai/0sbyX+rFhVeb5mxsreLqBhpWrCMcX9mS5e98dF0XMp1JC5YMAYzeiK1q9FVNlTGmwL/c8V+R6D0CxP91hyOLZi+/0XMOlSCLe5gXD1CwPB4wUhmTmiAlMcpcOf9dU/TLvcxyn9T2KdeiCga1rv94EaTulwcV8kGsGcChCr3LoHEnNduxE+RUWBwpcrI0tO25FoGaC4zNHKhjK9AaEQJ6UXcJSze8Bk6SlZYvIB2vazWGsOR7dITEFgGS1JzQP2wrf4sQnGvqolly83eqBu/8lETLAyJ1Fa709WrAs7lQ8y+qd+9XhF3jJFpRolo2TlOy5oUE6xI9PyW72foRfuPmigklQtzP22avjL5xNk4gXFc521AhI3PEYJlDgOnJXbO9jIaMYePjHyNY8wpz+FQJFmSLeIDwxj5JlucUK8xfwxFa54XDrr+X7N8iElvcsSvAEQY8/6AvGW4F8GssOHjsD2nbPSSPX4v65E/v6BN0At9VAyKQHJTwzqUahikaqllDrw4UGLd0zfPj04ZgaXVOlEGH4MXDCK/gl3bYr6RPUys7CJGlGr/2xUuoTYlnW3+qr1awctyCFPlDgKUvg9kn3AmK+2aUwuk0SfYtDTsWoyT3342kMNuAT5oh4rf/9YLUn4g7H1p9Pa86mAflC9gLgrcSf+iZP5jjVTPfhbfyQvn6naRInimaYQOkaNX+hxi9bA7fUqkrCKvrz2UFTZN3ZEZ+hBBGnUZmUbREsZ+nO5253iCuQIprGWApzuuJXc+JQMCM6aOpJhgtnP043O0L889MxkToX+W23NfVd0D8qfjCLOlE2gB2gG6rlDweztzPxkha3F1Mw/daPSiwx7rLByTSHxORsBWmok3qzqWMM7+yDe5fF1Sy2uOmYfPDrt2pAZrIC68z+otpy4UUCTD4iTESnDiYbhnhPiZ8PYCXEwduT/fMatjcbTjz9REBW+f8zbHu3UVfRO5+kqOX9iRGT82uExK6nhaZWvEiJDAuGcLcETVuSOqyYfHs3LSMXxkPk2XBB2ZW3ZL9TCKCnU0QiZeYYVdmFmt8T91dXEsp35ut1VczPqyHMBsRKp/uxlRs6k3t7k42pfNPSlpFF/1RjUimLZtGlPfMVGRHAaiozdtzCBQLUsmL/oQHdnSdJMi61VI76uIlZxOoeoV+utRO3NlDdqcn7ZaDXSe13IqdfxVAt3J7Q9BoFe/nPqA4QlI47JDoWnvD1B6gGB1VKdV7+ai/0tDd+xxKLsL626qfgHCZ8RWq4lGofwjU9tckJz2qOfyZ6+OtFt9HD+tYqetrbE5Uq50eeRT5r6wvHlg506ussHNTl0rJOvN9h+klnSurjuhrCiN8vwTH9S5ETULO04XevFDXpM/E/FD6m8L52JwMKILlf5pxrZ6DPROLbt9SOI+Uml02otzGSr7jSDUyTZ6jv6cn29dK5oUxNevXBsp0sGuJuUuYl3K5TEnEiRvdPmKhJ7jRHQEHL+dWOlhfn9ij5qwXgQfbUTJzlsHIoUqpTflyd1VZLG2FsnTAgZc6JxO8jTk5x9Xrz5Com/eo3cAbe3pY2tJjnX8xEkUh0OmEu8BCDeMJSG5601HlluCVyigCIQ3yjBwpC2mlyvpM3Ehxp4qKixC+n/a1XCg8xLnmQwiqpYW3R2WCN42YmieAPXJtCdfjwEuuBQMkvyYbswxKkwUg6ki4oHFghsAIW/ALUXae6DIFD6XWoaT58iWixMpjZo3jbwB+AoU7BvZYQxzE1e/sXXI0kxP543TqOgzmWb506n9SH50eDco/u/AwWk7NRiaS4BuXeQR1iJ0n3VaW7rPmXwcOjer+7jUMZciCR7EVXOdB6ciG+xpYavXXxsSWPC2AggAxbUU+kTtV5lYXQ97p3V9EDB1bZuOvPZ2XRZU+7vca0tVN/svyIRRsyhB/y3j5MJoZ9QlB50luzFliINHXK1yjIf+wk9LrKRzepZrnDZZw5tvpP5hljwfiAMdQ6CKME/ha/OeBPvOsAiF2p0aW/b4yqcdhUSYtRAvVgCOHriD+AW/iqGtVWjpmTgzzH5E+aFtC6p62hMp1AcMm/2/qKHaUFUqOaT7h7PnlNEf89F84+w9wzN+TdZCV1ayy5MvWnWjs4TY5dDPdCRWzgwuKfoHq6klfwBb0AYrOMC8c1DD7PYITLAjVdF0XMp1JC5YMAYMtVmgBgp6zAHzld1/LClCQD13UXQZk41leaVS2+nUKQXffnpKUs1dWwRuIf4vbGDIJ5KDd/QL9y5rSMu7cqaEMJ+TYum4PBgsAysHU458RhMmaI9ZglLfmgWGA/HfyFK0mYwHTg6OlFwBhXIhbhGLwgn3e8XFcxwzoXJ6nfxHFqeJUFZDEwLMnRioCQ2/sfuebp8pvWmybj5Fyv3KxKG/06vfgga4JgZ9GYXnckWL1SHhAP85HSPpibSRytMx2vaMviPFro80iTt8XQt6OlGmHJWgQ9t4mjaSCgN+dD37AJvRVZK/H0SfzqsMAIHjzQid4s1eNsmfK32T4U6B2mIe9bSMhLbQgA+5sZs1/0dvTRdlaSHKYiGfyipF9ouTGJTFhUXR97rsXlo5HuzcEuKqvvorKnUUiRyvgyXAf294ktzWVPbAXCOdTeFzugJnsv1BbWsWUZ1kExbcrX0wq57TZ4JjpSpE7xtnOUjtLtzbNqCgiQ3yfrMECPTP8r5teIoE5+eBKmVn1mw8JjMrkQuedRDsz18SQysu2r7rtV1AhzMf/pgOB3e0oWw47p/TIG9/b2AA5I3ta3QGFkYVUK7Si5r/Z/OqmIbcxLqNzQsGY3VguWFN7BJUJcHx3hJqqm0TLYORCbLYkgm7+l0T67DZY3/nqWzuZplzVNX5GyiIkgTU796oFrVftrvrSOAgok3shwZx7wQPo5GAruHZfnyZEt1cF3VyKNMyLjUNJDOKzn2rYWmEZIMvZ1FpndyeZ9bZ1do0vCqaW6uQBjcThfAK71u/wIpqo6XWytMtjwnc8fbxhe6pGh1KPuuoG8uKGpgxwfFlKmMgDhRjknjHA9NPgkl26etyyqzOpRqGKRtT0idDRN5Gu2D3vDF1QySN7SgE+l32Tmix935MsPUn78JbK6gy7zE08tbGWJYL+YhUWL/lWKYfwNiyVJ3PCfmLA2N0LqYfH+dOQcmAKnV+nTpzxLQ4Z2c5a3n+d1WQ2WPiqzD/Jc8PEMbrI5a8rXw8tnj35VnHE6y04144ZCJZPjmuu03oT5EW6/MxVF5LXzT6eDHqgADHCCCGrOZvv6j8XLIEcXQnggpTPOa8rWUCOm0cPhZ5Q6KZ5NLvcj7cex31zBdp/SAv3PTobIDW+Nhfz1bHvCX0+t72/klwhO92W34zzoRU0uzr3N6G+idgCKkDRlH/7ueHsqIYApgfQHerh1hsUIq0WZxbtfHmhjPELIfeIENHYL37vFJrlxu/2JkPN9zdwQ0nfu9U29LsdO6HpeMEEsNnC/fmmEoHW5gPAhV9QGOo0Kg6Ja1rko2jtOpB+SpmnpvrNZt9XD+DXlPns5QEf/GFnwqdMLRDOK8OlvjJ8jiO+lO+laqRdwD7IuT3p4947iRQBMaHfbISZjF4Wkz/BZIPtrJrnCpb0lzzqBIFNmMq+MGA1fBRTQEq4+dx7AWKneLJgcHiCInB206w9+mYyJ0L/Lbbmvqu6tkNl0iZIpdusGQSg479SisJfhY5+BDyIog/PTPCLMZ9oJgjuD789CfKxN+5iSxvaeCWzBJuAEXt2LnhYGzqhC+mbaVOkI23HCs/Hb8v05wJw35sjaOlGeFIktdVDuf2qPJwHH1PfQy2E4CeRbaCUx9z1hFg1Vid4xJtlOaoEegwu10azbmzcK4SVbt1PEJytGXfNYiI0lToc+qX4ABcZmFXx4wpncER8gwKaSumyzI79QHR6Ivs+RvBypklGmz9Xh8IuiMGmK2wy9QgPGvBU9UQnp1zRW40xHiYGvVx4oipYqhLppVFwBnlUyoHtR9oSKri88C764EvQuYXrG6cFvGyRAPouTNvdnO17bWzqWSRQNToqvr/2zhRTGS44N8I2aMml/OsfGuryn2qwO3YE1W+mJT0SY3YE8ASsVyYQXOu/sPW1W43DPGedhGXDrIiQ8Yt9MEP1wqAVKjoikKHdqvnQOLnZjjJzCjN4P16PKFHw5S0YwThsUfmBHCMYCyoKKjbXSnUjqK9ndV6WTIxNlq4oM6ux1YWyBky41JHD+zxC0033prmiW48x6fHtvvDYRRyqP/V1oEpX5h6twSxmsbCdm6n8TtdP4d0QyiOeGzVtAw46UtWzzphmypK096wNRf832xBRMYJGq0Mtiuqes8rlyBh/wQIRbZbEoTVu8Ttwu5S4RMhJ8gepQy0qGnZgYx4iEfkkrufIVd3lAcsAm498HQ/9yQSwRVltL+ai/0tDd+xxKLsL626qfgHCZ8RWq4lF8yJt8EdSlIHYrmbwh2VtQbr+uc64cnQioleD+Hd6iPaGTojommavOAgCH7saM1kUvqBDxbDohuTY0MsddnWATgjShp/ZjXsJyelIg+udHnkU+a+sLx5YOdOrrLBzatPGBzt3WeJagOuzZlodUJgwtbL+0udFeEjr087Wr1/vzy7elfq0O24g0nIALkU5CHe7SckfNrD7hFiCVDsH/FM2K5mbvG/mUwt/Vq4LA28EKEL1aslQ2GyXcx8V0WERwrCOrNwsp4PR/sQlJS1DvDyEoXEVn52FxS256aTMnIJRhFWeo7+nJ9vXSwGhNcpwdpRWhTjnxTJwk9Z+QoxM0D9sK3+LEJx0NXMM+sCteeYFjsYzrVBl8Y733TWJ1mOkyKbH+L+ztzZviGvzxr5L2d3oyk6Uh1yFaoIQzNLBGlkzFxktzsft+Yhcy5EHASkyxQx4XhHvqP/GwKoSxlP5KCB+HbFJtMNMjAyZKHFM5fyYJFyi32jjAuZuwqPtk96iN8TEE5QJuGLln2a447EodM3H3ab0CmwPAxmFMsuFrdr/lCUWf8WiwVJ6TXEnB/TCJRGeoi9xqDYdwYk+5Oy6IGKpGiV2AopDsrOVo1Nnfr0Uy60dJnQ/XuKBTKDPJzMdmrL8y8q+GGw02xLqUyt0nzce9KTU37FxmmHW9uSeGesL99sZG2IysOHrlE/No91WRjrgUGuR+TW4AvUzy/CtFi08mlZ7ln9kLb02oAY+iuaXgdOlF6+9uoy38DW7zVU3MoMdb6y35gdpFH3DtzggW10zDGqcXDnH96XJI3gCBVJ5itv3gSgeA6ZMuhRlECarN3yhCGNUP2+Gnj2pielDCYBBGhcPigyXdu7bObGlzqqNkzc7XpUoAwjvACtfIg3wlmnEFa0WzT0mFIcR79FFhpNvRp7rt1LWmzYEIoECoelmXYioPY8LNB8oG9svgp1RgHY29mIhfl2sqhcE8Y2YPkF14PgQFnQY8nziyUTIGTYJKzRU0vP+9StZlnfePscwtVreESzVQN5bnTSf0DtFsoHtp6Q+38rkGsL4Cqn5yqcUcH3gOkNo9shopuOl4VPvCo8lCjPwOQ+1gb1MyHdg3SEgajxZfEqx2qhoYZsOR1Ri7GbUC/P/pgnoevIfLfJVAOURXeuf2GlC+VngAUYErn4sisuDU+JVNInpCg38aBLcjnejKqpvxzWh8N0SE7956PfUfUnsT0bz4E6suZjVa8WH+tPWL87opv5utYHAZbgvttAXZIgfjtnl8TZ4RQlsv2yKCYRt5KKepcCqUsBbieq3jGvwvSy3DoOOoJSZxJ+rYZW6nX00hQFl/Yq10ZrlGL8xzpaSTvHNNUa5hPM8Y30YN+ZxtAxtXL55ySmw6eSEXBdjgftMN0oMi6AiUPTRfcA4WtkRm1/UbQ6i/V1375FGrJFZThg/l2bKoB3PXNpVtiJVfDq0g0SamNji8MchTELR3enX2ywIg7amFMtOkHzHQW0BKPIeiSM6qDVC/oKINnIx/9Mdq2EaDoR4hSia5R558E5b7boRlUFSG2ZX1gxZXuXzMmpFFfn0XqH2bvBtaYhErWgi/j3JyxC1bECo16bjoj/h6DeCt5W6DHtn8gcGfXwntiHEuoIp64AvE6LgHqaFTRka/JyMEOI2M2qry0J7qmAzU8b8LQW0Zq0vkHpckecLH6zkYL4fWblgKsIkkYeCbw4jzMledPxp+HfmthVsbeq331TkTU8Nofq10w8Sc8RL0B50bV6xtVapLGhRPUZJDgNA6OUEw1PawmveTPglR9T5o8iGhTL8ua9FsHf8K4JQlc6s4n5LLS4f9v/b/I0oAjDDGVedaC0OllD5pUW+6L+wzXgIqcvsZUbW9af5WI+Cc6IOVBMbu2Fi3HY8vEvfskZCVjh0T8hs5N9PLmF+x+BSklXKZb2hUnde/C7QQNMor3karY8e414oGKoc4Zv3gSoL2/iLjVeKcTodsGxLV4rJo6puJJpTSOIPFEGHr6UYTbnQ2x5/VdWxgnGOLL6upFa5KKL7fQl4VNe5ALnvNZTQQfQrTSDTihscz5vb57uLlEJdiqOL53E/qQIisL/q9HIkvVuX5R8i0rmwV901QNOElwY1fjCm+0g0ANAWPclwq9X0wfS08z1f4wN+fEJt8D/jOLHKGGyWW0vkuV3xFVCesBcwrc+MgRPnPgbicWiB5J9mo16R3WdKZ+tpkGJWdND5ziGfDZg4BIjf6Q4IlGaN37KlLNo/jFOSxZouvjhmocjNHk+q/LxUd4FRUbWgWZuc2ZcpLa7aGXGhj0Lv2fFNw6LIyDqxpMtLZOsY8xOwl/8WyYsEujCXzHXXBh0gIzohvkmYorIPlA8wX+FJeKVVbPCrdLdbHtacu7MWd8Wci9lu2RugFnlEaVsPt3F1QrR7L1+cu2Muh41lJvb4EJPuyo7mz6AeEm0Yn4H3+S9egfE8lXqMKkbkIcQJAGrokExtGmb9oASRTPmcpI1WU5R8CfVc1AuR/HyyPNqKKUXFceYeWpf/0o2LAUO0bfS+IbcOrO1afG5dbpW/R3j9FrZeBBiP2n0uw/nhsRh1Pcx92ljXEQxEcs+ItOgFUKVuSacsPtFWX6uH+Bm5gCSsJIS9Xa+ut4mIaQg9EO+9vym9Ip6vIpfcjvfqS6UQ4mTJUbaYllW8yAtlRxGDK+r2mMOXvRGUnQjH85J0kFlOyveAcmZfoxmZH5Xm9lMzTsE5JSFNo+zSv9s+G00JEHxIK/Lj9Lll8MCzgQR5NNqBN+37OMy79maDDhrEt+Y63eYIduEqriOIzPIMlFf7Sc05r+YDktMwCQj01nnY6LrFBEFjqf0iUTriYii5wRFO45QQGHVbdbDKRZQSFDRPnXmRUTU3nQIMTy2khcRjkBOGr/RL/qjMzXqfyMm37oBKtu8ssbuQSwnELoSelvYhuF2F6/gaM+HGeDn9w3oi20ykQkLklWLw7y67BZ2BIkesOCZBZcRV2FlI+c6HANU9T9gTJrGNTAHXK7ykVoy0IDzUy5wbMgZwXdq30JTtWNHkXUysxKNc8rZbYXSgFlBsvlxXQkz4v5JlgFAneDmkfopnslfTcPbVs0QY/Ki47E+vbpPOPZcGTSIHPGJx48yDER2UQEG5K+uWkkxzcgtPYfX1pnqcEshdhURf+xyQ7jbiisHZz0euviA+zMVJyv+VLn+dpD9k0h/gkEgNALb2Z4bm4wh32TXeiG/D2uhgASEZ+3KRMXEOaG4i8vALTa/XTcB1Np6TFzvKrwrFYOQwUD9bp2TeR1wEF8eLwc6Kx2kjUEgp7XtjlNYFismH+x9aXkeYJ8wkO2PRrW8TrIt7Ri1mq2eCkrZlpPwHNO7EdLl67vU4BJq0xt9f64z6KakxVg9A7RzIEDq3VdPnOVTPZY+Ofmd6NIn6QFIqcVKT4mHHf0kE01ckGfFlqkvs53leIo7ThxgPkKKbVHwi0ejTupTUsTjNGtYnq+Bf7zDdf23zXBja4SQWwL7ntinxolkLqDnYqKv0Ia87fKTJaSFtEuo285Hm1jP67Y64qn14lTR08lluDuJK2mo0QLuEqBtenbX8BSOj/HTfUo23OA4t/H5LcV/cbpI+x1zV57Z/gxWAf4iysKHu2SW6X+YgXaTJlaczzmbweD1jGwTLxJfKkLr/r77+nWF5LXDC8KXL+/Z6RLD6A8WAzNg7I/h72LNlwrXzU/dBmtpgblgwh0v/RsXDSU4UmpCyKOQkfRZXpoCvCMy3BEg1H/cqfQehBTAqrrqUXVIXyN7+Wi1T1D8m3wKKUdP+jHpMpAopSqeHzxoFxxLp8aY5UN6nGn+QVNZ4IMCLugIDXof1c6EAbLeUnhugL5OtiXMBMVDTXHPrOkJ4t8tIwB52EijSnD/ZK8x5KOny5LCDt+hYHxdeo+28hnoXDxLAEMeNetsbCfJ0+ca/RUmNNqOCC2Px8ub9ypPZ1EoJQzr7vNU2ktNhCnbubXy2jp3ryaNcwRCG6WQ3YIZLl3PBwJ/JxNWoDjfEbCB3da+98pOz0BST9sq9M0/1n9gqAPELx9QhmNXd7g/24rUA7mm1hASSiW50CRK+6mJ3BaQ9KBxTyOiegJEYblk4BRtd1IKanNGgLWVkQ0VSEgjObC6JOFiJfJrx5KigT04akKQSra/MBeFd775LCv9V9NFwyr6FiXZ0xIDhmdimLzFR1DOVXzWAwYcZ/Xq7Pbs82DPo5EHIF0Pr1m4lF2OG8CgQgREUgDXg9FtMG4uFbXy7/3W4NIAo3ZkVv++BgTustz4aC3o0GYg3Fo76SELQeBYvV0SbIFmLkGuuec4yB0RYrNxQDoVl8EXvZDLDSY6iuA9L0ggj+vaPk6cr6taL/QkabeUpvF4pY6cVMgP+QeJP5ggwangNo2lnd+rv7wNaa6KletKRQUSLymJpqTm89Jrd1s2IGX2Vx3XkUINAiLBNON7D4sy09ZfBqZEcYhf/sE2XX8bMTKGLH/sVwPGnMUc8Bt7mcNvwrJRMjp78Y34KMuz47khV6BK8RM1Rc8dud04cJMO2fuIWX6Pn/obndxQECIrIatgtsUvXRmdGtndxcSE0+lqb2ZsZk7zoOmoN9LoWOemUKf3PSG6mOYe9g9HF4F9oFvqFsrQ5+FX1LR9xlv2Y84rvS5aVrFnhz8xPMlai1ZxHqNgmrUTzv7ciNPymiEckQQgxtZIOrJrCBeol+TE/+mCeh68h8t8lUA5RFd65/YaUL5WbZvA7PpBdD9ognWNbLIyBxijP7i3/iYdZAExfngkmtLwmAglKy5AjU+JVNInoYnohQzkeShrwgse89aLGwLXuCco5wLnC+DExqt2gpeUnk9zlPYno3nwJ1ZczGq15IriTvLG+npo3fUnAxjGTWro/JYW/6GWcu5VayTDZFcFP9sHAW/bBa8hkcvmGsq/pVVlUJUsKGrr0ZKgCH0t5r/wao+Z+yvDgt0Rq+7IlaTaNy48Ru2e+sQqe5J5yU14X2q9lIXn0qjd22kJbWIijvAC8CUAoV/5dJF5zYQ5vI/hlRoA+1VHJGtvTpfjZxwK2o1Eb/hHVQWYp3OqCFmgGER2IpkxjK2Jo74Clrl3eaZOqE18f6dPhK5HJTyvj/6aTbU/TLAPK7dIUQ12d5LlfZ4ulp2OqOqQwErtl2sg4lX3+UpNzJ1xxfZrKScCJp0k4QbFA7rjXnY+VJ1Qag7amFMtOkHzHQW0BKPIeiSM6jpsC329ld+V5t/2MKuEGFWqUIlQpuvAAeORBEOHBaKs8CJJBxcT5wbb1Vyia5m7dE6pWikRuoAIbWaLDTCEg5uTA40YQzG+uU/47aMmD1z/QUUQq/2uDQYawKrWwbuw84EWDpRH5Ab2nzrqixDTaBgS+q8gU8d8FCLnbgLALYr/AtEtva2/AjATvhh4uL9nWKsAWqV2IjM4B6u6WQa5qrH49HT1nVHT3DGd1eWlUwlAEIh/lDvDuB4gU6yORWgJqWQg2Z6MTvpG0231a7XjQAgQz/iPkiNrdunioseAjxp+dCzRuKL45WEVvppF7o0HTf9bs8pwC+T6ZORRlkecTkc/KoiIp7pKx1rVC3rkBwTZiQC9ll3Hf0MuI5CAp9Vb/TqOHAE5t3sM6s0wxmf5DZJ+i62Svv4/vMg1j+XMb3HiMgSBqmDWXDEgQsv5O+NU754DA/VLbnwLEN2aCLDPydYb/2XGzGCMrDU0xk5FacP7ze4ljv8Lj6Pmb3uzvjwUkvOlVXEu+9Ev7s/D2pcB9CM7LTYIQw11BzoEdLUAF6Uk7E3SMcRGirm56gf2kmrB46Neb0TOuALhnZ33E2ZDssZpEBOwl/8WyYsEujCX2pJEiREADPYWCia5AZY2JJty5i4WKqPQEoB7pmErzeLgvt2UXIBDwaMHhS5f37PSJYfQHGL4mB1f2PR+X1p8HDRdQQEzpp+31IcopFkKmcw0uEDSB0dA8KCaRAgbpjBbO0KjSDJq7ECAe/w9+KfprPuKCH2XpBTLUtiNn09DaDda9TOYJUNn/2yWzuhgWSAbwhux8wHrbq4VXevRLyDGokotDGAbiGbZtzDDCtQv5OuQ8aVBWJLI/Ij0+J3InIfgFaOxMqvzPSObcvy7m61ZKTRTRQ01j8VuqSyPHaca4sBLBDKmPHsJybIhme9r0ZHt1pqn6hvx8J+mW5bHMsH0GkYM896t5NvgUUo6f9GPSZSBKXEF/k0ZGdQqy60Tw/GcJH9fzb//bMp2sfMkgD5Ss9KNa3l2cOR93lFpBqdHhCCqHtHNmmMgnXSGuqp+yxPOCllrFwkUMWhaMJXA9Z7P1ne6GKakZjeQADt43rrhWc5R25/jjF+Y5xgGuy2SdbkZchx/dxkp5Pfx2lkFM6Ht5LKJ7tNi/QuHiXklCVxDwFyvcvVEDv9FWaA3a27PRbjmPn99Q9dw4X4ZUXQUdb5B4tuqdb4Q057UcPHTeRu7ntDPtdhXlyXGzhFUUfl/8DcLgcfN4l671kJ5QCJWvZ1u8W7aCVzE0df/EqUzXvMZyxhRW3aJSfjqHsYjFejqLXOA/kviQg48UvX/cfd3TcsFqmW/q0EUXamhQjvz6ow19C3x1cg/pLC+TYmCeAe4UGfjnUIgiib/ThkNscMJcRm6WU0pPuQtKLyoUcuXqbMoSO60GqhBT78E91mhrkchXny/YcMWjemntdxQMSWTkKRy1JnHLKaW+BTeabtPN/emuqpUXQLq4NHM05/6XXsjyRM/dd4BSV9IAoEspHQStZPu7GEhhOVWtHLsiNQ11tNIiC3kPquEyHLpzvW3rs1gAk+Bf93igTKZtgx4OsIndJJ2K28w9gpZbeZwsadoH9gmy6/jZiZQxY/9iuB405ijngNvcsCEwv0InDunDhJh2z9xCy/R8dPN46hIgmrS0hJ4IkJ7zTZOFAUWk1QiVnD8jUhEeROKD3f/y3y3fVvEPoVpxYU64u+5PxcBY9KJDYvyfWy1roUe2geciY8lBOMytbRj+cdrJB1ZNYQQ+rKSxL+N3WQHnB1jPTpb0ZIK8QTYu4qcWrfHifZlyzH/PYyUp79DKkly1MR1hSdzgrMfw4wQ6qxt6dNqsACylrOqxBQDpTg2e9UXEtnis4EkqFBwfM5bOQMkBDewkfzjxHdvYxS6AULpl4UJ0g98GX6VknIo/8m8lcTTo+exSER1i5hLwKky/g2srPwFpjAP2wELuLSvj2yqN+F9etxNVgLACJqGrXjgksKwm4U1cc/c29cg3SesAEY/5vaNi5V7lfeJyqZ/i+lpJ9o7rQJp1/8umRFYUvau22q9Yxavn8P9jiw/QgH52ukWf/aVBqDtqYUy06QfMaXtASkDlho0InzzN7X/gEnAE0q2fLeavajOZvBzm2slVGKU45rbQAeVIyQoQBat5tv49QJNXFP/H328lXDke7ngSeHAw6WhHTcNR5edJAzlqz7konajW0OnzKhSVLOt9hz8LVMO5kqQSsZIg+UMKtZvUqt5cshGIqmVOfcTSkcWFmDEqYcxRHDoMluE26OJ6s7CeS0EJtovQxzL277fA96c2P1a8Gt50uktMerKUdqOxwOHQET21nGJUPlSdhPpK0SDL/0kOCAwQcG+u8MKy8B/WfVoNiipUOQBJsQ+0KEHdgBqby1jooVm7SvNgT21WkF6SzEVvK8NJFvC1zvj6+tNgVEiUCkaACSiWIImatByOsDBPGPzO0SyGqQGTOT/EOLbGE6Dp1eLAVyL+GahUwtAZyVfktY+9IbXrQLzLZIIF2YEswKMUbcYnOjTIKAkWoiC0t7QkBbmUEBGUEkFkvroMWZhzY5NI+vyGY6Lz+cTGMyeXcGJA8vN6VF8S9W5flHyLSubBX3TVA04UVdp8S00KgB52RQZs4XnNNDljSeqXf/813R2hOEg+2XXL5YtKIZXT3thTeWc7cBCa9Gmgiwz8nWG/9lxsxgg+dUT2xwdpK3WsLtVIQc2/jt3R3lPXFQtjh0nzC6w47w2DizaP41Ifv99wd3HDNQ5GaPJ9V+Xio7wKio2tAszc5sy5SW120MuNDHoXfs+Kbh0WRkHVjSZaWydYyW7IQKNgAylNuCTvCxF8D+HlpEg0SEiqwdjEqfuNRKAOudH1Gw0WOu/+dqg1+9m/7UCLLel31btkboBZ5RGlbD7dxdUK0ey9fnKe2ZrPfGQv3dQ9wo21duZtUpQHC1mjKZBWf3utHpU2h6YH50UA/rSxQolRpMZW9joTYrYWYPxvcrr1VtDe5qBccc3Wsz76TuGiBWjn1hmBWYALOrjry4RVA+Um98X7cymeGHX/Z8bQEE4KTKkK0x++92n042Gu+DvXEffgGbDzo3t3JeFHV+BgYQc86WB2yrtjm/k0ZGdQqy5uIzPIMlFf7d6FeQm9EJX9H9bWbXofK1W66wU6y0ssT0KyGpO8wSu+osw2wAbpbS/RNOdDQQ7n/dMu2IL8osJI4me0cPJmieGsv1o9CPY6Xf9CEkVq9JSMhfT2mPmK/cTXEBdLgI0iOpMULra9w/11Kdju3NtXGwenVetcoSfUc0lILTbRHbU5wIkOjQPORk8sqYmW4D4JU1uCWzCLFQxbBOpcheBUoiZTkWoSNOkJHohHedz3HCWRee33RjalfyoKb0sUppWB0k90Mizmw4QoPhxarflyQ3Z5H0tJcqulrakMOYK+Dbj5hNeNaz3wjm9FoLpvHQ0VqTiE4B/FDi9NiktedXQcE3FkBZsrF0LwiGCvzDkbnSiyNH83MgtaZFAHQZEbin2XuYqo3MAXK1tbIEYpBvgMSkVTpzd1WW4OFKRai9DOs0OqHKo/OnuQTRTWekNU1Z4F4+016AIMD61rRec3q0G2iI6DVySAn3DFLpQadZVndbDz9z1Xx8C4ALS+BGxvzlkO+9MFECXdwKBl+NQOuOWAwiWaGz+fCuISVgjwURsjFLZuZde+YcqPp1YcG9eULghXrwkNVKAZ86PF1wqSZ1DWUMVR+oVMZjZC5t9SRyEKyZ++5ZKHoFzmijl4BXMyCak0ym07PzCKz9MpW/8Xz28VDrBvhBAZ3A5NESJxKqApE7ss0sEEs7TCWRRXzayt3RS2v3+/ohgXjSLefGDdJiZNWwusyPqzrXm7v7w63tWJiONTLBB+IMU9ZmyG9/C32FdigL2I2LJ6OD/23F78q98VFuL9wfUQlblUMHpBc4FlduHO6gABtr4S4caFaZ7Q5pBfOO1lSNekh3QTp+PBxlLj2S0icyGFCyK5QgC6f5JhUUIiQyHVpBe7bWWcFMOqfX4Ti19opF0xy2//qU+/sXvEkqf+0OUvUK1ZN+4JnmzAKcTp8qz7RKKEpF2FRgH+/8KujVCH5pkMy5I+Gewy4wr9eGGaviCv+Dd6NnvDKfMTnJMpApnY/250qLskIrs4daVa57oSsr4CTWb9p/xvCcqkh9BUTxKZ4LISQ0pRQdmdhAWKqE3Td9Z9TLu2pzfbNvoTc2CpAOhR00yfT5Npq5DaTWcSOwUhojzIuY8wWIDnQaTamRsHtoYTi3dnds9LXptSzCSA3zsvxuSrd0JGjBiAOylInYnIX8RFnngSK2W7aCh1k80L18InQnkAzb0pv+AkmLzrujbbMH15UmGJFH0ZAWAM+CezhQO8FL/bMl1CVzpjP7KtSh3Bv908EAULBjNT1Sj32qkqaoP0lGwXsIptcCN6ega5JfFsalTjj77mfTK5dPFQNELqChYZ21xr+zhX42yRb0KOg9rXswzrp8ZCWqKIdtIdUX2PKVgdNQCto4iAGpLmyjb9NfsVwPGnMUc8Bt7lgQmF+hE4lfsxsKfMySX2dWYDYrdAXWOgZiHX3qL0wfDIKItYFJb7a36M07e5KVVNa9QXj6YGPvqnYGxBPrKeQIj5MaUTH7e9CBURCHjyumZkvaEUkgReADp2wu26lT+UMgpFxGOSeMa3dAHfe8+V6dAXG+vOzTOE4wT23W6xIfrHseFfyNKEoz23bttTOihUN5zTZfccIP/C8jWqJkByQOL6TqgJbqPwaan1UU91/5g/VErSkYICnsNiMhX2J8OD4fFuHf5Q+6WNKk/5t4NVmnoAk6r9eM0ao+nV0LoWuiF1sCuFuuPmsAOC+hPuEPL95cgkiegKSbrWCsUOE4FcI+unh9KxT+XDvVb2PLfsPsMtyTFCHCdmX+FuiZYKSkUazhtbbjtRTJ3h8JrxBK0AzkIOXwN1bmPet8lZMuNF7XsQXomD7/pTVTrwsBRfk/sq3uo6MVhkFJt9lGhN8SxJ4uOHY6o6pDASu2XayDiV0C0oW+9dMURk+Zi3BOcVhQc3D9HyJPqyyhVzl5l4z/snqm7Pq3OatkWzS8rAiS3dd5ORM/srvyvNv3ixiq26PlVO9YtSzyFGAGT2PUc4qDCFzv/0AGeKgnHLXfdpupRsaj4eGCU+hC/UWn3yoQBtz3DLiOQgKeyobrXQZRIkcJccOmLPeyf4lB0V8C1XJm5XhevttaflXqqVGknBq0lukF8ft4794y6Su7vzvE3ZDF0zOEZ343+6zpVFE02lzSU97T7e6fgxxNhOhESGfse+jch0ZTk8q8zWPa/N3d1iN9PlQOez0WUpIt5B3kt+xZsuFa+an6TJ2XxaD0ULTLnDlSS0L6DVpOv6JMlQz0u89kVKfHzkgCNKqQHx5zUwyZkGVdw3RWZDZKzyVM0/ve7E9mViWrchLTVzM+R25xm4WwOo06pq3k2+BRSjp/0Ybr93qVeff6YQkVk2is0F/6cJYVX/F2maC0WaQHpRPzSF+qy3qamVZlmbz57nkYULnZAtbyhUntrJYTFbpBFdrGm8yc25nLHs6di/zw6mdhAWKqI/Yk+ndVtgZaElUE1YVxFAwtRKZ2MfDqKrPuDc0gVXNz1r1vHaWQUzoelOxQtoZPN0YrG978RobFGb+gAAAAAkT3sCi+xoa7nFyVK36KBKgjzOzfx9fCNqkMyTX44NpInfOXxOE/D6xV/aTrGfmeqCp4JF6P+Z7CF41aTEwmZkQzzACPFMSMPYsKtiphdDFYCrmwbJyMR9iJDuTG6I3Cp1hhJYqMUJ51Jf4KoQRzqOVgzHZF9wioOP6WYznWUF8EIVpf/JTs5GZcJt8BfJTyV6gkKsqL72ai5euI+/89hHOlrFGu3WSDS5Qe+Y8ELSZP+P6XazYwNBnmATqo40JG747N5vAd6Iyhd4851MFhU6z390kpzYTYuh/qa1hGvTBbF0AV3CFYVJMWvgWBGFGNDT795PwsSb9AbyMh+hmgvc65/R3MISTnkr2QieT+56jlp8n6DT/glidtrrcOJZ1sa1m7Z55QKmEphJVTeUPMDKQTtUqMgHnfcewIgGx7pRtvxwVEj4CQLr9xtAzyZHvKT9K6t1h+L0TQ7KX3cCHAJPuazkHOhsZGWZ3zstNnXLMcSnhDwLePVHiOLsLeWwPZBlTqZppdP8yJ7NlKbl5SzJTF/ed3Wkr9vpLtNjNPxMfALIswm/CzF1Et/413MObbz64QYGDyiMc17EUsPC0k8caPC8AhU4zocGMdn6lBboBPjgCLbhrqhtKKFRkz+MWNS7HRNRCxP+lM4VyNjNijvpioyYIAsE0jxLdwqyKXAM4f46FvLUifvBT9ArhGohxWVN30e3aGVNl/huPbe++UqLYOf/vu+RL9h+0HfILHOPlxMccWbA1ehDRpQO9QAvWGW0rIkQYqbhYPuIo1LFRVS9NAgQtUG7j50XpfR8n5BXrYJABDt4mU+zVkTw+hjFw/KQwi6+TyqE2XoRMOZSy+CD4b9p5T23/3XmZPvO0wBB+2AcqcwDRiF22HK+bL7v7gx1q4fcnILZfy2dYOg3BmiOxx11ygAJvqo7/rdhBh+rHjQt7qUzvam1eU+4W35BU3L8UQnvNPb+cOfea9pXWYxeiqYuunOGn6+KObccAKA1C/9meZsZPIVNHwmy8/E2pMNCW3GvaqGZhYobyKZ0+6vBswGMQI0b7LN42Io0tZOwR+b75crsXbbn4UlMXy1ujxBPVdg7Z28jtD2C2yaE7Jr/paVnNyQEONO6PU7O9VLgez/Hj9cmyN/pKNXngkntX8QFdap/rh+WOf8vg6dFl+vPvJHm4zcKXUwOwAAAAAAg6dumZHAxEBdAAAAAAAAAATBZxzfblXCj1iRdqoBOT2JJDZWfenIehU6t2/pYu0LFplLXc+l7U97htlLdF9WumD9ZlzeRHmqZyMI5/yAm8HKGnpaUo7lWph/dKbrXSuIQtjld35XFQOPI87x/9i/9hsZSdvbQ5vkVm+quWnV9UG6jADT5JvAO5IEbJkrqPnhqtb4ov+MnTcU9FsDRd/dWhQibp3noOFUU7kqrfQouV9jo6sMdd2nZVt3Lfy6kJA59/M10DixS80bk9UcFZKCeBLuFnBr/x9eKWAtbEETp3/EDHhRnzVWrrSId511L5kqEKBLroi/fNJjwTDFMEXTp89gJvUC/Lkos5Xt9W2A9mCz8oUyBxAtmMGpG5hVXP/NMAe4bTwbzhvXicqOzZJA9YE3DW2qGUCqh6zuzhQdvm6Nd2f62PLZJXioNbhHq7jCybOk5UEmKIAlOD2SIUlMe463GX7zjPXa29NI8Pik8P1N56s4uJaYB8xyEx7c9RvfcqVrBIVi7e0F9cixbgsqoAAByJeAdFAZZAHL0BPtCCTbzgWNc2LhnJ/FdLa9jioxB3XHoaQMSi/hZG5V9jTSuyNsTOIV+Fg9TK1/ZTxNHDk2TsvQAX5/aHp3jFZ/R4qLIX7CgH9yG2+lk00RrDiqPnXKAQ0fdp+FQgXweaupARIePOwox+dHQMOGDgis0kg+W9S1aIb5keVsC3mRWwtLEfp4mYJQUatmSAQMce3MBtBz32KBSpsCsKovm03lYoK97BHq1B129i5zWnQaafuyexufRIofBNCc3AsfOlSxfM1y/wDDiF8hvzN1i9SAq1ueD8ZbEIUlZsXjlAzJ+i7GEhmrc83uLHm637YXgvi9cwzH21oKHh7M4imcW8xMv3mnFQc53cgk7qJPrhCqkEV0hevVd0+84LKu4gDQN/RruJKUatuphqK7Sg6YkrgsA4fdfkRjpRmsomU1x4yPkH5uKVqnSNQy4QNOpEZFkDneWiuFHmclmrr7jo/+Ig385fnR6Rcbf6YCfXjOvU1DQPVwW68Xsn3oooMlhtznoKA1R40uz3lhgaCRTaFqcAAJUUqsdAAA)

感知哈希算法
------

关于 “感知哈希算法” 的详细介绍，可以参考这篇文章：[《基于感知哈希算法的视觉目标跟踪》](https://link.juejin.cn?target=https%3A%2F%2Fblog.csdn.net%2Fzouxy09%2Farticle%2Fdetails%2F17471401 "https://blog.csdn.net/zouxy09/article/details/17471401")。

> ![](https://user-images.githubusercontent.com/12172868/70492629-042aeb80-1b40-11ea-9ca9-b5e8235c1151.png)

简单来说，该算法经过离散余弦变换以后，把图像从像素域转化到了频率域，而携带了有效信息的低频成分会集中在 DCT 矩阵的左上角，因此我们可以利用这个特性提取图片的特征。

该算法的步骤如下：

> *   缩小尺寸：pHash 以小图片开始，但图片大于 8_8，32_32 是最好的。这样做的目的是简化了 DCT 的计算，而不是减小频率。
> *   简化色彩：将图片转化成灰度图像，进一步简化计算量。
> *   计算 DCT：计算图片的 DCT 变换，得到 32*32 的 DCT 系数矩阵。
> *   缩小 DCT：虽然 DCT 的结果是 32_32 大小的矩阵，但我们只要保留左上角的 8_8 的矩阵，这部分呈现了图片中的最低频率。
> *   计算平均值：如同均值哈希一样，计算 DCT 的均值。
> *   计算 hash 值：这是最主要的一步，根据 8*8 的 DCT 矩阵，设置 0 或 1 的 64 位的 hash 值，大于等于 DCT 均值的设为”1”，小于 DCT 均值的设为 “0”。组合在一起，就构成了一个 64 位的整数，这就是这张图片的指纹。

回到代码中，首先添加一个 DCT 方法：

```
function memoizeCosines (N: number, cosMap: any) {
  cosMap = cosMap || {}
  cosMap[N] = new Array(N * N)

  let PI_N = Math.PI / N

  for (let k = 0; k < N; k++) {
    for (let n = 0; n < N; n++) {
      cosMap[N][n + (k * N)] = Math.cos(PI_N * (n + 0.5) * k)
    }
  }
  return cosMap
}

function dct (signal: number[], scale: number = 2) {
  let L = signal.length
  let cosMap: any = null

  if (!cosMap || !cosMap[L]) {
    cosMap = memoizeCosines(L, cosMap)
  }

  let coefficients = signal.map(function () { return 0 })

  return coefficients.map(function (_, ix) {
    return scale * signal.reduce(function (prev, cur, index) {
      return prev + (cur * cosMap[L][index + (ix * L)])
    }, 0)
  })
}
复制代码

```

然后添加两个矩阵处理方法，分别是把经过 DCT 方法生成的一维数组升维成二维数组（矩阵），以及从矩阵中获取其 “左上角” 内容。

```
// 一维数组升维
function createMatrix (arr: number[]) {
  const length = arr.length
  const matrixWidth = Math.sqrt(length)
  const matrix = []
  for (let i = 0; i < matrixWidth; i++) {
    const _temp = arr.slice(i * matrixWidth, i * matrixWidth + matrixWidth)
    matrix.push(_temp)
  }
  return matrix
}

// 从矩阵中获取其“左上角”大小为 range × range 的内容
function getMatrixRange (matrix: number[][], range: number = 1) {
  const rangeMatrix = []
  for (let i = 0; i < range; i++) {
    for (let j = 0; j < range; j++) {
      rangeMatrix.push(matrix[i][j])
    }
  }
  return rangeMatrix
}
复制代码

```

复用之前在 “平均哈希算法” 中所写的灰度图转化函数`createGrayscale()`，我们可以获取 “感知哈希算法” 的特征值：

```
export function getPHashFingerprint (imgData: ImageData) {
  const dctData = dct(imgData.data as any)
  const dctMatrix = createMatrix(dctData)
  const rangeMatrix = getMatrixRange(dctMatrix, dctMatrix.length / 8)
  const rangeAve = rangeMatrix.reduce((pre, cur) => pre + cur, 0) / rangeMatrix.length
  return rangeMatrix.map(val => (val >= rangeAve ? 1 : 0)).join('')
}
复制代码

```

![](https://user-images.githubusercontent.com/12172868/70492972-30933780-1b41-11ea-9e84-66a6b97e9f1b.png)

颜色分布法
-----

首先摘抄一段阮大关于 “颜色分布法 “的描述：

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9856ce53c6b0~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

阮大把 256 种颜色取值简化成了 4 种。基于这个原理，我们在进行颜色分布法的算法设计时，可以把这个区间的划分设置为可修改的，唯一的要求就是区间的数量必须能够被 256 整除。算法如下：

```
// 划分颜色区间，默认区间数目为4个
// 把256种颜色取值简化为4种
export function simplifyColorData (imgData: ImageData, zoneAmount: number = 4) {
  const colorZoneDataList: number[] = []
  const zoneStep = 256 / zoneAmount
  const zoneBorder = [0] // 区间边界
  for (let i = 1; i <= zoneAmount; i++) {
    zoneBorder.push(zoneStep * i - 1)
  }
  imgData.data.forEach((data, index) => {
    if ((index + 1) % 4 !== 0) {
      for (let i = 0; i < zoneBorder.length; i++) {
        if (data > zoneBorder[i] && data <= zoneBorder[i + 1]) {
          data = i
        }
      }
    }
    colorZoneDataList.push(data)
  })
  return colorZoneDataList
}
复制代码

```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9856c8428b52~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

把颜色取值进行简化以后，就可以把它们归类到不同的分组里面去：

```
export function seperateListToColorZone (simplifiedDataList: number[]) {
  const zonedList: string[] = []
  let tempZone: number[] = []
  simplifiedDataList.forEach((data, index) => {
    if ((index + 1) % 4 !== 0) {
      tempZone.push(data)
    } else {
      zonedList.push(JSON.stringify(tempZone))
      tempZone = []
    }
  })
  return zonedList
}
复制代码

```

最后只需要统计每个相同的分组的总数即可：

```
export function getFingerprint (zonedList: string[], zoneAmount: number = 16) {
  const colorSeperateMap: {
    [key: string]: number
  } = {}
  for (let i = 0; i < zoneAmount; i++) {
    for (let j = 0; j < zoneAmount; j++) {
      for (let k = 0; k < zoneAmount; k++) {
        colorSeperateMap[JSON.stringify([i, j, k])] = 0
      }
    }
  }
  zonedList.forEach(zone => {
    colorSeperateMap[zone]++
  })
  return Object.values(colorSeperateMap)
}
复制代码

```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9857a39e12d5~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

内容特征法
-----

”内容特征法 “是指把图片转化为灰度图后再转化为” 二值图 “，然后根据像素的取值（黑或白）形成指纹后进行比对的方法。这种算法的核心是找到一个“阈值” 去生成二值图。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee98577fc206bc~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

对于生成灰度图，有别于在 “平均哈希算法” 中提到的取 RGB 均值的办法，在这里我们使用加权的方式去实现。为什么要这么做呢？这里涉及到颜色学的一些概念。

具体可以参考这篇[《Grayscale to RGB Conversion》](https://link.juejin.cn?target=https%3A%2F%2Fwww.tutorialspoint.com%2Fdip%2Fgrayscale_to_rgb_conversion.htm "https://www.tutorialspoint.com/dip/grayscale_to_rgb_conversion.htm")，下面简单梳理一下。

采用 RGB 均值的灰度图是最简单的一种办法，但是它忽略了红、绿、蓝三种颜色的波长以及对整体图像的影响。以下面图为示例，如果直接取得 RGB 的均值作为灰度，那么处理后的灰度图整体来说会偏暗，对后续生成二值图会产生较大的干扰。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee98579be1f301~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

那么怎么改善这种情况呢？答案就是为 RGB 三种颜色添加不同的权重。鉴于红光有着更长的波长，而绿光波长更短且对视觉的刺激相对更小，所以我们要有意地减小红光的权重而提升绿光的权重。经过统计，比较好的权重配比是 R:G:B = 0.299:0.587:0.114。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9857c1fbd80c~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

于是我们可以得到灰度处理函数：

```
enum GrayscaleWeight {
  R = .299,
  G = .587,
  B = .114
}

function toGray (imgData: ImageData) {
  const grayData = []
  const data = imgData.data

  for (let i = 0; i < data.length; i += 4) {
    const gray = ~~(data[i] * GrayscaleWeight.R + data[i + 1] * GrayscaleWeight.G + data[i + 2] * GrayscaleWeight.B)
    data[i] = data[i + 1] = data[i + 2] = gray
    grayData.push(gray)
  }

  return grayData
}
复制代码

```

上述函数返回一个 `grayData` 数组，里面**每个元素代表一个像素的灰度值**（因为 RBG 取值相同，所以只需要一个值即可）。接下来则使用 “大津法”（Otsu's method）去计算二值图的阈值。关于 “大津法”，阮大的文章已经说得很详细，在这里就不展开了。我在[这个地方](https://link.juejin.cn?target=http%3A%2F%2Fwww.labbookpages.co.uk%2Fsoftware%2FimgProc%2FotsuThreshold.html "http://www.labbookpages.co.uk/software/imgProc/otsuThreshold.html")找到了 “大津法” 的 Java 实现，后来稍作修改，把它改为了 js 版本：

```
/ OTSU algorithm
// rewrite from http://www.labbookpages.co.uk/software/imgProc/otsuThreshold.html
export function OTSUAlgorithm (imgData: ImageData) {
  const grayData = toGray(imgData)
  let ptr = 0
  let histData = Array(256).fill(0)
  let total = grayData.length

  while (ptr < total) {
    let h = 0xFF & grayData[ptr++]
    histData[h]++
  }

  let sum = 0
  for (let i = 0; i < 256; i++) {
    sum += i * histData[i]
  }

  let wB = 0
  let wF = 0
  let sumB = 0
  let varMax = 0
  let threshold = 0

  for (let t = 0; t < 256; t++) {
    wB += histData[t]
    if (wB === 0) continue
    wF = total - wB
    if (wF === 0) break

    sumB += t * histData[t]

    let mB = sumB / wB
    let mF = (sum - sumB) / wF

    let varBetween = wB * wF * (mB - mF) ** 2

    if (varBetween > varMax) {
      varMax = varBetween
      threshold = t
    }
  }

  return threshold
}
复制代码

```

`OTSUAlgorithm()` 函数接收一个 `ImageData` 对象，经过上一步的 `toGray()` 方法获取到灰度值列表以后，根据 “大津法” 算出最佳阈值然后返回。接下来使用这个阈值对原图进行处理，即可获取二值图。

```
export function binaryzation (imgData: ImageData, threshold: number) {
  const canvas = document.createElement('canvas')
  const ctx = canvas.getContext('2d')
  const imgWidth = Math.sqrt(imgData.data.length / 4)
  const newImageData = ctx?.createImageData(imgWidth, imgWidth) as ImageData
  for (let i = 0; i < imgData.data.length; i += 4) {
    let R = imgData.data[i]
    let G = imgData.data[i + 1]
    let B = imgData.data[i + 2]
    let Alpha = imgData.data[i + 3]
    let sum = (R + G + B) / 3

    newImageData.data[i] = sum > threshold ? 255 : 0
    newImageData.data[i + 1] = sum > threshold ? 255 : 0
    newImageData.data[i + 2] = sum > threshold ? 255 : 0
    newImageData.data[i + 3] = Alpha
  }
  return newImageData
}
复制代码

```

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee985823d17c19~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

若图片大小为 N×N，根据二值图 “非黑即白” 的特性，我们便可以得到一个 N×N 的 0-1 矩阵，也就是指纹：

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9858264c76b0~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

特征比对算法
======

经过不同的方式取得不同类型的图片指纹（特征）以后，应该怎么去比对呢？这里将介绍三种比对算法，然后分析这几种算法都适用于哪些情况。

汉明距离
----

摘一段维基百科关于 “汉明距离” 的描述：

> 在信息论中，两个等长字符串之间的汉明距离（英语：Hamming distance）是两个字符串对应位置的不同字符的个数。换句话说，它就是将一个字符串变换成另外一个字符串所需要_替换_的字符个数。
> 
> 例如：
> 
> *   1011101 与 1001001 之间的汉明距离是 2。
>     
> *   2143896 与 2233796 之间的汉明距离是 3。
>     
> *   "toned" 与 "roses" 之间的汉明距离是 3。
>     

明白了含义以后，我们可以写出计算汉明距离的方法：

```
export function hammingDistance (str1: string, str2: string) {
  let distance = 0
  const str1Arr = str1.split('')
  const str2Arr = str2.split('')
  str1Arr.forEach((letter, index) => {
    if (letter !== str2Arr[index]) {
      distance++
    }
  })
  return distance
}
复制代码

```

使用这个 `hammingDistance()` 方法，来验证下维基百科上的例子：

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee98586190f51e~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

验证结果符合预期。

知道了汉明距离，也就可以知道两个等长字符串之间的相似度了（汉明距离越小，相似度越大）：

```
相似度 = (字符串长度 - 汉明距离) / 字符串长度
复制代码

```

余弦相似度
-----

从维基百科中我们可以了解到关于余弦相似度的定义：

> 余弦相似性通过测量两个向量的夹角的余弦值来度量它们之间的相似性。0 度角的余弦值是 1，而其他任何角度的余弦值都不大于 1；并且其最小值是 - 1。从而两个向量之间的角度的余弦值确定两个向量是否大致指向相同的方向。两个向量有相同的指向时，余弦相似度的值为 1；两个向量夹角为 90° 时，余弦相似度的值为 0；两个向量指向完全相反的方向时，余弦相似度的值为 - 1。这结果是与向量的长度无关的，仅仅与向量的指向方向相关。余弦相似度通常用于正空间，因此给出的值为 0 到 1 之间。
> 
> 注意这上下界对任何维度的向量空间中都适用，而且余弦相似性最常用于高维正空间。
> 
> ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9858e29185d2~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

余弦相似度可以计算出两个向量之间的夹角，从而很直观地表示两个向量在方向上是否相似，这对于计算两个 N×N 的 0-1 矩阵的相似度来说非常有用。根据余弦相似度的公式，我们可以把它的 js 实现写出来：

```
export function cosineSimilarity (sampleFingerprint: number[], targetFingerprint: number[]) {
  // cosθ = ∑n, i=1(Ai × Bi) / (√∑n, i=1(Ai)^2) × (√∑n, i=1(Bi)^2) = A · B / |A| × |B|
  const length = sampleFingerprint.length
  let innerProduct = 0
  for (let i = 0; i < length; i++) {
    innerProduct += sampleFingerprint[i] * targetFingerprint[i]
  }
  let vecA = 0
  let vecB = 0
  for (let i = 0; i < length; i++) {
    vecA += sampleFingerprint[i] ** 2
    vecB += targetFingerprint[i] ** 2
  }
  const outerProduct = Math.sqrt(vecA) * Math.sqrt(vecB)
  return innerProduct / outerProduct
}

复制代码

```

两种比对算法的适用场景
-----------

明白了 “汉明距离” 和“余弦相似度”这两种特征比对算法以后，我们就要去看看它们分别适用于哪些特征提取算法的场景。

首先来看 “颜色分布法”。在“颜色分布法” 里面，我们把一张图的颜色进行区间划分，通过统计不同颜色区间的数量来获取特征，那么这里的特征值就和 “数量” 有关，也就是非 0-1 矩阵。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9857a39e12d5~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

显然，要比较两个 “颜色分布法” 特征的相似度，“汉明距离”是不适用的，只能通过 “余弦相似度” 来进行计算。

接下来看 “平均哈希算法” 和“内容特征法”。从结果来说，这两种特征提取算法都能获得一个 N×N 的 0-1 矩阵，且矩阵内元素的值和 “数量” 无关，只有 0-1 之分。所以它们同时适用于通过 “汉明距离” 和“余弦相似度”来计算相似度。

![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee98593ad8ba8f~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

计算精度
====

明白了如何提取图片的特征以及如何进行比对以后，最重要的就是要了解它们对于相似度的计算精度。

本文所讲的相似度仅仅是通过客观的算法来实现，而判断两张图片 “像不像” 却是一个很主观的问题。于是我写了一个简单的服务，可以自行把两张图按照不同的算法和精度去计算相似度：

[img-compare.netlify.com/](https://link.juejin.cn?target=https%3A%2F%2Fimg-compare.netlify.com%2F "https://img-compare.netlify.com/")

经过对不同素材的多方比对，我得出了下列几个**非常主观**的结论。

*   对于两张颜色较为丰富，细节较多的图片来说，“颜色分布法” 的计算结果是最符合直觉的。 ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9ceaf26e5aa3~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)
*   对于两张内容相近但颜色差异较大的图片来说，“内容特征法”和 “平均 / 感知哈希算法” 都能得到符合直觉的结果。 ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9ceb35b328b2~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)
*   针对 “颜色分布法 “，区间的划分数量对计算结果影响较大，选择合适的区间很重要。 ![](https://p1-jj.byteimg.com/tos-cn-i-t2oaga2asx/gold-user-assets/2019/12/9/16ee9ceb3a495e1b~tplv-t2oaga2asx-zoom-in-crop-mark:3024:0:0:0.awebp)

总结一下，三种特征提取算法和两种特征比对算法各有优劣，在实际应用中应该针对不同的情况灵活选用。

总结
==

本文是在拜读阮一峰的两篇[《相似图片搜索的原理》](https://link.juejin.cn?target=http%3A%2F%2Fwww.ruanyifeng.com%2Fblog%2F2011%2F07%2Fprinciple_of_similar_image_search.html "http://www.ruanyifeng.com/blog/2011/07/principle_of_similar_image_search.html")之后，经过自己的实践总结以后而成。由于对色彩、数学等领域的了解只停留在浅显的层面，文章难免有谬误之处，如果有发现表述得不正确的地方，欢迎留言指出，我会及时予以更正。