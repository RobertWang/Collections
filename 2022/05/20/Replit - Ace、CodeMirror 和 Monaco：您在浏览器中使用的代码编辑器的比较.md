> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [blog.replit.com](https://blog.replit.com/code-editors)

> 我已经在 Replit 上工作了大约六年，随着团队的壮大，我一直专注于......

我已经在 Replit 上工作了大约六年，随着团队的发展，我一直专注于产品的 IDE（我们称之为工作区）部分。自然，我越来越专注于代码编辑器。虽然我们考虑过创建一个满足我们需求的代码编辑器，但开发它所涉及的复杂性、可用的开源选择的丰富性以及我们员工的规模使其成为一个徒劳的兔子洞。我们的时间最好花在别处。我很高兴（也很痛苦）在生产环境中使用[Ace](https://ace.c9.io/)、[Monaco](https://microsoft.github.io/monaco-editor/)和[CodeMirror](https://codemirror.net/6/)，有时是同时使用（稍后会详细介绍）。在这篇文章中，我将回顾一些 Replit 历史、我使用编辑器的经验，以及它们如何相互叠加。

_如果您在这里进行直接比较，请随时[跳到最后](#head-to-head)，我在这里回顾和比较。_

故事
--

### 前奏：艾斯

在 Replit 的早期，大约在 2011 年左右，没有代码编辑器。它是一个纯粹的[REPL](https://en.wikipedia.org/wiki/Read%E2%80%93eval%E2%80%93print_loop)界面，一个带有简单输入框的控制台。添加代码编辑器显然是下一步，尤其是当我们迎合更复杂的程序时。代码编辑器为我们提供了语法高亮、编辑器快捷方式、自动缩进、搜索和替换等功能。当时，Cloud9 发布了 Ace 作为功能齐全、高性能的 Web 代码编辑器。Ace 编辑器仍在积极维护中；它拥有丰富的生态系统，支持多种语言、键绑定，并且在浏览器中运行良好。

![](https://blog.replit.com/images/code-editors/repl-dot-it.png) _使用 Ace 的原始 replit 界面的屏幕截图。感谢我们的社区成员，他们从 2011 年起重新托管了 Replit 的开源版本[https://www.repldotit.com/](https://www.repldotit.com/)_

我们一直使用 Ace，直到 2017 年底左右我们切换到摩纳哥。虽然 Ace 仍在维护中，但只有一个人在处理它。在亚马逊收购 Cloud9 之后，似乎他们降低了开源项目的优先级。编辑器没有收到那么多更新，GitHub 上的问题堆积如山，维护者几乎没有添加任何功能。总体而言，API 开始显得过时和笨拙。维护者很棒，但他能做的只有这么多。

### 插曲：摩纳哥

您可能知道，Monaco 是支持 VSCode 的编辑器。事实上，微软围绕摩纳哥构建了 VSCode。如果我们切换到 Monaco，我们认为我们能够从 VSCode 的优秀人员那里获得所有很酷的更新和功能。Monaco 有一个闪亮而现代的 UI，与我们的网站更好地匹配，对 JavaScript、HTML、CSS 有很好的自动完成功能，并且似乎有 API 可以更轻松地为 LSP 编写语言客户端。文档很棒，附带 TypeScript 定义，并且从开发的角度来看具有更多的可扩展性功能。

![](https://blog.replit.com/images/code-editors/monaco.png) _库存 Monaco 的屏幕截图（无配置），注意干净和优美的 UI_

切换是有代价的，它缺少很多 Ace 的功能，但我们相信它会在社区的兴奋和贡献下很快超越 Ace。第一个问题是摩纳哥缺少很多语言模式；即使 VSCode 拥有它们，它们也依赖于在 Nodejs/Electron 中运行，而不是在浏览器中运行。因此，我们开始为 Monaco 编写语言模式并回馈该项目。我们添加了 Scala、Julia、Scheme、Clojure，并修复了 Python 等各种语言的错误。我为 Monaco 编写了一个语法荧光笔，以通过适配器利用 Ace 支持的所有语言。最后两个缺失的部分是 Vim 和 Emacs 的键绑定，但不久之后有人在 npm 上发布了对它们的支持。

Monaco 的另一个问题是构建工具。虽然 Microsoft 使用 Web 技术构建 Monaco，但它并没有很好地融入生态系统和构建 Web 工具。我必须将 Monaco 预编译为 Webpack DLL 并添加许多 Webpack 配置以使其工作。添加起来非常痛苦，它增加了我们构建系统的复杂性和开销。几个月后，微软发布了一个用于 Monaco 的 Webpack 插件，这使它稍微好一点，但并不完美，尤其是当我们将前端移至 Next.js 时。不幸的是，摩纳哥也没有一种简单的方法来延迟加载模块和进行代码拆分，因此很难获得小包大小。它为我们的工作空间包增加了高达 5 兆字节（未压缩），这不是我们掉以轻心的事情。

摩纳哥在移动设备上也不能很好地工作。我们试图与人们签订合同以使其发挥作用，但没有人咬人。然后我想自己做，那时我才恍然大悟，很难驾驭摩纳哥代码库。它与 VSCode 代码库的其余部分交织在一起，而且包本身几乎就像是事后才想到的。甚至 VSCode 代码库本身也不是特别好，它可能[是最古老的 TypeScript 项目之一](https://web.archive.org/web/20150502200822/https://www.zdnet.com/article/microsofts-browser-based-dev-toolbox-how-monaco-came-to-be/)，它是用[微软企业风格编写的](https://www.youtube.com/watch?v=FyCYva9DhsI). 虽然我们确实得到了一些在移动设备上半可用的东西，但我们不想维护一个 VSCode 的分支，因为我们所做的更改不会被上游接受，而且距离在生产中可用还有很长的路要走。所以我决定最好的前进道路是继续在移动设备上使用 Ace。它也不完美，但还可以。

因此，我们在 Replit 上使用了两个代码编辑器：一个用于台式计算机，一个用于移动设备。每个新功能都必须移植到 Ace（移动）。我们必须为 Ace 编写一个用于 LSP 功能的语言客户端，我们必须为 Ace 编写一个操作转换适配器以支持多人游戏，等等。在很多情况下，我们不仅仅是没有时间移植东西。例如，我们从未将代码线程功能移植到移动设备上。

### 后奏曲：CodeMirror

2018 年底，Marijn 宣布[重写 CodeMirror](https://web.archive.org/web/20180830201622/https://codemirror.net/6/)以使编辑器现代化，CodeMirror 版本 6 具有[出色的设计文档](https://web.archive.org/web/20181109055050/https://codemirror.net/6/design.html)。重写的主要动机之一是增加对触摸设备的支持。大约在那个时候，我们认识到移动（无处不在）是我们战略的关键部分；如果我们要让下一个十亿软件创作者在线，我们必须在移动设备上可用。CodeMirror 将通过依靠本机浏览器文本编辑（通过 contentEditable）而不是完全在库/javascript 中实现文本编辑来实现这一点。

[ProseMirror](https://prosemirror.net/)启发了 CodeMirror 6 的 API 设计，这是 Marijn 的另一个项目。我之前曾在 ProseMirror 上玩过我正在从事的 WYSIWIG 项目，并且很喜欢它。ProseMirror 的核心非常小，其他一切都是插件。它是模块化的、可插拔的、功能强大的，并且作为库用户具有令人难以置信的能力。所以我决定让公司赞助新版 CodeMirror 的开发，我什至亲自资助了这个项目。

去年 CodeMirror 6 宣布了一个测试版，我非常兴奋地开始将它添加到 Replit，团队的其他成员也是如此。我们开始使用编辑器，虽然它有一点学习曲线，但当你最终“得到它”时，你会感觉自己是一个超级代码编辑器开发者。为了让事情顺利进行，我们开始逐步采用 CodeMirror。我们首先将它添加为 Replit 上事实上的只读编辑器，然后开始将其添加到网站的不同部分，在这些部分中编辑代码。

今年早些时候，我们信心大增，开始将 CodeMirror 集成到我们的移动环境中。从用户的角度来看，CodeMirror 客观上比任何其他移动编辑器都要好。即使它还不支持我们支持的所有语言和一些其他功能，它仍然是值得的。推出的结果比我们预期的更积极。与队列中的 Ace 同行相比，参与 CodeMirror 推出的移动用户保留的可能性几乎高出 70%（！）。借助 CodeMirror 的可插拔性，很明显这只是我们在移动设备上提供更多价值的开始，首先是将移动设备上缺少的桌面功能移植到 CodeMirror 中。

![](https://blog.replit.com/images/mobile/codemirror.png)

围绕 CodeMirror 6 的社区仍处于起步阶段，因此我们必须自己编写很多东西，赞助特定功能的努力，并与 Marijn 合作以消除错误。我们希望通过我们的贡献帮助引导和回馈 CodeMirror 社区。列出我们计划开源的一些正在积极开发的东西：Vim 模式、Emacs 模式、LSP 客户端、缩进标记、CSS 的颜色选择器、语言解析器以及我们将在以后的帖子中宣布的许多其他内容我们发布了桌面版 CodeMirror。我认为人们对新的 CodeMirror 感到兴奋，我们将看到社区和生态系统在未来一两年内激增。许多人急于在生产中使用它。

我们非常高兴能够在 CodeMirror 之上构建越来越多的功能，并使其成为我们的合作伙伴，使编码更易于访问。我们总是说我们最终必须开发自己的编辑器才能以我们喜欢的方式制作体验。尽管如此，我认为我们对使用 CodeMirror 扩展可以实现的目标感到满意。

头对头
---

让我回顾一下，让你更容易找到适合你的东西。同样，这是我的个人经历；它可能无法反映您的经验。

对于每个部分，我会从 1 到 3 给编辑打分，其中 3 是最好的。

### 稳定

#### 高手

**得分：3**

极其稳定可靠。该编辑器经过实战考验，为许多工具提供了 10 多年的动力，而且在我使用它的这些年里，我从未经历过任何重大变化。可能已经发布了引入小错误的版本，但它们很快就会被修补。

#### 摩纳哥

**得分：2**

摩纳哥拥有稳定的编辑体验；错误会很快修复，因为它们会影响 VSCode，维护者善于持续发布版本。扣分是因为 API 不是最稳定的，并且有一些细微的变化可能会让您烦恼。Microsoft 尚未发布 v1.0.0 semver。

#### 代码镜像 6

**得分：1**

CodeMirror 仍处于测试阶段，该项目有许多细微的错误，但 Marijn 非常快速地响应并修补它们。虽然该项目仍处于测试阶段，但我认为 Marijn 对当前的 API 很满意，而且我们不太可能看到重大的重大变化。CodeMirror 6 开始被许多公司在生产中采用，甚至 Chrome 开发工具[也可能会在明年迁移以将其用作编辑器。](https://github.com/ChromeDevTools/devtools-frontend/commit/6da128c3ae6b6dd0d4602059c23f8c4003823f5b#diff-592cac14b3eeb584a09b80d2696a73223ad0a79e4a8e6765f875a6f4492b4525)

### 开箱即用的体验

#### 高手

**得分：2**

出色的开箱即用体验，支持众多功能和语言，包括一些基本的 JavaScript linting（使用 JSHint）和自动完成。用户界面有点过时，所以你可能想弄乱它。

#### 摩纳哥

**得分：3**

用户界面非常精致。该编辑器附带许多功能，包括非常好的用于 HTML、CSS 和 JavaScript 的 IntelliSense 开箱即用。

#### 代码镜像 6

**得分：2**

编辑器需要一些配置才能把它放到一个好地方。这是对项目模块化性质的权衡。有一个[`basic-setup`包](https://codemirror.net/6/docs/ref/#basic-setup)组合了一些基本模块并重新导出了核心模块。基本的用户界面很好。

### 模块化、捆绑和占用空间

#### 高手

**得分：2**

Ace 是苗条的、模块化的，并且您可以延迟加载功能。然而，Ace 是一个老项目，并且附带了一个自制的模块系统，让它在你的应用程序中运行并不难，但它需要一些配置。

#### 摩纳哥

**得分：1**

Monaco 有一个巨大的包大小，浮动大约 5 兆字节，据我所知，延迟加载功能是不可能的。Monaco 还需要在您的捆绑系统中进行特殊配置，并且很难使其配合。

#### 代码镜像 6

**得分：3**

CodeMirror 采用现代技术构建。您甚至可以使用 ES6 模块来导入它，而无需涉及捆绑器。延迟加载功能轻而易举；动态 ES6 导入就是你所需要的。该项目非常模块化，核心非常纤细。

### 可扩展性和高级功能

#### 高手

**得分：2**

Ace 有许多很好的配置选项，并且有很好的扩展点。它们不是很通用，但会让你走得很远。API 确实感觉有点过时，但绝对可靠。当我需要时，我很乐意给 Ace 打猴子补丁，因为它很容易阅读 Ace 代码库，而且内部结构近十年来没有改变。

#### 摩纳哥

**得分：2**

Monaco 具有许多配置选项，并具有修改编辑器行为和底层功能的 API。也就是说，扩展点有些有限和具体。我经常与编辑器打交道，需要进行猴子补丁，但这很可怕，因为代码库远非直截了当，而且内部结构不断变化。最终，我们停止了升级，因为几乎不可能支持我们添加的一些功能。

#### 代码镜像 6

**得分：3**

CodeMirror 在构建时考虑了可扩展性，是主要的设计原则之一；这种可扩展性允许 CodeMirror 模块化。事实上，核心本身（`@codemirror/view`和`@codemirror/state`）本质上是一个可扩展的文本区域。所有“代码”功能都作为扩展实现。语法高亮和行号等基本内容作为扩展和包实现。在创作您自己的扩展时，这些包是一个很好的资源。

使用 CodeMirror 构建花哨的扩展是轻而易举的事，它为扩展开发人员提供的强大功能是疯狂的！扩展点是通用的，所以世界就是你的牡蛎。

### 社区和文档。

#### 高手

**得分：2**

多年来，Ace 积累了丰富的生态系统、大量关于使用 ace 的文章和博客。支持在阳光下突出显示的每种语言和许多其他社区包。

API 文档不是最好的，但对于大多数事情来说已经足够了。结构良好（尽管很旧）的代码库是一个极好的补充资源。网站上有一个很好的指南。

#### 摩纳哥

**得分：2**

摩纳哥在 2018 年前后蓄势待发，但感觉社区的能量很快就消散了。你会在 NPM 上找到一堆由社区维护的包。

Monaco 的 API 文档已经足够好，但可能会更好。据我所知，摩纳哥没有官方指南，因此很难入门。由于项目的结构，您可能很难将代码库用作补充资源。

#### 代码镜像 6

**得分：3**

我从社区中看到很多围绕 CodeMirror 6 的能量。我们正在尝试通过一些我们认为必不可少的软件包来帮助社区播种。敬请关注！

文档很棒，我希望随着时间的推移会变得更好。有一篇关于系统的优秀文章、入门指南以及大量示例，并附有冗长的解释。

我在可扩展性下提到了这一点，但大多数特性都是作为扩展实现的，它们充当了一个很棒的资源，让你去看看做某些事情的“有福”的方式是什么。

### 表现

_免责声明：没有明确的基准数据_

#### 高手

**得分：3**

Ace 是在浏览器和机器不如现在强大的时代构建的，因此今天的编辑器非常高效。

#### 摩纳哥

**得分：2**

Monaco 有很多性能优化，但可能有点笨拙。Replit 有很多用户使用低功率机器，他们一直在感受 Monaco 的痛苦。

#### 代码镜像 6

**得分：3**

到目前为止，CodeMirror 感觉非常高效。创作者为此付出了很大的努力。

### 移动支持

我不会在这里得分。如果你想要一个支持移动的代码编辑器，你应该使用 CodeMirror 6。Ace 的支持还不错，但没有接近，而 Monaco 在移动端无法使用。

我什至会说 CodeMirror 可能甚至适用于作为 webview 组件的本机应用程序。CodeMirror 中的大多数内容都是可序列化的，因此您可以从本机代码与 webview 进行互操作。

感谢您的阅读！
-------

正如文章中提到的，我们正在慢慢向大家推出 CodeMirror，如果你想先睹为快，你可以从[帐户页面](https://replit.com/account)启用 explorer 角色或将查询参数附加`?codemirror=1`到任何 repl URL。

作为明年即将发生的事情的预告片，我将为您留下这段视频：