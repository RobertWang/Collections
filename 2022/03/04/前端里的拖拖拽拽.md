> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/7069588012912361509)

æœ€è¿‘åœ¨é¡¹ç›®ä¸­ä½¿ç”¨äº† [react-dnd](https://link.juejin.cn?target=https%3A%2F%2Freact-dnd.github.io%2Freact-dnd%2Fabout "https://react-dnd.github.io/react-dnd/about")ï¼Œä¸€ä¸ªåŸºäº HTML5 çš„æ‹–æ‹½åº“ï¼Œâ€œæ‹–æ‹½èƒ½åŠ›â€ ä¸°å¯Œäº†å‰ç«¯çš„äº¤äº’æ–¹å¼ï¼ŒåŸºäºæ‹–æ‹½èƒ½åŠ›ï¼Œä¼šæ‰©å±•å„ç§å„æ ·çš„æ‹–æ‹½åé¦ˆæ•ˆæœï¼Œå› æ­¤æœ‰å¿…è¦å­¦ä¹ äº†è§£ï¼Œæœ€å¥½çš„å­¦ä¹ æ–¹å¼å°±æ˜¯å®æ“ï¼

æ‹–æ‹½äº¤äº’å¸¸è§äºå„ç§å‰ç«¯ç¼–è¾‘å™¨é‡Œï¼Œè€Œ â€œç¼–è¾‘å™¨â€ æ˜¯ä¸€ä¸ªé›†æˆå‰ç«¯æŠ€æœ¯èƒ½åŠ›çš„ç»¼åˆæ€§å·¥ç¨‹ï¼Œå…¶ä¸­å°±ä¼šæ¶‰åŠåˆ°å„ç§å½¢å¼çš„æ‹–æ‹½äº¤äº’ï¼Œå› ä¸º â€œæ‹–æ‹½â€ æ˜¯æå‡ç”¨æˆ·ä½“éªŒçš„é‡è¦äº¤äº’æ–¹å¼ï¼Œæ‰€ä»¥éœ€è¦å¯¹æ‹–æ‹½çš„äº¤äº’æ•ˆæœåšå„ç§å®šåˆ¶åŒ–ï¼Œä½œä¸ºå¼€å‘è€…ç†åº”ç†Ÿç»ƒæŒæ¡ â€œæ‹–æ‹½â€ çš„åº”ç”¨ï¼

æœ€è¿‘åœ¨å¼€å‘ä¸€æ¬¾ä½ä»£ç å¹³å°ï¼Œæ‰€ä»¥å€Ÿæ­¤æœºä¼šåˆ†äº«ä¸€ä¸‹å…³äº â€œæ‹–æ‹½â€ è¿™ä¸€äº¤äº’çš„åŸºç¡€çŸ¥è¯†å’Œå®è·µç»éªŒï¼Œå¸Œæœ›å¯ä»¥ç»™æœ‰éœ€è¦çš„åŒå­¦æä¾›ä¸€ç‚¹å‚è€ƒã€‚

ä¸€ã€HTML5 ä¸­çš„æ‹–æ”¾
============

æ‹–ï¼ˆDragï¼‰å’Œæ”¾ï¼ˆDropï¼‰æ˜¯ HTML5 æ ‡å‡†çš„ç»„æˆéƒ¨åˆ†ï¼Œäº†è§£æŒæ¡ä¹‹åï¼Œä¸¾ä¸€åä¸‰ï¼Œæœ‰åŠ©äºæå‡æˆ‘ä»¬åœ¨æ‹–æ‹½åœºæ™¯ä¸‹æŠ€æœ¯æ–¹æ¡ˆçš„è®¾è®¡èƒ½åŠ›ã€‚

1.1 draggable å±æ€§
----------------

ç°ä»£æµè§ˆå™¨ä¸­ï¼Œä¸éš¾å‘ç°ï¼Œå›¾ç‰‡æ ‡ç­¾ï¼ˆ`<img />`ï¼‰æ˜¯å¯ä»¥è¢«é•¿æŒ‰æ‹–æ‹½ï¼Œä½†å¦‚æœéœ€è¦è‡ªå®šä¹‰çš„ DOM èŠ‚ç‚¹å¯ä»¥è¢«æ‹–æ‹½éœ€è¦é…ç½®ä»¥å‘Šè¯‰æµè§ˆå™¨æä¾›å¯¹å…ƒç´ ï¼ˆ`Element` / `Tag`ï¼‰æ”¯æŒæ‹–æ‹½çš„èƒ½åŠ›ã€‚

è€Œå…ƒç´ æ˜¯å¦å…è®¸è¢«æ‹–æ”¾ä¸”å¯å“åº” API æ“ä½œä¾èµ–äº [draggable](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FHTML%2FGlobal_attributes%2Fdraggable "https://developer.mozilla.org/en-US/docs/Web/HTML/Global_attributes/draggable") å…¨å±€æ ‡ç­¾å±æ€§

**draggable** æ˜¯ä¸€ä¸ªå¸ƒå°”å€¼ç±»å‹çš„æ ‡ç­¾å±æ€§ï¼š

*   `true`ï¼šå…ƒç´ å¯è¢«æ‹–æ‹½
*   `false`ï¼šå…ƒç´ ä¸å¯æ‹–æ‹½

å½“å…ƒç´ è®¾ç½®äº† draggable å±æ€§ï¼Œæ­¤æ—¶é•¿æŒ‰å°±å¯ä»¥è‡ªç”±æ‹–æ‹½äº†ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6809b3642c454837b5eda33d9feefe85~tplv-k3u1fbpfcp-watermark.awebp)

1.2 Drag & Drop äº‹ä»¶
------------------

HTML çš„ `drag` & `drop` ä½¿ç”¨äº† â€œ**DOM Event**â€ å’Œä» â€œ**Mouse Event**â€ ç»§æ‰¿è€Œæ¥çš„ â€œ**drag event**â€ ã€‚

**ä¸€ä¸ªå…¸å‹çš„æ‹–æ‹½æ“ä½œï¼š** ç”¨æˆ·é€‰ä¸­ä¸€ä¸ªå¯æ‹–æ‹½çš„ï¼ˆ`draggable`ï¼‰å…ƒç´ ï¼Œå¹¶å°†å…¶æ‹–æ‹½ï¼ˆé¼ æ ‡æŒ‰ä½ä¸æ”¾ï¼‰è‡³ä¸€ä¸ªå¯æ”¾ç½®çš„ï¼ˆ`droppable`ï¼‰å…ƒç´ ä¸Šï¼Œç„¶åæ¾å¼€é¼ æ ‡ã€‚

åœ¨æ‹–åŠ¨å…ƒç´ æœŸé—´ï¼Œä¸€äº›ä¸æ‹–æ”¾ç›¸å…³çš„äº‹ä»¶ä¼šè¢«è§¦å‘ï¼Œåƒ `drag` å’Œ `dragover` ç±»å‹çš„äº‹ä»¶ä¼šè¢«é¢‘ç¹è§¦å‘ã€‚

é™¤äº†å®šä¹‰æ‹–æ‹½äº‹ä»¶ç±»å‹ï¼Œæ¯ä¸ªäº‹ä»¶ç±»å‹è¿˜èµ‹äºˆäº†å¯¹åº”çš„äº‹ä»¶å¤„ç†å™¨

<table><thead><tr><th align="left">äº‹ä»¶ç±»å‹</th><th align="left">äº‹ä»¶å¤„ç†å™¨</th><th align="left">è§¦å‘æ—¶æœº</th><th align="left">ç»‘å®šå…ƒç´ </th></tr></thead><tbody><tr><td align="left"><code>dragstart</code></td><td align="left">ondragstart</td><td align="left">å½“å¼€å§‹æ‹–åŠ¨ä¸€ä¸ªå…ƒç´ æ—¶</td><td align="left">æ‹–æ‹½</td></tr><tr><td align="left"><code>drag</code></td><td align="left">ondrag</td><td align="left">å½“å…ƒç´ è¢«æ‹–åŠ¨æœŸé—´æŒ‰ä¸€å®šé¢‘ç‡è§¦å‘</td><td align="left">æ‹–æ‹½</td></tr><tr><td align="left"><code>dragend</code></td><td align="left">ondragend</td><td align="left">å½“æ‹–åŠ¨çš„å…ƒç´ è¢«é‡Šæ”¾ï¼ˆğŸ–±ï¸æ¾å¼€ã€æŒ‰é”®ç›˜ ESCï¼‰æ—¶</td><td align="left">æ‹–æ‹½</td></tr><tr><td align="left"><code>dragenter</code></td><td align="left">ondragenter</td><td align="left">å½“æ‹–åŠ¨å…ƒç´ åˆ°ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´ æ—¶</td><td align="left">æ”¾ç½®</td></tr><tr><td align="left"><code>dragexit</code></td><td align="left">ondragexit</td><td align="left">å½“å…ƒç´ å˜å¾—ä¸å†æ˜¯æ‹–åŠ¨æ“ä½œçš„é€‰ä¸­ç›®æ ‡æ—¶</td><td align="left">æ”¾ç½®</td></tr><tr><td align="left"><code>dragleave</code></td><td align="left">ondragleave</td><td align="left">å½“æ‹–åŠ¨å…ƒç´ ç¦»å¼€ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´ </td><td align="left">æ”¾ç½®</td></tr><tr><td align="left"><code>dragover</code></td><td align="left">ondragover</td><td align="left">å½“å…ƒç´ è¢«æ‹–åˆ°ä¸€ä¸ªå¯é‡Šæ”¾ç›®æ ‡å…ƒç´ ä¸Šæ—¶ï¼ˆ100 ms / æ¬¡ï¼‰</td><td align="left">æ”¾ç½®</td></tr><tr><td align="left"><code>drop</code></td><td align="left">ondrop</td><td align="left">å½“æ‹–åŠ¨å…ƒç´ åœ¨å¯é‡Šæ”¾ç›®æ ‡å…ƒç´ ä¸Šé‡Šæ”¾æ—¶</td><td align="left">æ”¾ç½®</td></tr></tbody></table>

å„ä¸ªäº‹ä»¶çš„æ—¶æœºå¯ä»¥ç”¨ä¸‹é¢è¿™ä¸ªå›¾ç®€å•è¡¨ç¤ºï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/3ac2bc4b8d7b4c3092864f898a3b597d~tplv-k3u1fbpfcp-watermark.awebp)

**âš ï¸æ³¨æ„ï¼š** [dragOver](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FDocument%2Fdragover_event "https://developer.mozilla.org/en-US/docs/Web/API/Document/dragover_event") äº‹ä»¶çš„é»˜è®¤è¡Œä¸ºæ˜¯ï¼šâ€œReset the current drag operation to "none"â€ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå¦‚æœä¸é˜»æ­¢æ”¾ç½®å…ƒç´ çš„ dragOver äº‹ä»¶ï¼Œåˆ™æ”¾ç½®å…ƒç´ ä¸ä¼šå“åº” â€œæ‹–åŠ¨å…ƒç´ â€ çš„â€œæ”¾ç½®è¡Œä¸ºâ€

```
// è®©ç»‘å®šè¯¥äº‹ä»¶çš„å…ƒç´ æ”¯æŒæ”¾ç½®
function handleDragOver(e) {
  // é˜»æ­¢é»˜è®¤çš„é‡ç½®è¡Œä¸º
  // å³å¯æˆä¸ºæ‹–æ‹½å…ƒç´ çš„æ”¾ç½®åŒº
  e.preventDefault();
}
å¤åˆ¶ä»£ç 

```

ä»è®¾è®¡äº‹ä»¶æ ‡å‡†æ¥çœ‹ï¼Œå¦‚æœæˆ‘ä»¬éœ€è¦è‡ªè¡Œå®ç°æ‹–æ‹½çš„æ•ˆæœï¼Œå°±éœ€è¦ä»è¿™å…³é”®çš„å‡ ä¸ªäº‹ä»¶å»æ€è€ƒè®¾è®¡ã€‚

1.3 DataTransfer
----------------

åœ¨ä¸Šè¿°çš„äº‹ä»¶ç±»å‹ä¸­ï¼Œä¸éš¾å‘ç°ï¼Œæ”¾ç½®å…ƒç´ å’Œæ‹–åŠ¨å…ƒç´ åˆ†åˆ«ç»‘å®šäº†è‡ªå·±çš„äº‹ä»¶ï¼Œå¯å¦‚ä½•å°†æ‹–æ‹½å…ƒç´ å’Œæ”¾ç½®å…ƒç´ **å»ºç«‹è”ç³»**ä»¥åŠ**ä¼ é€’æ•°æ®**ï¼Ÿ

è¿™å°±æ¶‰åŠåˆ° `DataTransfer` å¯¹è±¡ï¼š

> `DataTransfer` å¯¹è±¡ç”¨äºä¿å­˜æ‹–åŠ¨å¹¶æ”¾ä¸‹ï¼ˆdrag and dropï¼‰è¿‡ç¨‹ä¸­çš„æ•°æ®ã€‚å®ƒå¯ä»¥ä¿å­˜ä¸€é¡¹æˆ–å¤šé¡¹æ•°æ®ï¼Œè¿™äº›æ•°æ®é¡¹å¯ä»¥æ˜¯ä¸€ç§æˆ–è€…å¤šç§æ•°æ®ç±»å‹ã€‚ â€”â€” [DataTransfer - MDN](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FWeb%2FAPI%2FDataTransfer "https://developer.mozilla.org/en-US/docs/Web/API/DataTransfer")

`DataTransfer` å¯¹è±¡åœ¨ä¸åŒæµè§ˆå™¨ä¸Šå› ä¸ºæ ‡å‡†å¯èƒ½ä¸ä¸€æ ·ä½¿å¾— API æœ‰å·®å¼‚ï¼Œä½†æœ‰å‡ ä¸ª â€œæ ‡å‡†ï¼ˆå¸¸ç”¨ï¼‰â€ å±æ€§å’Œæ–¹æ³•éœ€è¦ç†Ÿæ‚‰

åœ¨ Chrome æµè§ˆå™¨ä¸Šçš„ DataTransfer å®ä¾‹å¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/b201e470cf714a6ebcb7879c29d50b0d~tplv-k3u1fbpfcp-watermark.awebp)

### (1) å±æ€§

<table><thead><tr><th align="left">å±æ€§</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>dropEffect</code></td><td align="left">è·å–å½“å‰é€‰å®šçš„æ‹–æ”¾æ“ä½œç±»å‹æˆ–è€…è®¾ç½®çš„ä¸ºä¸€ä¸ªæ–°çš„ç±»å‹ã€‚å€¼ä¸ºï¼šnoneã€copyã€linkã€move</td></tr><tr><td align="left"><code>effectAllowed</code></td><td align="left">æä¾›æ‰€æœ‰å¯ç”¨çš„æ“ä½œç±»å‹ã€‚å€¼æ˜¯ï¼šnoneã€copyã€copyLinkã€copyMoveã€linkã€linkMoveã€moveã€allã€uninitialized</td></tr><tr><td align="left"><code>files</code></td><td align="left">åŒ…å«æ•°æ®ä¼ è¾“ä¸­å¯ç”¨çš„æ‰€æœ‰æœ¬åœ°æ–‡ä»¶çš„åˆ—è¡¨ã€‚å¦‚æœæ‹–åŠ¨æ“ä½œä¸æ¶‰åŠæ‹–åŠ¨æ–‡ä»¶ï¼Œåˆ™æ­¤å±æ€§ä¸ºç©ºåˆ—è¡¨</td></tr><tr><td align="left"><code>items</code> (åªè¯»)</td><td align="left">æä¾›ä¸€ä¸ªåŒ…å«æ‰€æœ‰æ‹–åŠ¨æ•°æ®åˆ—è¡¨çš„ DataTransferItemList å¯¹è±¡</td></tr><tr><td align="left"><code>types</code> (åªè¯»)</td><td align="left">æä¾›ä¸€ä¸ª dragstart äº‹ä»¶ä¸­è®¾ç½®çš„æ ¼å¼çš„ strings æ•°ç»„ã€‚</td></tr></tbody></table>

### (2) æ–¹æ³•

<table><thead><tr><th align="left">å±æ€§</th><th align="left">è¯´æ˜</th></tr></thead><tbody><tr><td align="left"><code>setData(format, value)</code></td><td align="left">è®¾ç½®ç»™å®šç±»å‹çš„æ•°æ®ã€‚å¦‚æœè¯¥ç±»å‹çš„æ•°æ®ä¸å­˜åœ¨ï¼Œåˆ™å°†å…¶æ·»åŠ åˆ°æœ«å°¾ï¼Œä»¥ä¾¿ç±»å‹åˆ—è¡¨ä¸­çš„æœ€åä¸€é¡¹å°†æ˜¯æ–°çš„æ ¼å¼ã€‚å¦‚æœè¯¥ç±»å‹çš„æ•°æ®å·²ç»å­˜åœ¨ï¼Œåˆ™åœ¨ç›¸åŒä½ç½®æ›¿æ¢ç°æœ‰æ•°æ®ã€‚</td></tr><tr><td align="left"><code>getData(format)</code></td><td align="left">æ£€ç´¢ç»™å®šç±»å‹çš„æ•°æ®ï¼Œå¦‚æœè¯¥ç±»å‹çš„æ•°æ®ä¸å­˜åœ¨æˆ– data transfer ä¸åŒ…å«æ•°æ®ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²</td></tr><tr><td align="left"><code>clearData([format])</code></td><td align="left">åˆ é™¤ä¸ç»™å®šç±»å‹å…³è”çš„æ•°æ®ã€‚ç±»å‹å‚æ•°æ˜¯å¯é€‰çš„ã€‚å¦‚æœç±»å‹ä¸ºç©ºæˆ–æœªæŒ‡å®šï¼Œåˆ™åˆ é™¤ä¸æ‰€æœ‰ç±»å‹å…³è”çš„æ•°æ®ã€‚å¦‚æœæŒ‡å®šç±»å‹çš„æ•°æ®ä¸å­˜åœ¨ï¼Œæˆ–è€… data transfer ä¸­ä¸åŒ…å«ä»»ä½•æ•°æ®ï¼Œåˆ™è¯¥æ–¹æ³•ä¸ä¼šäº§ç”Ÿä»»ä½•æ•ˆæœã€‚</td></tr><tr><td align="left">`setDragImage(img</td><td align="left">element, xOffset, yOffset)`</td></tr></tbody></table>

åœ¨ç®€å•çš„æ‹–æ‹½åœºæ™¯ä¸­ï¼Œå…¶å®å¯ä»¥ç±»æ¯” **window.localStorage** å¯¹è±¡çš„ `setItem()` å’Œ `getItem()` æ–¹æ³•æ¥ç†è§£è®°å¿†.

ä½† `getData()` åœ¨æµ‹è¯•ä¸­å‘ç°åªèƒ½åœ¨ `ondrop` äº‹ä»¶ä¸­è·å–åˆ°å€¼:

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/220c8d6b604e4b4bbc4e738229a8ca3c~tplv-k3u1fbpfcp-watermark.awebp)

1.4 ä¸€ä¸ªæ¡ˆä¾‹æŒæ¡æ‹–æ”¾ API
----------------

```
<div>
  <div class="drag" draggable="true" id="dragger" ondragstart="handleDragStart(event)">æ‹–åŠ¨å…ƒç´ </div>
  <div class="drop" ondrop="handleDrop(event)" ondragover="allowDrop(event)">æ”¾ç½®åŒºåŸŸ</div>
</div>

<script>
  function handleDragStart(e) {
    e.dataTransfer.setData('DRAG_NODE_ID', e.target.id)
  }
  function handleDragOver(e) {
    e.preventDefault();
  }
  function handleDrop(e) {
    e.preventDefault();
    var data = e.dataTransfer.getData('DRAG_NODE_ID');
    e.target.appendChild(document.getElementById(data));
  }
</script>
å¤åˆ¶ä»£ç 

```

**æ¼”ç¤ºæ¡ˆä¾‹ï¼š** [codepen.io/DYBOY/pen/eâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fcodepen.io%2FDYBOY%2Fpen%2FeYeyvWm "https://codepen.io/DYBOY/pen/eYeyvWm")

**æ•ˆæœï¼š**

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d95bc468582b4478b0b6d68a32b1fab4~tplv-k3u1fbpfcp-watermark.awebp)

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c5d2b574a6554acbb2b7ee85619df5ec~tplv-k3u1fbpfcp-watermark.awebp)

1.6 å…¼å®¹æ€§
-------

æ˜¯ HTML5 æ ‡å‡†æå‡ºçš„èƒ½åŠ›ï¼Œå› æ­¤å„å¤§æµè§ˆå™¨å‚å•†å¯¹äºæ ‡å‡†çš„æ”¯æŒæœ‰å·®å¼‚ï¼Œå…¶å…¼å®¹æ€§å‚è€ƒå¦‚ä¸‹ï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8be2d309ef4a450989a0cadfb23f611f~tplv-k3u1fbpfcp-watermark.awebp)

ç›¸è¾ƒäºä¼ ç»Ÿçš„é€šè¿‡é¼ æ ‡äº‹ä»¶ï¼š`mousedown`ã€`mousemove`ã€`mouseup` ç»„åˆå®ç°çš„æ‹–æ‹½è¦ç®€å•å¾ˆå¤šï¼Œå°‘äº†æ”¾å…¥ç›®æ ‡è¾¹ç•Œçš„åˆ¤æ–­ï¼Œä¹Ÿå°‘äº†å¯¹ä½ç½®çš„å®æ—¶è·å–æ“ä½œã€‚

å¦å¤–ç›®å‰çš„ API ä¸ç®—å¤šï¼Œä¾‹å¦‚æˆ‘ä»¬æƒ³è¦å®šåˆ¶åŒ–æ‹–æ‹½çš„å›¾ç‰‡å¤§å°ã€é¼ æ ‡æ ·å¼ç­‰ï¼Œç›®å‰æš‚æ—¶æ²¡å‘ç°æ¯”è¾ƒæ–¹ä¾¿çš„è§£å†³æ–¹å¼ï¼Œä½†æ˜¯ä»å¦ä¸€ä¸ªè§’åº¦æ¥è¯´ï¼Œè®©æˆ‘ä»¬å¯¹äºæ‹–æ‹½èƒ½åŠ›çš„è®¾è®¡å’Œæ ‡å‡†æœ‰äº†ä¸€ä¸ªæ›´æ·±åˆ‡çš„è®¤è¯†ï¼Œå¯¹äºè®¾è®¡å®ç°æ‹–æ‹½äº¤äº’æœ‰äº†ä¸€ä¸ª â€œç†è®ºâ€ åŸºç¡€ï¼

äºŒã€æ‰‹æ“ä¸€ä¸ª
======

æœ‰äº†ä¸Šé¢çš„åŸºç¡€çŸ¥è¯†ï¼Œé‚£ä¹ˆå®ç°ä¸€ä¸ªåˆ—è¡¨æ‹–æ‹½æ’åºå¹¶ä¸æ˜¯ä»€ä¹ˆéš¾äº‹ã€‚

2.1 è®¾è®¡å®ç°
--------

ç»“åˆä¸Šè¿°çš„ Drag & Drop çš„äº‹ä»¶ç±»å‹ï¼Œé‚£ä¹ˆæ‹–æ‹½æ’åºä¸»è¦æ˜¯é’ˆå¯¹ â€œæ‹–åŠ¨å¯¹è±¡â€ ä¹‹é—´ç›¸äº’ä½œç”¨å…³ç³»çš„é€»è¾‘æ¢³ç†ï¼Œæ­¤å¤„æˆ‘ä»¬æš‚ä¸”åŒºåˆ†ä¸ºï¼š

*   **æºå¯¹è±¡ï¼š** æ‹–æ‹½åˆ—è¡¨ä¸­è¢«æ‹–åŠ¨çš„å•ä¸ªåˆ—è¡¨é¡¹
*   **ç›®æ ‡å¯¹è±¡ï¼š** æ‹–æ‹½åˆ—è¡¨ä¸­å’Œ â€œæºå¯¹è±¡â€ äº§ç”Ÿ â€œç›¸äº’ä½œç”¨â€ çš„åˆ—è¡¨é¡¹

æ•´ä½“çš„äº¤äº’äº‹ä»¶çš„è®¾è®¡æ€è·¯å¦‚ä¸‹ï¼š

### (1) ondragstart

æ­¤æ—¶å¼€å§‹æ‹–æ‹½ â€œæºå¯¹è±¡â€ çš„æ—¶æœºï¼Œåœ¨æ­¤äº‹ä»¶å›è°ƒå‡½æ•°ä¸­æ”¹å˜ â€œæºå¯¹è±¡â€ çš„æ ·å¼ï¼Œè®¾ç½®æ‹–æ‹½çš„ä¸€äº›ä¼ é€’å‚æ•°ç­‰åˆå§‹å€¼ã€‚

```
// æºå¯¹è±¡å¼€å§‹æ‹–æ‹½
const handleDragStart = (e: React.DragEvent<HTMLDivElement>) => {
  e.dataTransfer.effectAllowed = "move";
  setDragId(e.currentTarget.dataset.index); // ä» dataset è·å–æ‹–æ‹½é¡¹çš„ id
};
å¤åˆ¶ä»£ç 

```

### (2) ondragover

æ­£ä¸æ‹–æ‹½ä¸­çš„ â€œæºå¯¹è±¡â€ äº§ç”Ÿç›¸äº’å½±å“çš„ç›®æ ‡å¯¹è±¡ï¼Œæ­¤æ—¶ â€œæºå¯¹è±¡â€ å¤„äº â€œç›®æ ‡å¯¹è±¡â€ çš„æ­£ä¸Šæ–¹ï¼Œç›®æ ‡å¯¹è±¡ 100ms / æ¬¡çš„é¢‘ç‡è°ƒç”¨ â€œç›®æ ‡å¯¹è±¡â€ çš„ `ondragover` ä¸­å£°æ˜çš„å›è°ƒäº‹ä»¶ã€‚

æ­¤æ—¶ï¼Œæˆ‘ä»¬ä¼šè®¡ç®—æ”¹å˜ â€œ**æºå¯¹è±¡**â€ å’Œ â€œ**ç›®æ ‡å¯¹è±¡**â€ çš„ä½ç½®ã€‚

```
// æºå¯¹è±¡åœ¨ç›®æ ‡å¯¹è±¡ä¸Šæ–¹æ—¶
const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {
  e.preventDefault(); // å…è®¸æ”¾ç½®ï¼Œé˜»æ­¢é»˜è®¤äº‹ä»¶
  const dropId = e.currentTarget.dataset.index;
  move(dragId, dropId); // æ”¹å˜åŸåˆ—è¡¨æ•°æ®
};
å¤åˆ¶ä»£ç 

```

### (3) ondrag

è¯¥äº‹ä»¶ä½œç”¨äº â€œæºå¯¹è±¡â€ï¼Œæ­¤æ—¶æ­£å¤„äºæ‹–æ‹½è¿‡ç¨‹ä¸­ï¼Œæ­¤æ—¶å¯ä»¥æ”¹å˜æºå¯¹è±¡çš„ `opacity`ã€`display(none)`ã€`visiblity` æ ·å¼å±æ€§ï¼Œå¦‚æœåœ¨ `dragstart` äº‹ä»¶æ”¹å˜ï¼Œåˆ™ä¼šå¯¼è‡´æ‹–æ‹½æ‹·è´å¯¹è±¡ä¸¢å¤±ã€‚

```
// æºå¯¹è±¡è¢«æ‹–æ‹½è¿‡ç¨‹ä¸­
const handleDrag = (e: React.DragEvent<HTMLDivElement>) => {
  e.currentTarget.style.opacity = "0";
};
å¤åˆ¶ä»£ç 

```

### (4) ondragend

åœ¨æ¾æ‰‹å®Œæˆ â€œæºå¯¹è±¡â€ çš„æ”¾ç½®æ—¶ï¼Œä¸»åŠ¨è°ƒç”¨ç»‘å®šåœ¨ â€œæºå¯¹è±¡â€ èº«ä¸Šçš„äº‹ä»¶ï¼Œæ­¤æ—¶æ¢å¤æ›´æ”¹çš„æ ·å¼ã€‚

```
// æºå¯¹è±¡è¢«æ”¾ç½®å®Œæˆæ—¶
const handleDragEnd = (e: React.DragEvent<HTMLDivElement>) => {
  e.currentTarget.style.opacity = "1";
};
å¤åˆ¶ä»£ç 

```

2.2 å®ç°æ•ˆæœ
--------

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/cf398c2c3d5e4f88b0d6684e0bb9d04f~tplv-k3u1fbpfcp-watermark.awebp)

2.3 åŠ ç‚¹åŠ¨ç”»
--------

ä¸Šé¢çš„å®ç°ä¸­æ•ˆæœè¿˜ç®—å¯ä»¥ï¼Œä½†æ˜¯å°‘äº†æ‹–æ‹½é¡¹çš„åˆ‡æ¢è¿‡ç¨‹åŠ¨ç”»ï¼Œç›´æ¥åœ¨ dragover äº‹ä»¶ä¸­é€šè¿‡ `move(dragId, dropId)` æ–¹æ³•ç›´æ¥ä¿®æ”¹äº†åŸåˆ—è¡¨æ•°æ®çš„æ’åºï¼Œå¯¼è‡´åˆ‡æ¢çªå˜ã€‚

å€ŸåŠ© `animation` æ–°å¢ CSS å¸§åŠ¨ç”»ï¼š

```
@keyframes dropUp {
  100% {
    transform: translateY(5px);
  }
}

@keyframes dropDown {
  100% {
    transform: translateY(-5px);
  }
}

.drop-up{
  animation: dropUp 0.3s ease-in-out forwards;
}
.drop-down{
  animation: dropDown 0.3s ease-in-out forwards;
}
å¤åˆ¶ä»£ç 

```

åŒæ ·çš„åœ¨ `dragOver` äº‹ä»¶ä¸­å¤„ç†ï¼Œæ–°å¢é€»è¾‘ä»£ç ï¼š

```
// æºå¯¹è±¡åœ¨ç›®æ ‡å¯¹è±¡ä¸Šæ–¹æ—¶
const handleDragOver = (e: React.DragEvent<HTMLDivElement>) => {
  ...
  // è®¾ç½®åŠ¨ç”»
  const dropId = e.currentTarget.dataset.index;
  const dragIndex = findIndex(listData, (i) => i.id === dragId);
  const dropIndex = findIndex(listData, (i) => i.id === dropId);
  // é€šè¿‡å¢åŠ å¯¹åº”çš„ CSS classï¼Œå®ç°è§†è§‰ä¸Šçš„åŠ¨ç”»è¿‡æ¸¡
  e.currentTarget.classList.remove("drop-up", "drop-down");
  if (dragIndex < dropIndex) {
    e.currentTarget.classList.add("drop-down");
  } else if (dragIndex > dropIndex) {
    e.currentTarget.classList.add("drop-up");
  } 
  ...
};
å¤åˆ¶ä»£ç 

```

å¢åŠ äº†åŠ¨ç”»çš„æ•ˆæœï¼š

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c91401fe76364dc78d2097a1bce2a2a6~tplv-k3u1fbpfcp-watermark.awebp)

çœ‹èµ·æ¥ä¼¼ä¹å¥½ä¸€ç‚¹äº†ï¼Œå½“ç„¶å¤§å®¶å¯ä»¥å»æ‰©å……åŠ¨ç”»çš„æ•ˆæœï¼Œäº¦æˆ–è€…å€ŸåŠ©ä¸‰æ–¹åŠ¨ç”»åº“ã€‚

ä¸‰ã€å·²æœ‰æ‹–æ‹½åº“
=======

ç›®å‰ä¸»æµçš„æ‹–æ‹½åº“æœ‰ï¼š

*   **react-dnd:** [github.com/react-dnd/râ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Freact-dnd%2Freact-dnd%2F "https://github.com/react-dnd/react-dnd/")
*   **react-beautiful-dnd:** [github.com/atlassian/râ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fatlassian%2Freact-beautiful-dnd%2F "https://github.com/atlassian/react-beautiful-dnd/")
*   **sortablejs:** [sortablejs.github.io/Sortable/](https://link.juejin.cn?target=https%3A%2F%2Fsortablejs.github.io%2FSortable%2F "https://sortablejs.github.io/Sortable/")
*   **react-sortable-hoc:** [github.com/clauderic/râ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fclauderic%2Freact-sortable-hoc%2F "https://github.com/clauderic/react-sortable-hoc/")

å…³äºå‡ è€…çš„å·®å¼‚ï¼Œå¯ä»¥å‚é˜…ï¼šã€Š[å…³äº react ä¸­ä½¿ç”¨æ‹–æ‹½æ’ä»¶çš„è¯„æµ‹](https://juejin.cn/post/6956112150989373448 "https://juejin.cn/post/6956112150989373448")ã€‹

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/4a53a4dd792a41a591140c402d7c93c4~tplv-k3u1fbpfcp-watermark.awebp)

å››ã€æ€»ç»“
====

ç”±äºä½ä»£ç å¹³å°å…¶å®ä¼šæœ‰ä¸°å¯Œçš„æ‹–æ‹½åœºæ™¯ï¼Œä»å¯æ‰©å±•å’Œå…¼å®¹æ€§ä¸Šè€ƒè™‘ï¼Œæœ€ç»ˆé€‰æ‹©äº† `react-dnd` ä½œä¸ºåŸºç¡€æ‹–æ‹½åº“ï¼Œå½“ç„¶ï¼Œåœ¨å¤æ‚çš„æ‹–æ‹½åœºæ™¯ä¸‹ï¼Œæ˜¯éœ€è¦è‡ªè¡Œæ‰©å±•è¯¥æ‹–æ‹½åº“ï¼Œä¸Šæ‰‹éš¾åº¦ç›¸å¯¹ä¼šé«˜ä¸€ç‚¹ï¼Œä¸è¿‡æœ‰äº†è¿™äº› â€œæ‹–æ‹½çŸ¥è¯†â€ ä½œä¸ºå‰ç½®åŸºç¡€ï¼Œé‚£ä¹ˆæ‰©å±•åŠŸèƒ½ä¹Ÿå°±ä¸æ˜¯ä»€ä¹ˆéš¾äº‹äº†ã€‚

æœ‹å‹ä»¬å¯ä»¥å…³æ³¨å¾®ä¿¡å…¬ä¼—å·ï¼š**[DYBOY](https://link.juejin.cn?target=https%3A%2F%2Fp9-juejin.byteimg.com%2Ftos-cn-i-k3u1fbpfcp%2Fe790d334b0b740679b424ee3c81d4201~tplv-k3u1fbpfcp-watermark.image "https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e790d334b0b740679b424ee3c81d4201~tplv-k3u1fbpfcp-watermark.image")**ï¼Œæ¥ä¸€èµ·ç©è€å‘€ï½