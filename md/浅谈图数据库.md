> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [mp.weixin.qq.com](https://mp.weixin.qq.com/s?__biz=MjM5NzM0MjcyMQ==&mid=2650120894&idx=5&sn=16fcbdc9bfb447f9141a0a8bca3eab67&chksm=beda79d089adf0c6ba03808b271ba1b5f2a258d4585ea51a9aab0c5cfc70e85b9dda68822220&mpshare=1&scene=1&srcid=0629GtumWNmlLZ8nO6QdsKjV&sharer_sharetime=1624940319202&sharer_shareid=7fece245937ac96f04f0fb8e1311fff1#rd)

æœ¬æ–‡ä¸»è¦è®¨è®ºå›¾æ•°æ®åº“èƒŒåçš„è®¾è®¡æ€è·¯ã€åŸç†è¿˜æœ‰ä¸€äº›é€‚ç”¨çš„åœºæ™¯ï¼Œä»¥åŠåœ¨ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨å›¾æ•°æ®åº“çš„å…·ä½“æ¡ˆä¾‹ã€‚

**ä»ç¤¾äº¤ç½‘ç»œè°ˆèµ·**
-----------

ä¸‹é¢è¿™å¼ å›¾æ˜¯ä¸€ä¸ªç¤¾äº¤ç½‘ç»œåœºæ™¯ï¼Œæ¯ä¸ªç”¨æˆ·å¯ä»¥å‘å¾®åšã€åˆ†äº«å¾®åšæˆ–è¯„è®ºä»–äººçš„å¾®åšã€‚è¿™äº›éƒ½æ˜¯æœ€åŸºæœ¬çš„å¢åˆ æ”¹æŸ¥ï¼Œä¹Ÿæ˜¯å¤§å¤šæ•°ç ”å‘äººå‘˜å¯¹æ•°æ®åº“åšçš„å¸¸è§æ“ä½œã€‚è€Œåœ¨ç ”å‘äººå‘˜çš„æ—¥å¸¸å·¥ä½œä¸­é™¤äº†è¦æŠŠç”¨æˆ·çš„åŸºæœ¬ä¿¡æ¯å½•å…¥æ•°æ®åº“å¤–ï¼Œè¿˜éœ€æ‰¾åˆ°ä¸è¯¥ç”¨æˆ·ç›¸å…³è”çš„ä¿¡æ¯ï¼Œæ–¹ä¾¿å»å¯¹å•ä¸ªçš„ç”¨æˆ·è¿›è¡Œä¸‹ä¸€æ­¥çš„åˆ†æï¼Œæ¯”å¦‚è¯´ï¼šæˆ‘ä»¬å‘ç°å¼ ä¸‰çš„è´¦æˆ·é‡Œæœ‰å¾ˆå¤šå…³äº AI å’ŒéŸ³ä¹çš„å†…å®¹ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ®æ­¤æ¨æµ‹å‡ºä»–å¯èƒ½æ˜¯ä¸€åç¨‹åºå‘˜ï¼Œä»è€Œæ¨é€ä»–å¯èƒ½æ„Ÿå…´è¶£çš„å†…å®¹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHqfBJFvDUzL4aceiaUtRDHyX76X941zp83yXPiabiaqQNR4IkvicZcBs7Fg/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

è¿™äº›æ•°æ®åˆ†ææ¯æ—¶æ¯åˆ»éƒ½ä¼šå‘ç”Ÿï¼Œä½†æœ‰æ—¶å€™ï¼Œä¸€ä¸ªç®€å•çš„æ•°æ®å·¥ä½œæµåœ¨å®ç°çš„æ—¶å€™å¯èƒ½ä¼šå˜å¾—ç›¸å½“å¤æ‚ï¼Œæ­¤å¤–æ•°æ®åº“æ€§èƒ½ä¹Ÿä¼šéšç€æ•°æ®é‡çš„å¢åŠ è€Œé”å‡ï¼Œæ¯”å¦‚è¯´è·å–æŸç®¡ç†è€…ä¸‹å±ä¸‰çº§æ±‡æŠ¥å…³ç³»çš„å‘˜å·¥ï¼Œè¿™ç§ç»Ÿè®¡æŸ¥è¯¢åœ¨ç°åœ¨çš„æ•°æ®åˆ†æä¸­æ˜¯ä¸€ç§å¸¸è§çš„æ“ä½œï¼Œè€Œè¿™ç§æ“ä½œå¾€å¾€ä¼šå› ä¸ºæ•°æ®åº“é€‰å‹å¯¼è‡´æ€§èƒ½äº§ç”Ÿå·¨å¤§å·®å¼‚ã€‚

**ä¼ ç»Ÿæ•°æ®åº“çš„è§£å†³æ€è·¯**
--------------

### ä¼ ç»Ÿæ•°æ®åº“çš„æ¦‚å¿µæ¨¡å‹åŠæŸ¥è¯¢çš„ä»£ç 

ä¼ ç»Ÿè§£å†³ä¸Šè¿°é—®é¢˜æœ€ç®€å•çš„æ–¹æ³•å°±æ˜¯å»ºç«‹ä¸€ä¸ªå…³ç³»æ¨¡å‹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠæ¯ä¸ªå‘˜å·¥çš„ä¿¡æ¯å½•å…¥è¡¨ä¸­ï¼Œå­˜åœ¨è¯¸å¦‚ MySQL ä¹‹ç±»çš„å…³ç³»æ•°æ®åº“ï¼Œä¸‹å›¾æ˜¯æœ€åŸºæœ¬çš„å…³ç³»æ¨¡å‹ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHLxCTicHibewQWr3V1Dn3DgKWoHMnYPBiaWmzw4yV06GUv9mHHRLIzsYpA/640?wx_fmt=png&tp=webp&wxfrom=5&wx_lazy=1&wx_co=1)

ä½†æ˜¯åŸºäºä¸Šè¿°çš„å…³ç³»æ¨¡å‹ï¼Œè¦å®ç°æˆ‘ä»¬çš„éœ€æ±‚ï¼Œå°±ä¸å¯é¿å…åœ°æ¶‰åŠåˆ°å¾ˆå¤šå…³ç³»æ•°æ®åº“ JOIN æ“ä½œï¼ŒåŒæ—¶å®ç°å‡ºæ¥çš„æŸ¥è¯¢è¯­å¥ä¹Ÿä¼šå˜å¾—ç›¸å½“é•¿(æœ‰æ—¶è¾¾åˆ°ä¸Šç™¾è¡Œ)ï¼š

```sql
(SELECT T.directReportees AS directReportees, sum(T.count) AS count
FROM (
SELECT manager.pid AS directReportees, 0 AS count
	FROM person_reportee manager
	WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
UNION
	SELECT manager.pid AS directReportees, count(manager.directly_manages) AS count
FROM person_reportee manager
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
UNION
SELECT manager.pid AS directReportees, count(reportee.directly_manages) AS count
FROM person_reportee manager
JOIN person_reportee reportee
ON manager.directly_manages = reportee.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
UNION
SELECT manager.pid AS directReportees, count(L2Reportees.directly_manages) AS count
FROM person_reportee manager
JOIN person_reportee L1Reportees
ON manager.directly_manages = L1Reportees.pid
JOIN person_reportee L2Reportees
ON L1Reportees.directly_manages = L2Reportees.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
) AS T
GROUP BY directReportees)
UNION
(SELECT T.directReportees AS directReportees, sum(T.count) AS count
FROM (
SELECT manager.directly_manages AS directReportees, 0 AS count
FROM person_reportee manager
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
UNION
SELECT reportee.pid AS directReportees, count(reportee.directly_manages) AS count
FROM person_reportee manager
JOIN person_reportee reportee
ON manager.directly_manages = reportee.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
UNION
SELECT depth1Reportees.pid AS directReportees,
count(depth2Reportees.directly_manages) AS count
FROM person_reportee manager
JOIN person_reportee L1Reportees
ON manager.directly_manages = L1Reportees.pid
JOIN person_reportee L2Reportees
ON L1Reportees.directly_manages = L2Reportees.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
) AS T
GROUP BY directReportees)
UNION
(SELECT T.directReportees AS directReportees, sum(T.count) AS count
	FROM(
	SELECT reportee.directly_manages AS directReportees, 0 AS count
FROM person_reportee manager
JOIN person_reportee reportee
ON manager.directly_manages = reportee.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
UNION
SELECT L2Reportees.pid AS directReportees, count(L2Reportees.directly_manages) AS
count
FROM person_reportee manager
JOIN person_reportee L1Reportees
ON manager.directly_manages = L1Reportees.pid
JOIN person_reportee L2Reportees
ON L1Reportees.directly_manages = L2Reportees.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
GROUP BY directReportees
) AS T
GROUP BY directReportees)
UNION
(SELECT L2Reportees.directly_manages AS directReportees, 0 AS count
FROM person_reportee manager
JOIN person_reportee L1Reportees
ON manager.directly_manages = L1Reportees.pid
JOIN person_reportee L2Reportees
ON L1Reportees.directly_manages = L2Reportees.pid
WHERE manager.pid = (SELECT id FROM person WHERE name = "fName lName")
)


```

è¿™ç§ glue ä»£ç å¯¹ç»´æŠ¤äººå‘˜å’Œå¼€å‘è€…æ¥è¯´å°±æ˜¯ä¸€åœºç¾éš¾ï¼Œæ²¡æœ‰äººæƒ³å†™æˆ–è€…å»è°ƒè¯•è¿™ç§ä»£ç ï¼Œæ­¤å¤–ï¼Œè¿™ç±»ä»£ç å¾€å¾€ä¼´éšç€ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ï¼Œè¿™ä¸ªåœ¨ä¹‹åä¼šè¯¦ç»†è®¨è®ºã€‚

### ä¼ ç»Ÿå…³ç³»æ•°æ®åº“çš„æ€§èƒ½é—®é¢˜

æ€§èƒ½é—®é¢˜çš„æœ¬è´¨åœ¨äºæ•°æ®åˆ†æé¢ä¸´çš„æ•°æ®é‡ï¼Œå‡å¦‚åªæŸ¥è¯¢å‡ åä¸ªèŠ‚ç‚¹æˆ–è€…æ›´å°‘çš„å†…å®¹ï¼Œè¿™ç§æ“ä½œæ˜¯å®Œå…¨ä¸éœ€è¦è€ƒè™‘æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–çš„ï¼Œä½†å½“èŠ‚ç‚¹æ•°æ®ä»å‡ ç™¾ä¸ªå˜æˆå‡ ç™¾ä¸‡ä¸ªç”šè‡³å‡ åƒä¸‡ä¸ªåï¼Œæ•°æ®åº“æ€§èƒ½å°±æˆä¸ºäº†æ•´ä¸ªäº§å“è®¾è®¡çš„è¿‡ç¨‹ä¸­æœ€éœ€è€ƒè™‘çš„å› ç´ ä¹‹ä¸€ã€‚

éšç€èŠ‚ç‚¹çš„å¢å¤šï¼Œç”¨æˆ·è·Ÿç”¨æˆ·é—´çš„å…³ç³»ï¼Œç”¨æˆ·å’Œäº§å“é—´çš„å…³ç³»ï¼Œæˆ–è€…äº§å“å’Œäº§å“é—´çš„å…³ç³»éƒ½ä¼šå‘ˆæŒ‡æ•°å¢é•¿ã€‚

ä»¥ä¸‹æ˜¯ä¸€äº›å…¬å¼€çš„æ•°æ®ï¼Œå¯ä»¥åæ˜ æ•°æ®ã€æ•°æ®å’Œæ•°æ®é—´å…³ç³»çš„ä¸€äº›å®é™…æƒ…å†µï¼š

*   æ¨ç‰¹ï¼šç”¨æˆ·é‡ä¸º 5 äº¿ï¼Œç”¨æˆ·ä¹‹é—´å­˜åœ¨å…³æ³¨ã€ç‚¹èµå…³ç³»
*   äºšé©¬é€Šï¼šç”¨æˆ·é‡ 1.2 äº¿ï¼Œç”¨æˆ·å’Œäº§å“é—´å­˜åœ¨è´­ä¹°å…³ç³»
*   AT&Tï¼ˆç¾å›½ä¸‰å¤§è¿è¥å•†ä¹‹ä¸€ï¼‰ï¼š1 äº¿ä¸ªå·ç ï¼Œç”µè¯å·ç é—´å¯å»ºç«‹é€šè¯å…³ç³»
    
å¦‚ä¸‹è¡¨æ‰€ç¤ºï¼Œå¼€æºçš„å›¾æ•°æ®é›†å¾€å¾€æœ‰ç€ä¸Šåƒä¸‡ä¸ªèŠ‚ç‚¹å’Œä¸Šäº¿çš„è¾¹çš„æ•°æ®ï¼š

Data set name | nodes | edges
--- | --- | ---
YahooWeb | 1.4 Billion | 6 Billion
Symantec Machine-File Graph | 1 Billion | 37 Billion
Twitter | 104 Million | 3.7 Billion
Phone call network | 30 Million | 260 Million

åœ¨æ•°æ®é‡è¿™ä¹ˆå¤§çš„åœºæ™¯ä¸­ï¼Œä½¿ç”¨ä¼ ç»Ÿ SQL ä¼šäº§ç”Ÿå¾ˆå¤§çš„æ€§èƒ½é—®é¢˜ï¼ŒåŸå› ä¸»è¦æœ‰ä¸¤ä¸ªï¼š

1.  å¤§é‡ JOIN æ“ä½œå¸¦æ¥çš„å¼€é”€ï¼šä¹‹å‰çš„æŸ¥è¯¢è¯­å¥ä½¿ç”¨äº†å¤§é‡çš„ JOIN æ“ä½œæ¥æ‰¾åˆ°éœ€è¦çš„ç»“æœã€‚è€Œå¤§é‡çš„ JOIN æ“ä½œåœ¨æ•°æ®é‡å¾ˆå¤§æ—¶ä¼šæœ‰å·¨å¤§çš„æ€§èƒ½æŸå¤±ï¼Œå› ä¸ºæ•°æ®æœ¬èº«æ˜¯è¢«å­˜æ”¾åœ¨æŒ‡å®šçš„åœ°æ–¹ï¼ŒæŸ¥è¯¢æœ¬èº«åªéœ€è¦ç”¨åˆ°éƒ¨åˆ†æ•°æ®ï¼Œä½†æ˜¯ JOIN æ“ä½œæœ¬èº«ä¼šéå†æ•´ä¸ªæ•°æ®åº“ï¼Œè¿™æ ·å°±ä¼šå¯¼è‡´æŸ¥è¯¢æ•ˆç‡ä½åˆ°è®©äººæ— æ³•æ¥å—ã€‚
2.  åå‘æŸ¥è¯¢å¸¦æ¥çš„å¼€é”€ï¼šæŸ¥è¯¢å•ä¸ªç»ç†çš„ä¸‹å±ä¸éœ€è¦å¤šå°‘å¼€é”€ï¼Œä½†æ˜¯å¦‚æœæˆ‘ä»¬è¦å»åå‘æŸ¥è¯¢ä¸€ä¸ªå‘˜å·¥çš„è€æ¿ï¼Œä½¿ç”¨è¡¨ç»“æ„ï¼Œå¼€é”€å°±ä¼šå˜å¾—éå¸¸å¤§ã€‚è¡¨ç»“æ„è®¾è®¡å¾—ä¸åˆç†ï¼Œä¼šå¯¹åç»­çš„åˆ†æã€æ¨èç³»ç»Ÿäº§ç”Ÿæ€§èƒ½ä¸Šçš„å½±å“ã€‚æ¯”å¦‚ï¼Œå½“å…³ç³»ä»_è€æ¿ -> å‘˜å·¥Â _å˜æˆÂ _ç”¨æˆ· -> äº§å“_ï¼Œå¦‚æœä¸æ”¯æŒåå‘æŸ¥è¯¢ï¼Œæ¨èç³»ç»Ÿçš„å®æ—¶æ€§å°±ä¼šå¤§æ‰“æŠ˜æ‰£ï¼Œè¿›è€Œå¸¦æ¥ç»æµæŸå¤±ã€‚
    
ä¸‹è¡¨åˆ—å‡ºçš„æ˜¯ä¸€ä¸ªéå®˜æ–¹çš„æ€§èƒ½æµ‹è¯•ï¼ˆç¤¾äº¤ç½‘ç»œæµ‹è¯•é›†ï¼Œä¸€ç™¾ä¸‡ç”¨æˆ·ï¼Œæ¯ä¸ªå¤§æ¦‚æœ‰ 50 ä¸ªå¥½å‹ï¼‰ï¼Œä½“ç°äº†åœ¨å…³ç³»æ•°æ®åº“é‡Œï¼Œéšç€å¥½å‹æŸ¥è¯¢æ·±åº¦çš„å¢åŠ è€Œäº§ç”Ÿçš„æ€§èƒ½å˜åŒ–ï¼š

levels | RDBMS execution time(s)
--- | ---
2 | 0.016
3 | 30.267
4 | 1543.595

### ä¼ ç»Ÿæ•°æ®åº“çš„å¸¸è§„ä¼˜åŒ–ç­–ç•¥

#### ç­–ç•¥ä¸€ï¼šç´¢å¼•

ç´¢å¼•ï¼šSQL å¼•æ“é€šè¿‡ç´¢å¼•æ¥æ‰¾åˆ°å¯¹åº”çš„æ•°æ®ã€‚

å¸¸è§çš„ç´¢å¼•åŒ…æ‹¬ B- æ ‘ç´¢å¼•å’Œå“ˆå¸Œç´¢å¼•ï¼Œå»ºç«‹è¡¨çš„ç´¢å¼•æ˜¯æ¯”è¾ƒå¸¸è§„çš„ä¼˜åŒ– SQL æ€§èƒ½çš„æ“ä½œã€‚B- æ ‘ç´¢å¼•ç®€å•åœ°æ¥è¯´å°±æ˜¯ç»™æ¯ä¸ªäººä¸€ä¸ªå¯æ’åºçš„ç‹¬ç«‹ IDï¼ŒB- æ ‘æœ¬èº«æ˜¯ä¸€ä¸ªå¹³è¡¡å¤šå‰æœç´¢æ ‘ï¼Œè¿™ä¸ªæ ‘ä¼šå°†æ¯ä¸ªå…ƒç´ æŒ‰ç…§ç´¢å¼• ID è¿›è¡Œæ’åºï¼Œä»è€Œæ”¯æŒèŒƒå›´æŸ¥æ‰¾ï¼ŒèŒƒå›´æŸ¥æ‰¾çš„å¤æ‚åº¦æ˜¯ O(logN)Â  ï¼Œå…¶ä¸­ N æ˜¯ç´¢å¼•çš„æ–‡ä»¶æ•°ç›®ã€‚

ä½†æ˜¯ç´¢å¼•å¹¶ä¸èƒ½è§£å†³æ‰€æœ‰çš„é—®é¢˜ï¼Œå¦‚æœæ–‡ä»¶æ›´æ–°é¢‘ç¹æˆ–è€…æœ‰å¾ˆå¤šé‡å¤çš„å…ƒç´ ï¼Œå°±ä¼šå¯¼è‡´å¾ˆå¤§çš„ç©ºé—´æŸè€—ï¼Œæ­¤å¤–ç´¢å¼•çš„ IO æ¶ˆè€—ä¹Ÿå€¼å¾—è€ƒè™‘ï¼Œç´¢å¼• IO å°¤å…¶æ˜¯åœ¨æœºæ¢°ç¡¬ç›˜ä¸Šçš„ IO è¯»å†™æ€§èƒ½ä¸Šæ¥è¯´éå¸¸ä¸ç†æƒ³ï¼Œå¸¸è§„çš„ B- æ ‘ç´¢å¼•æ¶ˆè€—å››æ¬¡ IO éšæœºè¯»ï¼Œå½“ JOIN æ“ä½œå˜å¾—è¶Šæ¥è¶Šå¤šæ—¶ï¼Œç¡¬ç›˜æŸ¥æ‰¾æ›´å¯èƒ½å‘ç”Ÿä¸Šç™¾æ¬¡ã€‚

#### ç­–ç•¥äºŒï¼šç¼“å­˜

ç¼“å­˜ï¼šç¼“å­˜ä¸»è¦æ˜¯ä¸ºäº†è§£å†³æœ‰å…·æœ‰ç©ºé—´æˆ–è€…æ—¶é—´å±€åŸŸæ€§æ•°æ®çš„é¢‘ç¹è¯»å–å¸¦æ¥çš„æ€§èƒ½ä¼˜åŒ–é—®é¢˜ã€‚ä¸€ä¸ªæ¯”è¾ƒå¸¸è§çš„ä½¿ç”¨ç¼“å­˜çš„æ¶æ„æ˜¯Â lookaside cache architectureã€‚ä¸‹å›¾æ˜¯ä¹‹å‰ Facebook ç”¨ Memcached Â + MySQL çš„å®ä¾‹ï¼ˆç°å·²è¢« Facebook è‡ªç ”çš„å›¾æ•°æ®åº“ TAO æ›¿ä»£ï¼‰ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHKIhA0AamJzWia168E16Lt8ANFRe67uxUkN98jmHo2plCXp7aJNQj9dg/640?wx_fmt=png)

åœ¨æ¶æ„ä¸­ï¼Œè®¾è®¡è€…å‡è®¾ç”¨æˆ·åˆ›é€ çš„å†…å®¹æ¯”ç”¨æˆ·è¯»å–çš„å†…å®¹è¦å°‘å¾—å¤šï¼ŒMemcached å¯ä»¥ç®€å•åœ°ç†è§£æˆä¸€ä¸ªåˆ†å¸ƒå¼çš„æ”¯æŒå¢åˆ æ”¹æŸ¥çš„å“ˆå¸Œè¡¨ï¼Œæ”¯æŒä¸Šäº¿é‡çº§çš„ç”¨æˆ·è¯·æ±‚ã€‚åŸºæœ¬çš„ä½¿ç”¨æµç¨‹æ˜¯å½“å®¢æˆ·ç«¯éœ€è¯»æ•°æ®æ—¶ï¼Œå…ˆæŸ¥çœ‹ä¸€ä¸‹ç¼“å­˜ï¼Œç„¶åå†å»æŸ¥è¯¢ SQL æ•°æ®åº“ã€‚è€Œå½“ç”¨æˆ·éœ€è¦å†™å…¥æ•°æ®æ—¶ï¼Œå®¢æˆ·ç«¯å…ˆåˆ é™¤ç¼“å­˜ä¸­çš„ keyï¼Œè®©æ•°æ®è¿‡æœŸï¼Œå†å»æ›´æ–°æ•°æ®åº“ã€‚ä½†æ˜¯è¿™ç§æ¶æ„æœ‰å‡ ä¸ªé—®é¢˜ï¼š

*   é¦–å…ˆï¼Œé”®å€¼ç¼“å­˜å¯¹äºå›¾ç»“æ„æ•°æ®å¹¶ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ“ä½œè¯­å¥ï¼Œæ¯æ¬¡æŸ¥è¯¢ä¸€æ¡è¾¹ï¼Œéœ€è¦ä»ç¼“å­˜é‡ŒæŠŠèŠ‚ç‚¹å¯¹åº”çš„è¾¹å…¨éƒ¨æ‹¿å‡ºæ¥ï¼›æ­¤å¤–ï¼Œå½“æ›´æ–°ä¸€æ¡è¾¹ï¼ŒåŸæ¥çš„æ‰€æœ‰ä¾èµ–è¾¹è¦è¢«åˆ é™¤ï¼Œç»§è€Œéœ€è¦é‡æ–°åŠ è½½æ‰€æœ‰å¯¹åº”è¾¹çš„æ•°æ®ï¼Œè¿™äº›éƒ½æ˜¯å¹¶å‘çš„æ€§èƒ½ç“¶é¢ˆï¼Œæ¯•ç«Ÿå®é™…åœºæ™¯ä¸­ä¸€ä¸ªç‚¹å¾€å¾€ä¼´éšç€å‡ åƒæ¡è¾¹ï¼Œè¿™ç§æ“ä½œå¸¦æ¥çš„æ—¶é—´ã€å†…å­˜æ¶ˆè€—é—®é¢˜ä¸å¯å¿½è§†ã€‚
    
*   å…¶æ¬¡ï¼Œæ•°æ®æ›´æ–°åˆ°æ•°æ®è¯»å–æœ‰ä¸€ä¸ªè¿‡ç¨‹ï¼Œåœ¨ä¸Šé¢æ¶æ„ä¸­è¿™ä¸ªè¿‡ç¨‹éœ€è¦ä¸»ä»æ•°æ®åº“è·¨åŸŸé€šä¿¡ã€‚åŸå§‹æ¨¡å‹ä½¿ç”¨äº†ä¸€ä¸ªå¤–éƒ¨æ ‡è¯†æ¥è®°å½•è¿‡æœŸçš„é”®å€¼å¯¹ï¼Œå¹¶ä¸”å¼‚æ­¥åœ°æŠŠè¿™äº›è¯»å–çš„è¯·æ±‚ä»åªè¯»çš„ä»èŠ‚ç‚¹ä¼ é€’åˆ°ä¸»èŠ‚ç‚¹ï¼Œè¿™ä¸ªéœ€è¦è·¨åŸŸé€šä¿¡ï¼Œå»¶è¿Ÿç›¸æ¯”ç›´æ¥ä»æœ¬åœ°è¯»å¤§äº†å¾ˆå¤šã€‚ï¼ˆç±»ä¼¼ä»ä¹‹å‰éœ€è¦èµ°å‡ ç™¾ç±³çš„è·ç¦»è€Œç°åœ¨éœ€è¦èµ°ä»åŒ—äº¬åˆ°æ·±åœ³çš„è·ç¦»ï¼‰
    

ä½¿ç”¨å›¾ç»“æ„å»ºæ¨¡
-------

ä¸Šè¿°å…³ç³»å‹æ•°æ®åº“å»ºæ¨¡å¤±è´¥çš„ä¸»è¦åŸå› åœ¨äºæ•°æ®é—´ç¼ºä¹å†…åœ¨çš„å…³è”æ€§ï¼Œé’ˆå¯¹è¿™ç±»é—®é¢˜ï¼Œæ›´å¥½çš„å»ºæ¨¡æ–¹å¼æ˜¯ä½¿ç”¨å›¾ç»“æ„ã€‚å‡å¦‚æ•°æ®æœ¬èº«å°±æ˜¯è¡¨æ ¼çš„ç»“æ„ï¼Œå…³ç³»æ•°æ®åº“å°±å¯ä»¥è§£å†³é—®é¢˜ï¼Œä½†å¦‚æœä½ è¦å±•ç¤ºçš„æ˜¯æ•°æ®ä¸æ•°æ®é—´çš„å…³ç³»ï¼Œå…³ç³»æ•°æ®åº“åè€Œä¸èƒ½è§£å†³é—®é¢˜äº†ï¼Œè¿™ä¸»è¦æ˜¯åœ¨æŸ¥è¯¢çš„è¿‡ç¨‹ä¸­ä¸å¯é¿å…çš„å¤§é‡ JOIN æ“ä½œå¯¼è‡´çš„ï¼Œè€Œæ¯æ¬¡ JOIN æ“ä½œå´åªç”¨åˆ°éƒ¨åˆ†æ•°æ®ï¼Œæ—¢ç„¶åå¤ JOIN æ“ä½œæœ¬èº«ä¼šå¯¼è‡´å¤§é‡çš„æ€§èƒ½æŸå¤±ï¼Œå¦‚ä½•å»ºæ¨¡æ‰èƒ½æ›´å¥½çš„è§£å†³é—®é¢˜å‘¢ï¼Ÿç­”æ¡ˆåœ¨ç‚¹å’Œç‚¹ä¹‹é—´çš„å…³ç³»ä¸Šã€‚

### ç‚¹ã€å…³è”å…³ç³»å’Œå›¾æ•°æ®æ¨¡å‹

åœ¨æˆ‘ä»¬ä¹‹å‰çš„è®¨è®ºä¸­ï¼Œä¼ ç»Ÿæ•°æ®åº“è™½ç„¶è¿ç”¨ JOIN æ“ä½œæŠŠä¸åŒçš„è¡¨é“¾æ¥äº†èµ·æ¥ï¼Œä»è€Œéšå¼åœ°è¡¨è¾¾äº†æ•°æ®ä¹‹é—´çš„å…³ç³»ï¼Œä½†æ˜¯å½“æˆ‘ä»¬è¦é€šè¿‡ A ç®¡ç† Bï¼ŒB ç®¡ç† A çš„æ–¹å¼æŸ¥è¯¢ç»“æœæ—¶ï¼Œè¡¨ç»“æ„å¹¶ä¸èƒ½ç›´æ¥å‘Šè¯‰æˆ‘ä»¬ç»“æœã€‚å¦‚æœæˆ‘ä»¬æƒ³åœ¨åšæŸ¥è¯¢å‰å°±çŸ¥é“å¯¹åº”çš„æŸ¥è¯¢ç»“æœï¼Œæˆ‘ä»¬å¿…é¡»å…ˆå®šä¹‰èŠ‚ç‚¹å’Œå…³ç³»ã€‚

èŠ‚ç‚¹å’Œå…³ç³»å…ˆå®šä¹‰æ˜¯å›¾æ•°æ®åº“å’Œåˆ«çš„æ•°æ®åº“çš„æ ¸å¿ƒåŒºåˆ«ã€‚æ‰“ä¸ªæ¯”æ–¹ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠç»ç†ã€å‘˜å·¥è¡¨ç¤ºæˆä¸åŒçš„èŠ‚ç‚¹ï¼Œå¹¶ç”¨ä¸€æ¡è¾¹æ¥ä»£è¡¨ä»–ä»¬ä¹‹å‰å­˜åœ¨çš„ç®¡ç†å…³ç³»ï¼Œæˆ–è€…æŠŠç”¨æˆ·å’Œå•†å“çœ‹ä½œèŠ‚ç‚¹ï¼Œç”¨è´­ä¹°å…³ç³»å»ºæ¨¡ç­‰ç­‰ã€‚è€Œå½“æˆ‘ä»¬éœ€è¦æ–°çš„èŠ‚ç‚¹å’Œå…³ç³»æ—¶ï¼Œåªéœ€è¿›è¡Œå‡ æ¬¡æ›´æ–°å°±å¥½ï¼Œè€Œä¸ç”¨å»æ”¹å˜è¡¨çš„ç»“æ„æˆ–è€…å»è¿ç§»æ•°æ®ã€‚

æ ¹æ®èŠ‚ç‚¹å’Œå…³è”å…³ç³»ï¼Œä¹‹å‰çš„æ•°æ®å¯ä»¥æ ¹æ®ä¸‹å›¾æ‰€ç¤ºå»ºæ¨¡ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHUWU6UbiauX9LTD240tFz1Uw3CEj7wh4icRUm3hHUX4nP61uviaOUrpjnQ/640?wx_fmt=png)

é€šè¿‡å›¾æ•°æ®åº“ Nebula Graph åŸç”Ÿ nGQL å›¾æŸ¥è¯¢è¯­è¨€è¿›è¡Œå»ºæ¨¡ï¼Œå‚è€ƒå¦‚ä¸‹æ“ä½œï¼š

```sql
-- Insert People
INSERT VERTEX person(ID, name) VALUES 1:(2020031601, â€˜Jeffâ€™);
INSERT VERTEX person(ID, name) VALUES 2:(2020031602, â€˜Aâ€™);
INSERT VERTEX person(ID, name) VALUES 3:(2020031603, â€˜Bâ€™);
INSERT VERTEX person(ID, name) VALUES 4:(2020031604, â€˜Câ€™);

-- Insert edge
INSERT EDGE manage (level_s, level_end) VALUES 1 -> 2: ('0'ï¼Œ '1')
INSERT EDGE manage (level_s, level_end) VALUES 1 -> 3: ('0'ï¼Œ '1')
INSERT EDGE manage (level_s, level_end) VALUES 1 -> 4: ('0'ï¼Œ '1')
```

è€Œä¹‹å‰è¶…é•¿çš„ query è¯­å¥ä¹Ÿå¯ä»¥é€šè¿‡ Cypher / nGQL ç¼©å‡æˆçŸ­çŸ­çš„ 3ã€4 è¡Œä»£ç ã€‚

ä¸‹é¢ä¸º nGQL è¯­å¥

```
GO FROM 1 OVER manage YIELD manage.level_s as start_level, manage._dst AS personid
| GO FROM $personid OVER manage where manage.level_s < start_level + 3
YIELD SUM($$.person.id) AS TOTAL, $$.person.name AS list
```

ä¸‹é¢ä¸º Cypher ç‰ˆæœ¬

```
MATCH (boss)-[:MANAGES*0..3]->(sub),
(sub)-[:MANAGES*1..3]->(personid)
WHERE boss.name = â€œJeffâ€
RETURN sub.name AS list, count(personid) AS Total


```

ä»è¿‘ç™¾è¡Œä»£ç å˜æˆ 3ã€4 è¡Œä»£ç å¯ä»¥æ˜æ˜¾åœ°çœ‹å‡ºå›¾æ•°æ®åº“åœ¨æ•°æ®è¡¨è¾¾èƒ½åŠ›ä¸Šçš„ä¼˜åŠ¿ã€‚

**å›¾æ•°æ®åº“æ€§èƒ½ä¼˜åŒ–**
------------

å›¾æ•°æ®åº“æœ¬èº«å¯¹é«˜åº¦è¿æ¥ã€ç»“æ„æ€§ä¸å¼ºçš„æ•°æ®åšäº†ä¸“é—¨ä¼˜åŒ–ã€‚ä¸åŒçš„å›¾æ•°æ®åº“æ ¹æ®ä¸åŒçš„åœºæ™¯ä¹Ÿåšäº†é’ˆå¯¹æ€§ä¼˜åŒ–ï¼Œç¬”è€…åœ¨è¿™é‡Œç®€å•ä»‹ç»ä»¥ä¸‹å‡ ç§å›¾æ•°æ®åº“ï¼ŒBTWï¼Œè¿™äº›å›¾æ•°æ®åº“éƒ½æ”¯æŒåŸç”Ÿå›¾å»ºæ¨¡ã€‚

### Neo4j

Neo4j æ˜¯æœ€çŸ¥åçš„ä¸€ç§å›¾æ•°æ®åº“ï¼Œåœ¨ä¸šç•Œæœ‰å¾®è½¯ã€ebay åœ¨ç”¨ Neo4j æ¥è§£å†³éƒ¨åˆ†ä¸šåŠ¡åœºæ™¯ï¼ŒNeo4j çš„æ€§èƒ½ä¼˜åŒ–æœ‰ä¸¤ç‚¹ï¼Œä¸€ä¸ªæ˜¯åŸç”Ÿå›¾æ•°æ®å¤„ç†ä¸Šçš„ä¼˜åŒ–ï¼Œä¸€ä¸ªæ˜¯è¿ç”¨äº† LRU-K ç¼“å­˜æ¥ç¼“å­˜æ•°æ®ã€‚

#### åŸç”Ÿå›¾æ•°æ®å¤„ç†ä¼˜åŒ–

æˆ‘ä»¬è¯´ä¸€ä¸ªå›¾æ•°æ®åº“æ”¯æŒåŸç”Ÿå›¾æ•°æ®å¤„ç†å°±ä»£è¡¨è¿™ä¸ªæ•°æ®åº“æœ‰èƒ½åŠ›å»æ”¯æŒÂ index-free adjacencyã€‚

index-free adjancencyÂ å°±æ˜¯æ¯ä¸ªèŠ‚ç‚¹ä¼šä¿ç•™è¿æ¥èŠ‚ç‚¹çš„å¼•ç”¨ï¼Œä»è€Œè¿™ä¸ªèŠ‚ç‚¹æœ¬èº«å°±æ˜¯è¿æ¥èŠ‚ç‚¹çš„ä¸€ä¸ªç´¢å¼•ï¼Œè¿™ç§æ“ä½œçš„æ€§èƒ½æ¯”ä½¿ç”¨å…¨å±€ç´¢å¼•å¥½å¾ˆå¤šï¼ŒåŒæ—¶å‡å¦‚æˆ‘ä»¬æ ¹æ®å›¾æ¥è¿›è¡ŒæŸ¥è¯¢ï¼Œè¿™ç§æŸ¥è¯¢æ˜¯ä¸æ•´ä¸ªå›¾çš„å¤§å°æ— å…³çš„ï¼Œåªä¸æŸ¥è¯¢èŠ‚ç‚¹å…³è”è¾¹çš„æ•°ç›®æœ‰å…³ï¼Œå¦‚æœç”¨ B æ ‘ç´¢å¼•è¿›è¡ŒæŸ¥è¯¢çš„å¤æ‚åº¦æ˜¯ O(logN)ï¼Œä½¿ç”¨è¿™ç§ç»“æ„æŸ¥è¯¢çš„å¤æ‚åº¦å°±æ˜¯ O(1)ã€‚å½“æˆ‘ä»¬è¦æŸ¥è¯¢å¤šå±‚æ•°æ®æ—¶ï¼ŒæŸ¥è¯¢æ‰€éœ€è¦çš„æ—¶é—´ä¹Ÿä¸ä¼šéšç€æ•°æ®é›†çš„å˜å¤§è€Œå‘ˆç°æŒ‡æ•°å¢é•¿ï¼Œåè€Œä¼šæ˜¯ä¸€ä¸ªæ¯”è¾ƒç¨³å®šçš„å¸¸æ•°ï¼Œæ¯•ç«Ÿæ¯æ¬¡æŸ¥è¯¢åªä¼šæ ¹æ®å¯¹åº”çš„èŠ‚ç‚¹æ‰¾åˆ°è¿æ¥çš„è¾¹è€Œä¸ä¼šå»éå†æ‰€æœ‰çš„èŠ‚ç‚¹ã€‚

#### ä¸»å­˜ç¼“å­˜ä¼˜åŒ–

åœ¨ 2.2 ç‰ˆæœ¬çš„ Neo4j ä¸­ä½¿ç”¨äº† LRU-K ç¼“å­˜ï¼Œè¿™ç§ç¼“å­˜ç®€è€Œè¨€ä¹‹å°±æ˜¯å°†ä½¿ç”¨é¢‘ç‡æœ€ä½çš„é¡µé¢ä»ç¼“å­˜ä¸­å¼¹å‡ºï¼Œé’çä½¿ç”¨é¢‘ç‡æ›´é«˜çš„é¡µé¢ï¼Œè¿™ç§è®¾è®¡ä¿è¯åœ¨ç»Ÿè®¡æ„ä¹‰ä¸Šçš„ç¼“å­˜èµ„æºä½¿ç”¨æœ€ä¼˜åŒ–ã€‚

### JanusGraph

JanusGraph æœ¬èº«å¹¶æ²¡æœ‰å…³æ³¨äºå»å®ç°å­˜å‚¨å’Œåˆ†æï¼Œè€Œæ˜¯å®ç°äº†å›¾æ•°æ®åº“å¼•æ“ä¸å¤šç§ç´¢å¼•å’Œå­˜å‚¨å¼•æ“çš„æ¥å£ï¼Œåˆ©ç”¨è¿™äº›æ¥å£æ¥å®ç°æ•°æ®å’Œå­˜å‚¨å’Œç´¢å¼•ã€‚JanusGraph ä¸»è¦ç›®çš„æ˜¯åœ¨åŸæ¥æ¡†æ¶çš„åŸºç¡€ä¸Šæ”¯æŒå›¾æ•°æ®çš„å»ºæ¨¡åŒæ—¶ä¼˜åŒ–å›¾æ•°æ®åºåˆ—åŒ–ã€å›¾æ•°æ®å»ºæ¨¡ã€å›¾æ•°æ®æ‰§è¡Œç›¸å…³çš„ç»†èŠ‚ã€‚JanusGraph æä¾›äº†æ¨¡å—åŒ–çš„æ•°æ®æŒä¹…åŒ–ã€æ•°æ®ç´¢å¼•å’Œå®¢æˆ·ç«¯çš„æ¥å£ï¼Œä»è€Œæ›´æ–¹ä¾¿åœ°å°†å›¾æ•°æ®æ¨¡å‹è¿ç”¨åˆ°å®é™…å¼€å‘ä¸­ã€‚

æ­¤å¤–ï¼ŒJanusGraph æ”¯æŒç”¨ Cassandraã€HBaseã€BerkelyDB ä½œä¸ºå­˜å‚¨å¼•æ“ï¼Œæ”¯æŒä½¿ç”¨ ElasticSearchã€Solr è¿˜æœ‰ Lucene è¿›è¡Œæ•°æ®ç´¢å¼•ã€‚åœ¨åº”ç”¨æ–¹é¢ï¼Œå¯ä»¥ç”¨ä¸¤ç§æ–¹å¼ä¸ JanusGraph è¿›è¡Œäº¤äº’ï¼š

*   å°† JanusGraph å˜æˆåº”ç”¨çš„ä¸€éƒ¨åˆ†è¿›è¡ŒæŸ¥è¯¢ã€ç¼“å­˜ï¼Œå¹¶ä¸”è¿™äº›æ•°æ®äº¤äº’éƒ½æ˜¯åœ¨åŒä¸€å° JVM ä¸Šæ‰§è¡Œï¼Œä½†æ•°æ®çš„æ¥æºå¯èƒ½åœ¨æœ¬åœ°æˆ–è€…åœ¨åˆ«çš„åœ°æ–¹ã€‚
    
*   å°† JanusGraph ä½œä¸ºä¸€ä¸ªæœåŠ¡ï¼Œè®©å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯åˆ†ç¦»ï¼ŒåŒæ—¶å®¢æˆ·ç«¯æäº¤ Gremlin æŸ¥è¯¢è¯­å¥åˆ°æœåŠ¡å™¨ä¸Šæ‰§è¡Œå¯¹åº”çš„æ•°æ®å¤„ç†æ“ä½œã€‚
    

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHTn1VNGKtLQ8viaIic22kzCYZeQfkiaSxaLzffQFN2Pup6DIYWLMBMBP9Q/640?wx_fmt=png)

### Nebula Graph  

ä¸‹é¢ç®€å•åœ°ä»‹ç»äº†ä¸€ä¸‹ Nebula Graph çš„ç³»ç»Ÿè®¾è®¡ã€‚

#### ä½¿ç”¨ KV å¯¹æ¥è¿›è¡Œå›¾æ•°æ®å¤„ç†

Nebula Graph ä½¿ç”¨äº†Â `vertexID + TagID` ä½œä¸ºé”®åœ¨ä¸åŒçš„ partition é—´å­˜å‚¨ in-key å’Œ out-key ç›¸å…³çš„æ•°æ®ï¼Œè¿™ç§æ“ä½œå¯ä»¥ç¡®ä¿åœ¨å¤§è§„æ¨¡é›†ç¾¤ä¸Šçš„é«˜å¯ç”¨ï¼Œä½¿ç”¨åˆ†å¸ƒå¼çš„ partition å’Œ sharding ä¹Ÿå¢åŠ äº† Nebula Graph çš„ååé‡å’Œå®¹é”™çš„èƒ½åŠ›ã€‚

#### Shared-noting åˆ†å¸ƒå¼å­˜å‚¨å±‚

Storage Service é‡‡ç”¨ shared-nothing çš„åˆ†å¸ƒå¼æ¶æ„è®¾è®¡ï¼Œæ¯ä¸ªå­˜å‚¨èŠ‚ç‚¹éƒ½æœ‰å¤šä¸ªæœ¬åœ° KV å­˜å‚¨å®ä¾‹ä½œä¸ºç‰©ç†å­˜å‚¨ã€‚Nebula é‡‡ç”¨å¤šæ•°æ´¾åè®® Raft æ¥ä¿è¯è¿™äº› KV å­˜å‚¨ä¹‹é—´çš„ä¸€è‡´æ€§ï¼ˆç”±äº Raft æ¯” Paxo æ›´ç®€æ´ï¼Œæˆ‘ä»¬é€‰ç”¨äº† Raftï¼‰ã€‚åœ¨ KVStore ä¹‹ä¸Šæ˜¯å›¾è¯­ä¹‰å±‚ï¼Œç”¨äºå°†å›¾æ“ä½œè½¬æ¢ä¸ºä¸‹å±‚ KV æ“ä½œã€‚å›¾æ•°æ®ï¼ˆç‚¹å’Œè¾¹ï¼‰é€šè¿‡ Hash çš„æ–¹å¼å­˜å‚¨åœ¨ä¸åŒ partition ä¸­ã€‚è¿™é‡Œç”¨çš„ Hash å‡½æ•°å®ç°å¾ˆç›´æ¥ï¼Œå³ vertex_id å–ä½™ partition æ•°ã€‚åœ¨ Nebula Graph ä¸­ï¼Œpartition è¡¨ç¤ºä¸€ä¸ªè™šæ‹Ÿçš„æ•°æ®é›†ï¼Œè¿™äº› partition åˆ†å¸ƒåœ¨æ‰€æœ‰çš„å­˜å‚¨èŠ‚ç‚¹ï¼Œåˆ†å¸ƒä¿¡æ¯å­˜å‚¨åœ¨ Meta Service ä¸­ï¼ˆå› æ­¤æ‰€æœ‰çš„å­˜å‚¨èŠ‚ç‚¹å’Œè®¡ç®—èŠ‚ç‚¹éƒ½èƒ½è·å–åˆ°è¿™ä¸ªåˆ†å¸ƒä¿¡æ¯ï¼‰ã€‚

#### æ— çŠ¶æ€è®¡ç®—å±‚

æ¯ä¸ªè®¡ç®—èŠ‚ç‚¹éƒ½è¿è¡Œç€ä¸€ä¸ªæ— çŠ¶æ€çš„æŸ¥è¯¢è®¡ç®—å¼•æ“ï¼Œè€ŒèŠ‚ç‚¹å½¼æ­¤é—´æ— ä»»ä½•é€šä¿¡å…³ç³»ã€‚è®¡ç®—èŠ‚ç‚¹ä»…ä» Meta Service è¯»å– meta ä¿¡æ¯ï¼Œä»¥åŠå’Œ Storage Service è¿›è¡Œäº¤äº’ã€‚è¿™æ ·è®¾è®¡ä½¿å¾—è®¡ç®—å±‚é›†ç¾¤æ›´å®¹æ˜“ä½¿ç”¨ K8s ç®¡ç†æˆ–éƒ¨ç½²åœ¨äº‘ä¸Šã€‚è®¡ç®—å±‚çš„è´Ÿè½½å‡è¡¡æœ‰ä¸¤ç§å½¢å¼ï¼Œæœ€å¸¸è§çš„æ–¹å¼æ˜¯åœ¨è®¡ç®—å±‚ä¸ŠåŠ ä¸€ä¸ªè´Ÿè½½å‡è¡¡ï¼ˆbalanceï¼‰ï¼Œç¬¬äºŒç§æ–¹æ³•æ˜¯å°†è®¡ç®—å±‚æ‰€æœ‰èŠ‚ç‚¹çš„ IP åœ°å€é…ç½®åœ¨å®¢æˆ·ç«¯ä¸­ï¼Œè¿™æ ·å®¢æˆ·ç«¯å¯ä»¥éšæœºé€‰å–è®¡ç®—èŠ‚ç‚¹è¿›è¡Œè¿æ¥ã€‚æ¯ä¸ªæŸ¥è¯¢è®¡ç®—å¼•æ“éƒ½èƒ½æ¥æ”¶å®¢æˆ·ç«¯çš„è¯·æ±‚ï¼Œè§£ææŸ¥è¯¢è¯­å¥ï¼Œç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘ï¼ˆASTï¼‰å¹¶å°† AST ä¼ é€’ç»™æ‰§è¡Œè®¡åˆ’å™¨å’Œä¼˜åŒ–å™¨ï¼Œæœ€åå†äº¤ç”±æ‰§è¡Œå™¨æ‰§è¡Œã€‚

**å›¾æ•°æ®åº“æ˜¯å½“ä»Šçš„è¶‹åŠ¿**
--------------

åœ¨å½“ä»Šï¼Œå›¾æ•°æ®åº“æ”¶åˆ°äº†æ›´å¤šåˆ†æå¸ˆå’Œå’¨è¯¢å…¬å¸çš„å…³æ³¨

> Graph analysis is possibly the single most effective Â competitive differentiator for organizations Â pursuing data-driven operations and Â decisions after the design of data capture. Â  Â  Â  Â --------------Gartner

> â€œGraph analysis is the true killer app for Big Data.â€ Â  Â  Â --------------------Forrester

åŒæ—¶å›¾æ•°æ®åº“åœ¨ DB-Ranking ä¸Šçš„æ’åä¹Ÿå‘ˆç°å‡ºä¸Šå‡æœ€å¿«çš„è¶‹åŠ¿ï¼Œå¯è§éœ€æ±‚ä¹‹è¿«åˆ‡ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBH3LwSzLfLK9vlmdSIyQ7xRlVIdT1m43mOCcdwQibOgVWGbB16MvaxWow/640?wx_fmt=png)

**å›¾æ•°æ®åº“å®è·µï¼šä¸ä»…ä»…æ˜¯ç¤¾äº¤ç½‘ç»œ**
-------------------

### Netflix äº‘æ•°æ®åº“çš„å·¥ç¨‹å®è·µ

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHmfSk9VpegZm7IibjrDbfgzZibQ5dGwBDibtiavJo6kgmiaibiamPCI1oHNBlA/640?wx_fmt=png)

Netflix é‡‡ç”¨äº† JanusGraph + Cassandra + ElasticSearch ä½œä¸ºè‡ªèº«çš„å›¾æ•°æ®åº“æ¶æ„ï¼Œä»–ä»¬è¿ç”¨è¿™ç§æ¶æ„æ¥åšæ•°å­—èµ„äº§ç®¡ç†ã€‚èŠ‚ç‚¹è¡¨ç¤ºæ•°å­—äº§å“æ¯”å¦‚ç”µå½±ã€çºªå½•ç‰‡ç­‰ï¼ŒåŒæ—¶è¿™äº›äº§å“ä¹‹é—´çš„å…³ç³»å°±æ˜¯èŠ‚ç‚¹é—´çš„è¾¹ã€‚å½“å‰çš„ Netflix æœ‰å¤§æ¦‚ 2 äº¿çš„èŠ‚ç‚¹ï¼Œ70 å¤šç§æ•°å­—äº§å“ï¼Œæ¯åˆ†é’Ÿéƒ½æœ‰ä¸Šç™¾æ¡çš„ query å’Œæ•°æ®æ›´æ–°ã€‚æ­¤å¤–ï¼ŒNetflix ä¹ŸæŠŠå›¾æ•°æ®åº“è¿ç”¨åœ¨äº†æˆæƒã€åˆ†å¸ƒå¼è¿½è¸ªã€å¯è§†åŒ–å·¥ä½œæµä¸Šã€‚æ¯”å¦‚å¯è§†åŒ– Git çš„ commitï¼Œjenkins éƒ¨ç½²è¿™äº›å·¥ä½œã€‚

### Adobe çš„æŠ€æœ¯è¿­ä»£

ä¸€èˆ¬è€Œè¨€ï¼Œæ–°æŠ€æœ¯å¾€å¾€åœ¨å¼€å§‹çš„æ—¶å€™å¤§éƒ½ä¸è¢«å¤§å…¬å¸æ‰€é’çï¼Œå›¾æ•°æ®åº“å¹¶æ²¡æœ‰ä¾‹å¤–ï¼Œå¤§å…¬å¸æœ¬èº«æœ‰å¾ˆå¤šçš„é—ç•™é¡¹ç›®ï¼Œè€Œè¿™äº›é¡¹ç›®æœ¬èº«çš„ç”¨æˆ·ä½“é‡å’Œä½¿ç”¨éœ€æ±‚åˆè®©è¿™äº›å…¬å¸ä¸æ•¢å†’ç€é£é™©æ¥ä½¿ç”¨æ–°æŠ€æœ¯å»æ”¹å˜è¿™äº›å¤„äºç¨³å®šçš„äº§å“ã€‚Adobe åœ¨è¿™é‡Œåšäº†ä¸€ä¸ªè¿­ä»£æ–°æŠ€æœ¯çš„ä¾‹å­ï¼Œç”¨ Neo4j å›¾æ•°æ®åº“æ›¿æ¢äº†æ—§çš„ NoSQL Cassandra æ•°æ®åº“ã€‚

è¿™ä¸ªè¢«å¤§æ”¹çš„ç³»ç»Ÿåå­—å« Behanceï¼Œæ˜¯ Adobe åœ¨ 15 å¹´å‘å¸ƒçš„ä¸€ä¸ªå†…å®¹ç¤¾äº¤å¹³å°ï¼Œæœ‰å¤§æ¦‚ 1 åƒä¸‡çš„ç”¨æˆ·ï¼Œåœ¨è¿™é‡Œäººä»¬å¯ä»¥åˆ†äº«è‡ªå·±çš„åˆ›ä½œç»™ç™¾ä¸‡äººçœ‹ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHq6yia9e7AtSwBDz6M0KBABJhxuYMtYAT6cUo39WtM7FoVEYGPcT75dQ/640?wx_fmt=png)

è¿™æ ·ä¸€ä¸ªå·¨å¤§çš„é—ç•™ç³»ç»Ÿæœ¬æ¥æ˜¯é€šè¿‡ Cassandra å’Œ MongoDB æ­å»ºçš„ï¼ŒåŸºäºå†å²é—ç•™é—®é¢˜ï¼Œç³»ç»Ÿæœ‰ä¸å°‘çš„æ€§èƒ½ç“¶é¢ˆä¸å¾—ä¸è§£å†³ã€‚MongoDB å’Œ Cassandra çš„è¯»å–æ€§èƒ½æ…¢ä¸»è¦å› ä¸ºåŸå…ˆçš„ç³»ç»Ÿè®¾è®¡é‡‡ç”¨äº† fan-out çš„è®¾è®¡æ¨¡å¼â€”â€”å—å…³æ³¨å¤šçš„ç”¨æˆ·å‘è¡¨çš„å†…å®¹ä¼šå•ç‹¬åˆ†å‘ç»™æ¯ä¸ªè¯»è€…ï¼Œè¿™ç§è®¾è®¡æ¨¡å¼ä¹Ÿå¯¼è‡´äº†ç½‘ç»œæ¶æ„çš„å¤§å»¶è¿Ÿï¼Œæ­¤å¤– Cassandra æœ¬èº«çš„è¿ç»´ä¹Ÿéœ€è¦ä¸å°çš„æŠ€æœ¯å›¢é˜Ÿï¼Œè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¾ˆå¤§çš„é—®é¢˜ã€‚

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHujFy9lic88mciaUTepkiapTCCQib9w4fTg5fOLicJyS2SqVx4JJW3db9LUw/640?wx_fmt=png)

åœ¨è¿™é‡Œä¸ºäº†æ­å»ºä¸€ä¸ªçµæ´»ã€é«˜æ•ˆã€ç¨³å®šçš„ç³»ç»Ÿæ¥æä¾›æ¶ˆæ¯ feeding å¹¶æœ€å°åŒ–æ•°æ®å­˜å‚¨çš„è§„æ¨¡ï¼ŒAdobe å†³å®šè¿ç§»åŸæœ¬çš„ Cassandra æ•°æ®åº“åˆ° Neo4j å›¾æ•°æ®åº“ã€‚åœ¨ Neo4j å›¾æ•°æ®åº“ä¸­é‡‡ç”¨ä¸€ç§æ‰€è°“çš„Â Tiered relationshipsÂ æ¥è¡¨ç¤ºç”¨æˆ·ä¹‹é—´çš„å…³ç³»ï¼Œè¿™ä¸ªè¾¹çš„å…³ç³»å¯ä»¥å»å®šä¹‰ä¸åŒçš„è®¿é—®çŠ¶æ€ï¼Œæ¯”å¦‚ï¼šä»…éƒ¨åˆ†ç”¨æˆ·å¯è§ï¼Œä»…å…³æ³¨è€…å¯è§è¿™äº›åŸºæœ¬æ“ä½œã€‚æ•°æ®æ¨¡å‹å¦‚å›¾æ‰€ç¤º

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBH0wNAnelria4WKMD6oiaJFKF8K24RuUpCx3IMGibeVVGjOV5dkwoDXnzAQ/640?wx_fmt=png)

ä½¿ç”¨è¿™ç§æ•°æ®æ¨¡å‹å¹¶ä½¿ç”¨ Leader-follower æ¶æ„æ¥ä¼˜åŒ–è¯»å†™ï¼Œè¿™ä¸ªå¹³å°è·å¾—äº†å·¨å¤§çš„æ€§èƒ½æå‡ï¼š

![](https://mmbiz.qpic.cn/mmbiz_png/dkwuWwLoRK9AWzSn8sp6LkQjHRQoibicBHfUJAGOfYDyVs3Azy8NAQ6aicoYmpQbQyIs6wc404udlHh9ib12pCsajA/640?wx_fmt=png)

1.  è¿ç»´éœ€æ±‚çš„æ—¶é•¿åœ¨ä½¿ç”¨äº† Neo4j ä»¥åä¸‹é™äº† 300%ã€‚
    
2.  å­˜å‚¨éœ€æ±‚é™ä½äº† 1000 å€ï¼Œ Neo4j ä»…éœ€ 50G å­˜å‚¨æ•°æ®ï¼Œ è€Œ Cassandra éœ€è¦ 50TBã€‚
    
3.  ä»…ä»…éœ€è¦ 3 ä¸ªæœåŠ¡å®ä¾‹å°±å¯ä»¥æ”¯æŒæ•´ä¸ªæœåŠ¡å™¨çš„æµç•…è¿è¡Œï¼Œä¹‹å‰åˆ™éœ€è¦ 48 ä¸ªã€‚
    
4.  å›¾æ•°æ®åº“æœ¬èº«å°±æä¾›äº†æ›´é«˜çš„å¯æ‰©å±•æ€§ã€‚
    

**ç»“è®º**
------

åœ¨å½“ä»Šçš„å¤§æ•°æ®æ—¶ä»£ï¼Œé‡‡ç”¨å›¾æ•°æ®åº“å¯ä»¥ç”¨å°æˆæœ¬åœ¨åŸæœ‰æ¶æ„ä¸Šè·å¾—å·¨å¤§çš„æ€§èƒ½æå‡ã€‚å›¾æ•°æ®åº“ä¸ä»…ä»…å¯ä»¥åœ¨ 5Gã€AIã€ç‰©è”ç½‘é¢†åŸŸå‘æŒ¥å·¨å¤§çš„æ¨åŠ¨ä½œç”¨ï¼ŒåŒæ—¶ä¹Ÿå¯ä»¥ç”¨æ¥é‡æ„åŸæœ¬çš„é—ç•™ç³»ç»Ÿã€‚è™½ç„¶ä¸åŒçš„å›¾æ•°æ®åº“å¯èƒ½æœ‰ç€æˆªç„¶ä¸åŒçš„åº•å±‚å®ç°ï¼Œä½†è¿™äº›éƒ½å®Œå…¨æ”¯æŒç”¨å›¾çš„æ–¹å¼æ¥æ„å»ºæ•°æ®æ¨¡å‹ä»è€Œè®©ä¸åŒçš„ç»„ä»¶ä¹‹é—´ç›¸äº’è”ç³»ï¼Œä»æˆ‘ä»¬ä¹‹å‰çš„è®¨è®ºæ¥çœ‹ï¼Œè¿™ä¸€ç§æ•°æ®æ¨¡å‹å±‚æ¬¡çš„æ”¹å˜ä¼šæå¤§åœ°ç®€åŒ–å¾ˆå¤šæ—¥å¸¸æ•°æ®ç³»ç»Ÿä¸­æ‰€é¢ä¸´çš„é—®é¢˜ï¼Œå¢å¤§ç³»ç»Ÿçš„ååé‡å¹¶ä¸”é™ä½è¿ç»´çš„éœ€æ±‚ã€‚

å›¾æ•°æ®åº“çš„ä»‹ç»å°±åˆ°æ­¤ä¸ºæ­¢äº†ï¼Œå¦‚æœä½ å¯¹å›¾æ•°æ®åº“ Nebula Graph æœ‰ä»»ä½•æƒ³æ³•æˆ–å…¶ä»–è¦æ±‚ï¼Œæ¬¢è¿å» GitHubï¼šhttps://github.com/vesoft-inc/nebula issue åŒºå‘æˆ‘ä»¬æ issue æˆ–è€…å‰å¾€å®˜æ–¹è®ºå›ï¼šhttps://discuss.nebula-graph.io/Â çš„Â `Feedback` åˆ†ç±»ä¸‹æå»ºè®® ğŸ‘ï¼›

**Reference**
-------------

*   [1]Â An Overview Of Neo4j And The Property Graph Model Berkeley, CS294, Nov 2015Â https://people.eecs.berkeley.edu/~istoica/classes/cs294/15/notes/21-neo4j.pdf
*   [2] several original data sources from talk made by Duen Horng (Polo) Chau ( Geogia tech ) www.selectscience.net www.phonedog.comã€www.mediabistro.com www.practicalecommerce.com/
*   [3] Graphs / Networks Basics, how to build & store graphs, laws, etc. Centrality, and algorithms you should knowÂ  Â Duen Horng (Polo) Chau(Georgia tech)
*   [4]Â Graph databases, 2nd Edition: New Oppotunities for Connected Data
*   [5] R. Nishtala, H. Fugal, S. Grimm, M. Kwiatkowski, H. Lee, H. C.Li, R. McElroy, M. Paleczny, D. Peek, P. Saab, D. Stafford, T. Tung, and V. Venkataramani. Scaling Memcache at Facebook.In Proceedings of the 10th USENIX conference on Networked Systems Design and Implementation, NSDI, 2013.
*   [6]Â Nathan Bronson, Zach Amsden, George Cabrera, Prasad Chakka, Peter Dimov Hui Ding, Jack Ferris, Anthony Giardullo, Sachin Kulkarni, Harry Li, Mark Marchukov Dmitri Petrov, Lovro Puzar, Yee Jiun Song, Venkat VenkataramaniÂ  TAO: Facebook's Distributed Data Store for the Social GraphÂ USENIX 2013
*   [7] Janus Graph ArchitectureÂ https://docs.janusgraph.org/getting-started/architecture/
*   [8]Â Nebula Graph Architecture â€” A Bird's ViewÂ https://nebula-graph.io/en/posts/nebula-graph-architecture-overview/
*   [9] database engine trendingÂ https://db-engines.com/en/ranking_categories
*   [10] Netflix Content Data Management talkÂ https://www.slideshare.net/RoopaTangirala/polyglot-persistence-netflix-cde-meetup-90955706#86
*   [11] Harnessing the Power of Neo4j for Overhauling Legacy Systems at AdobeÂ https://neo4j.com/graphconnect-2018/session/overhauling-legacy-systems-adobe
    

END
