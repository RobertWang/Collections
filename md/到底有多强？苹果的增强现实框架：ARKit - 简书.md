> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [www.jianshu.com](https://www.jianshu.com/p/d7dcf46f3705)

ç›¸å…³
--

[ARKit å®æˆ˜ï¼šå¦‚ä½•å®ç°ä»»æ„é—¨](https://www.jianshu.com/p/b377e8b8a8f2)  
[Animoji å®ç°æ–¹æ¡ˆåˆ†äº«](https://www.jianshu.com/p/04dd3ec22cbf)  
[Animoji æ¨¡å‹ä¼˜åŒ–æ–¹æ¡ˆæ€»ç»“](https://www.jianshu.com/p/1ed810c02532)  
[ARKit è¿›é˜¶ï¼šç‰©ç†ä¸–ç•Œ](https://www.jianshu.com/p/d7dcf46f3705)  
[ARKit è¿›é˜¶ï¼šæè´¨](https://www.jianshu.com/p/07b96c800a1d)  
[è§£å†³ ARKit ç”¨ Metal å½•åˆ¶æ—¶é¢œè‰²å˜æš—çš„é—®é¢˜](https://www.jianshu.com/p/25a1823f857c)  
[è®°ä¸€ä¸ª SceneKit Morpher å¼•å‘çš„ Crash](https://www.jianshu.com/p/3944ff013112)

å†™åœ¨å‰é¢
----

> å…¶å®å‡†å¤‡ ARKit å·²ç»å¾ˆä¹…äº†ï¼Œç¡®åˆ‡åœ°è¯´å½“ WWDC å¼€å§‹ä»‹ç»æ—¶å°±å¼€å§‹äº†ã€‚å…¶åå‚åŠ äº†è‹¹æœçš„ ARKit workShopï¼ŒåŠ ä¸Šè‡ªå·±æœ‰ç‚¹äº‹ï¼Œæ‰€ä»¥æ–‡ç« ä¸€ç›´æ²¡å‘å‡ºæ¥ï¼Œç°åœ¨å†å‘ä¸€ç¯‡ä¸Šæ‰‹æ–‡ç« ï¼Œä¹Ÿæ²¡ä»€ä¹ˆæ„ä¹‰ã€‚æ‰€ä»¥æœ¬ç¯‡æ–‡ç« é‡åœ¨ workShop ä¸Šä¸è‹¹æœå·¥ç¨‹å¸ˆçš„äº¤æµå’Œæˆ‘å¯¹ ARKit çš„ç†è§£, æœ€åä¼šç®€å•ä»‹ç»ä¸€ä¸‹ç›¸å…³æŠ€æœ¯ã€‚

æ›´æ–°
--

è‹¹æœæœ€è¿‘æ›´æ–°äº† ARKit çš„æ–‡æ¡£ï¼ŒåŠ å…¥äº†åŸºäºæ·±åº¦æ‘„åƒå¤´çš„äººè„¸è¯†åˆ«ï¼ˆç›®å‰å°±æ˜¯ iPhone X çš„å‰ç½®æ‘„åƒå¤´ï¼‰ã€‚åœ¨ work shop ä¸Š ARKit å›¢é˜Ÿæ˜ç¡®è¡¨ç¤ºä¸ä¼šæ”¯æŒå‰ç½®æ‘„åƒå¤´ï¼Œè¿™ä¹ˆå¿«å°±è¢«æ‰“è„¸â€¦â€¦ æ‰€ä»¥å¤§å®¶å¯ä»¥æœŸå¾…ï¼ŒARKit å°†åœ¨å‰ç½®æ‘„åƒå¤´ä¸Šæœ‰æ›´å¤šçš„åº”ç”¨ã€‚

Work Shop Demo
--------------

MarkDown æ— æ³•ä¼ è§†é¢‘ï¼Œè¿™é‡Œæ˜¯[è§†é¢‘é“¾æ¥](https://www.jianshu.com/p/31986356b680)ã€‚  

![](http://upload-images.jianshu.io/upload_images/680728-d43303e1662d2dc4.png)

ARKit
-----

![](http://upload-images.jianshu.io/upload_images/680728-f52e6329e1973eb6.png) ARKit Logo

AR(Augment Reality) å¤§å®¶éƒ½çŸ¥é“ï¼Œå°±æ˜¯å°† 3D æ¨¡å‹æ¸²æŸ“åœ¨æ‘„åƒå¤´å›¾åƒä¹‹ä¸Šï¼Œæ··åˆæ¸²æŸ“è¾¾åˆ°è™šæ‹Ÿç‰©å“å°±å¥½åƒæ˜¯ç°å®çš„ä¸€éƒ¨åˆ†ã€‚ARKit è§£å†³äº†æ¨¡å‹å®šä½éš¾çš„é—®é¢˜ï¼Œç»“åˆ CoreMotion è¿åŠ¨æ•°æ®ä¸å›¾åƒå¤„ç†æ•°æ®ï¼Œæ¥å»ºç«‹ä¸€ä¸ªéå¸¸å‡†ç¡®çš„ SLAM ç³»ç»Ÿï¼Œæ„å»ºè™šæ‹Ÿä¸–ç•Œå’Œç°å®ä¸–ç•Œä¹‹é—´çš„æ˜ å°„ã€‚åŒæ—¶èƒ½å¤Ÿåˆ†æç¯å¢ƒè‡ªåŠ¨ç»™æ¨¡å‹æ·»åŠ å…‰æºï¼Œå®é™…æ•ˆæœè¿˜æ˜¯æ¯”è¾ƒæƒŠè‰³çš„ã€‚

ä»ç»“æ„ä¸Šçœ‹ï¼ŒARKit æä¾›äº†ä¸€å¥—ç®€å•æ˜“ç”¨çš„ AR æ¡†æ¶ï¼Œä½†æ¡†æ¶ä¹‹å¤–ï¼Œéœ€è¦å¾ˆå¤šçš„ä¸‰ç»´ç©ºé—´ã€æ¸¸æˆç¼–ç¨‹ã€3D æ¨¡å‹ã€GPU æ¸²æŸ“çš„çŸ¥è¯†æ¥ç†è§£ AR æŠ€æœ¯ã€‚ARKit æœ€é‡è¦çš„ä¸¤ä¸ªç±»æ˜¯

`ARSession`

ä¸

`ARSCNView`

![](http://upload-images.jianshu.io/upload_images/680728-d13227fb13d3069a.png) session-view

ç±»ä¼¼ä¸ AVFoudationï¼ŒARKit ä¸­ç”± ARSesseion ç±»æ¥é…ç½® SLAM ç³»ç»Ÿçš„å»ºç«‹ã€‚è®¾ç½® RSession çš„é…ç½®é€‰é¡¹ä¸º ARWorldTrackingSessionConfiguration æ¥è¿½è¸ªè®¾å¤‡çš„æ–¹å‘ä¸ä½ç½®ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ£€æµ‹å¹³é¢ã€‚è¿™ä¸ªé€‰é¡¹åªæœ‰ A9 å¤„ç†å™¨ä¹‹ä¸Šæ‰æ”¯æŒã€‚å…¶ä»–å‹å·å¤„ç†å™¨ï¼ˆ6S ä»¥ä¸‹ï¼‰åªèƒ½è¿½è¸ªè®¾å¤‡çš„æ–¹å‘ã€‚  
ARKit çš„æä¾›äº†è‡ªå¸¦çš„ä¸¤ä¸ªæ¸²æŸ“ç±»ï¼šARSCNView å’Œ ARSKViewï¼Œåè€…ç”¨æ¥æ¸²æŸ“ 2D æ¨¡å‹ã€‚ä¹‹å‰é²œæœ‰é—®æ´¥çš„ SceneKit ç®—æ˜¯æœ‰äº†ç”¨æ­¦ä¹‹åœ°ã€‚è¿™ä¸¤ä¸ªç±»ä¼šè‡ªåŠ¨å¼€å¯æ‘„åƒå¤´å¹¶å»ºç«‹è™šæ‹Ÿç©ºé—´ä¸ç°å®ç©ºé—´ä¹‹é—´çš„æ˜ å°„ã€‚åŒæ—¶ ARKit ä¹Ÿæ”¯æŒè‡ªå®šä¹‰ç”¨ OpenGL æˆ– Metal å®ç°æ¸²æŸ“ç±»ï¼Œä½†è¦è‡ªå·±ç®¡ç†ä¸ ARSession ä¹‹é—´çš„é€šä¿¡ï¼ŒåŒæ—¶è¦éµå¾ª iOS GPU å‘½ä»¤ä¸èƒ½åœ¨åå°è°ƒç”¨çš„è§„åˆ™ã€‚

å…¶ä»–æ¯”è¾ƒé‡è¦çš„ç±»æœ‰`ARAnchor`ã€`ARHitTestResult`ã€`ARFrame`ã€`ARCamera`ã€‚

*   ARAnchor

ä¸–ç•Œä¸­ç‚¹ï¼Œå¯ä»¥ç”¨æ¥æ”¾ç½®è™šæ‹Ÿç‰©å“ï¼Œä¹Ÿå¯ä»¥ä»£æŒ‡ç°å®ç‰©å“çš„æ”¾ç½®ä½ç½®ã€‚ARAnchor åœ¨ä¸–ç•Œä¸­æ˜¯å”¯ä¸€çš„ï¼Œå¹¶åŒ…å«ä»¿å°„å˜æ¢çš„ä¿¡æ¯ã€‚

*   ARHitTestResult

HitTest çš„è¿”å›ï¼Œä¸–ç•Œä¸­çš„ ARAnchorã€‚  
ä¸ UIKit ä¸­çš„ hitTest ä¸åŒï¼ŒARKit çš„ HitTest ä»¥è®¾å¤‡æ–¹å‘é…åˆè§†å›¾åæ ‡ï¼Œå»ºç«‹ä¸€æ¡ä¸–ç•Œä¸­çš„å°„çº¿ï¼Œæ‰€æœ‰åœ¨å°„ çº¿ä¸Šçš„ ARAnchor, ä¼šä»¥ç”±è¿‘åˆ°è¿œçš„æ–¹å¼è¿”å›ã€‚æ­¤å¤– SCeneKit çš„ HitTest è¿”å›è™šæ‹Ÿç‰©å“ã€‚

*   ARFrame

æ‘„åƒå¤´è§†é¢‘å¸§çš„åŒ…è£…ç±»ï¼ŒåŒ…å«ä½ç½®è¿½è¸ªä¿¡æ¯ã€ç¯å¢ƒå‚æ•°ã€è§†é¢‘å¸§ã€‚é‡ç‚¹æ˜¯å®ƒåŒ…å«äº†è‹¹æœæ£€æµ‹çš„ç‰¹å¾ç‚¹ï¼Œé€šè¿‡ rawFeaturePoints å¯ä»¥è·å–ï¼Œä¸è¿‡åªæ˜¯ç‰¹å¾çš„ä½ç½®ï¼Œå…·ä½“çš„ç‰¹å¾å‘é‡å¹¶æ²¡æœ‰å¼€æ”¾ã€‚

*   ARCamera

åœºæ™¯ä¸­çš„æ‘„åƒæœºï¼Œç”¨æ¥æ§åˆ¶æ¨¡å‹è§†å›¾å˜æ¢å’ŒæŠ•å½±å˜æ¢ã€‚åŒæ—¶æä¾› 6DOF(è‡ªç”±åº¦ä¿¡æ¯ï¼Œæ–¹å‘ + ä½ç½®) ä¸è¿½è¸ªä¿¡æ¯ã€‚

å¯¹ ARKit çš„æ€è€ƒ
-----------

ä»æ¡†æ¶æ¥å£æ¥çœ‹ï¼ŒARKit æš´éœ²å‡ºæ¥çš„èƒ½åŠ›å¹¶ä¸å¤šä¸”å°å¿ƒç¿¼ç¿¼ã€‚  
AR çš„èƒ½åŠ›ï¼Œç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼š

1.  3D æ¸²æŸ“
2.  ç©ºé—´å®šä½ä¸æ–¹å‘è¿½è¸ª
3.  åœºæ™¯ç†è§£ï¼ˆæ£€æµ‹ä¸è¯†åˆ«ï¼‰

ç›®å‰çœ‹ ARKit åªæä¾›äº† 3D æ¸²æŸ“çš„å…¥å£ï¼Œå…¶ä»–ä¸¤ä¸ªéƒ½è¢«å°è£…èµ·æ¥äº†ï¼Œæ‰€ä»¥ç›®å‰æ¥çœ‹æ¸²æŸ“æ˜¯å·®å¼‚åŒ–çš„ä¸»è¦é€”å¾„ï¼Œä½†ä¸å”¯ä¸€ã€‚ARKit workShop ä¸Šï¼Œé¢å¯¹å¤§å®¶æå‡ºçš„è‹›åˆ»é—®é¢˜ï¼Œè‹¹æœå·¥ç¨‹å¸ˆå¤§é‡æåˆ°ç‰¹å¾ç‚¹ã€‚å…¶å®è®¡ç®—æœºè§†è§‰æ˜¯å¯ä»¥åœ¨åœºæ™¯ç†è§£è¿™ä¸€å±‚é¢åšä¸€äº›è‡ªå®šä¹‰çš„ã€‚å¦‚æœè‹¹æœå¼€æ”¾æ›´å¤šçš„èƒ½åŠ›ï¼Œé‚£ AR çš„èƒ½åŠ›å®Œå…¨å¯ä»¥ä½œä¸ºä»»ä½•ä¸€ä¸ª APP çš„ç‰¹æ€§ã€‚  
æ­¤å¤–ï¼ŒARKit è¿˜å­˜åœ¨ä¸€äº›é—®é¢˜ï¼š

*   ARKit æ˜¯åŸºäºæƒ¯æ€§ - è§†è§‰æ¥åšç©ºé—´å®šä½çš„ï¼Œéœ€è¦å¹³ç¨³ç¼“æ…¢çš„ç§»åŠ¨ + è½¬å‘æ‰‹æœºï¼Œæ‰èƒ½æ„å»ºæ›´åŠ å‡†ç¡®çš„ä¸–ç•Œï¼Œè¿™å¯¹ç”¨æˆ·æ¥è¯´æ˜¯ä¸€ç§è€ƒéªŒï¼Œéœ€è¦ç§¯ææç¤ºã€‚
*   ç†è®ºä¸Š ARKit åœ¨åŒç›®æ‘„åƒå¤´ä¸Šçš„è¡¨ç°åº”è¯¥ä¼˜äºå•ç›®ï¼Œè¿™é‡Œéœ€è¦å…·ä½“æµ‹è¯•ï¼Œå¦‚ä½•æ¥å¹³è¡¡ç”¨æˆ·ä½“éªŒã€‚
*   .scn æ–‡ä»¶è¿˜æ˜¯çŸ¥è¯†ä¸€ä¸ªç®€å•çš„ 3 ç»´æ¨¡å‹ç¼–è¾‘å™¨ï¼Œæ”¯æŒçš„æ–‡ä»¶æ ¼å¼å°‘ï¼Œå¯¹æ¨¡å‹ã€å…‰ç…§çš„ç¼–è¾‘æ–¹å¼ä¸å¤ªå‹å¥½ã€‚å¯¹éª¨éª¼åŠ¨ç”»çš„æ”¯æŒè¿˜æœ‰åªåœ¨èƒ½ç”¨çš„é˜¶æ®µã€‚
*   ä¸€æ—¦åˆšå¼€å§‹æ£€æµ‹å¹³é¢å¤±è´¥ï¼Œå‡ºç°æ—¶é—´ä¹…ï¼Œé£˜é€¸çš„ç°è±¡ï¼ŒåæœŸå¾ˆéš¾å†æ­£ç¡®æ£€æµ‹ï¼Œè¦å¼ºåˆ¶é‡å¯ã€‚

ARKit æœ€ä½³å®è·µ
----------

### æ¨¡å‹ä¸éª¨éª¼åŠ¨ç”»

*   å¦‚æœæ˜¯ä½¿ç”¨. dae è½¬ .scn æ–‡ä»¶ï¼Œèµ„æºä¸­åŒ…å«éª¨éª¼åŠ¨ç”»æ—¶ï¼ŒåŠ è½½. scn æ–‡ä»¶åˆ° scene ä¸­ä¼šä¸¢å¤±åŠ¨ç”»ï¼Œéœ€è¦åœ¨åŠ è½½æ—¶æ‰‹åŠ¨æ¢å¤ä¸€ä¸‹ï¼ˆ[æ–¹æ³•](https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F41130425%2Fscenekit-load-node-with-animation-from-separate-scn-file%2F44458805%2344458805)ï¼‰ã€‚
*   è®¾è®¡éª¨éª¼åŠ¨ç”»æ˜¯ï¼Œè¦æ±‚è®¾è®¡å¸ˆæŠŠåŠ¨ç”»æ”¾åœ¨æ ¹èŠ‚ç‚¹ä¸Šï¼Œä¸è¦åˆ†æ•£åœ°æ”¾åœ¨æ¯ä¸ª bone ä¸Šï¼Œè¿™æ ·å¯ä»¥æ–¹ä¾¿åœ°è¯»å–å‡ºåŠ¨ç”»åˆ°`CAAnimation`ã€‚
*   æœ€å¥½ä¸è¦å°†å¤ªè¿œçš„å…‰ç…§åŠ è½½æ¨¡å‹æ–‡ä»¶ä¸­ï¼Œè¿™æ ·ä¼šå¯¼è‡´åŠ è½½æ–‡ä»¶åˆ°`SCNNdoe`æ—¶ï¼Œä½ çš„ node çœŸå®å°ºå¯¸ç‰¹åˆ«å¤§ï¼Œè€Œä½ æœŸæœ›çš„å°ºå¯¸å¯èƒ½åªæ˜¯æ¨¡å‹å¯¹è±¡çš„å¤§å°ã€‚
*   æ¨¡å‹çš„`SCNMaterial` æ˜¯ç”¨ physically based lighting model ä¼šæœ‰æ›´å¥½çš„è¡¨ç°ï¼Œè®¾ç½®æ¯”è¾ƒå¥½çš„ç¯å¢ƒå…‰ä¹Ÿæ¯”è¾ƒé‡è¦ã€‚

### å…‰ç…§

*   åˆç†çš„é˜´å½±ä¼šå¤§å¤§æé«˜ AR çš„æ•ˆæœï¼Œè´´ä¸€å¼ çº¹ç†å½“ç„¶å¯ä»¥ï¼Œä½†åŠ¨æ€é˜´å½±æ›´è®©äººæ²‰æµ¸ï¼Œæˆ‘ä»¬è¿˜æ˜¯è¦æœ‰è¿½æ±‚çš„ã€‚
*   ä½¿ç”¨ Bake ambient occlusionï¼ˆABOï¼‰æ•ˆæœï¼Œæ¨¡å‹ä¼šæ›´é€¼çœŸã€‚
*   å…‰ç…§ node åŠ è½½åˆ° `SCNScene`çš„`rootNode`ä¸Šï¼Œè¿™å¯¹åšç¢°æ’æ£€æµ‹å°¤å…¶é‡è¦

ARKit workShop
--------------

æ±‡æ€»äº†ä¸€ä¸‹ workShop ä¸Šï¼Œæ¯”è¾ƒæ„Ÿå…´è¶£çš„é—®é¢˜å’Œè‹¹æœå·¥ç¨‹å¸ˆçš„å›ç­”ï¼Œæºæ‚è‡ªå·±çš„ç†è§£ã€‚

1 . ARFrame æä¾›çš„ YUV ç‰¹å¾ï¼Œå¦‚ä½•è·å– RGB ç‰¹å¾ï¼Ÿ

ç­”ï¼šä½¿ç”¨ Metal å»è·å–ç‰¹å¾ç‚¹çš„ RGB å€¼ã€‚  
ï¼ˆè¿™ä¸ªæˆ‘ä¸€èˆ¬æ˜¯ç”¨ OpenGL çš„ shader å»åšï¼Œæˆ‘æƒ³è‹¹æœå·¥ç¨‹å¸ˆæ˜¯è¯´å°†å›¾åƒç”¨ Metal è½¬æˆä½å›¾åï¼Œæ ¹æ®åæ ‡å»è·å– RGB å€¼ã€‚ä½†ç‰¹å¾ç‚¹ä¸å¤šçš„è¯ï¼Œç›´æ¥åœ¨ CPU ä¸­åˆ©ç”¨å…¬å¼è®¡ç®—ä¸€ä¸‹ä¸å°±è¡Œäº†å—ï¼Ÿä¸è¿‡ä¹Ÿè®¸ Metal æœ‰æ›´å¼ºå¤§çš„æ–¹æ³•ã€‚ï¼‰

2 . ARKit ä¸­æ€ä¹ˆåšè™šæ‹Ÿç¯å¢ƒï¼Ÿ

ç­”ï¼šåˆ©ç”¨ Cube èƒŒæ™¯ã€‚  
ï¼ˆè¿™ä¸ªåœ¨ VR ä¸­ç”¨çš„æ¯”è¾ƒå¤šï¼Œå°±æ˜¯ç”¨ä¸€ä¸ªè´´æ»¡èƒŒæ™¯çš„ç«‹æ–¹ä½“åŒ…è£¹ä½æ‘„åƒæœºæ‰€åœ¨çš„ç©ºé—´ï¼Œç½‘ä¸Šçš„èµ„æ–™è¾ƒå¤šã€‚ï¼‰

3 . ARKit çš„å¦‚ä½•æ¨¡æ‹Ÿå…‰æºçš„ï¼Ÿä¸ºä»€ä¹ˆä¸äº§ç”Ÿé˜´å½±ã€‚

ç­”ï¼šARKit é€šè¿‡å›¾åƒçš„ç¯å¢ƒæ¥è®¾ç½®æ¨¡å‹çš„ç¯å¢ƒå…‰å¼ºåº¦ï¼Œè€Œç¯å¢ƒå…‰æ˜¯ä¸äº§ç”Ÿé˜´å½±çš„ã€‚  
ï¼ˆæˆ‘çŒœè‹¹æœåº”è¯¥æ˜¯é€šè¿‡åƒç´ å€¼æ¥ç¡®å®šç¯å¢ƒå…‰çš„ï¼Œå¦‚æœç”¨é«˜çº§ä¸€ç‚¹çš„æ–¹æ³•å®Œå…¨å¯ä»¥æ·»åŠ ç›´å°„å…‰ã€‚å…‰ç…§æœ‰è®¸å¤šæ¨¡å‹ï¼Œåªæœ‰å¸¦æ–¹å‘çš„å…‰æ‰ä¼šäº§ç”Ÿé˜´å½±ï¼Œå¦‚æœæƒ³ç”¨ ARKit åšå‡ºé˜´å½±ï¼Œå¯ä»¥çœ‹[æˆ‘çš„å›ç­”](https://links.jianshu.com/go?to=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F30975695%2Fscenekit-is-it-possible-to-cast-an-shadow-on-an-transparent-object%2F44774424%2344774424)ã€‚ï¼‰

4 . AVFoudation ä¸ ARSession ä¹‹é—´çš„åˆ‡æ¢ä¼šæœ‰é—®é¢˜å—ï¼Ÿ

ç­”ï¼š `ARSession`åº•å±‚ä¹Ÿæ˜¯ç”¨`AVFoudation`çš„ï¼Œå¦‚æœé‡æ–°æ‰“å¼€ ARKitï¼Œåªéœ€è¦é‡æ–° run ä¸€ä¸‹ `ARSession` å¯ä»¥äº†ï¼Œä½†åˆ‡æ¢æ—¶ä¼šæœ‰å¡é¡¿ã€‚  
ï¼ˆæˆ‘è‡ªå·±è¯•äº†ä¸€ä¸‹ï¼Œåˆ‡æ¢æ—¶ç¡®å®æœ‰è½»å¾®çš„å¡é¡¿ï¼Œåˆ‡æ¢å ARSession å°±åœæ­¢æ‘„åƒå¤´é‡‡é›†äº†ï¼Œä½† 3D æ¸²æŸ“ä¼šç»§ç»­ï¼Œåªæ˜¯ä¸§å¤±äº†ç©ºé—´å®šä½ä¸æ£€æµ‹è¯†åˆ«çš„èƒ½åŠ›ã€‚ï¼‰

5 . ARKit æ˜¯å¦æ”¯æŒå‰ç½®æ‘„åƒå¤´ï¼Ÿ

ç­”ï¼šä¸æ”¯æŒã€‚ARKit å¹¶ä¸æ˜¯ä¸€ä¸ªç”¨äºå‰ç½®æ‘„åƒå¤´ç¯å¢ƒçš„æŠ€æœ¯ï¼Œå› ä¸ºç©ºé—´æœ‰é™ï¼Œèƒ½æä¾›çš„ä¿¡æ¯ä¹Ÿéå¸¸æœ‰é™ã€‚  
ï¼ˆè¿™ä¸ªé—®é¢˜æ˜¯å¾ˆå¤šå‚ä¼šè€…å…³å¿ƒçš„é—®é¢˜ï¼Œä½† ARKit å›¢é˜Ÿä¼¼ä¹ä¸æ˜¯å¾ˆ care ï¼Œè¯´åˆ°åº•è¿˜æ˜¯å› ä¸ºå‰ç½®æ‘„åƒå¤´çš„åœºæ™¯ä¸­ï¼Œç”¨æˆ·å¾ˆå°‘ä¼šç§»åŠ¨ï¼Œç”»é¢ä¸­ä¸€èˆ¬å¤§éƒ¨åˆ†éƒ½æ˜¯äººè„¸ï¼Œè¿™æ · ARKit çš„å®šä½ä¸æ£€æµ‹èƒ½åŠ›æ— æ³•å¾ˆå¥½ä½¿ç”¨ã€‚å»ºè®®ç”±ç±»ä¼¼éœ€æ±‚çš„åŒå­¦å¥½å¥½æ¢³ç†ï¼Œæ˜¯ä¸æ˜¯æƒ³è¦çš„æ˜¯ 3D æ¸²æŸ“è€Œä¸æ˜¯ ARã€‚

6 . ARKit çš„æœ€å¤§åº”ç”¨èŒƒå›´æ˜¯å¤šå°‘ï¼Ÿ

ç­”ï¼š100 ç±³æ˜¯ ARKit åœ¨ä¿æŒè¾ƒå¥½ç”¨æˆ·ä½“éªŒçš„æœ€å¤§æµ‹é‡è·ç¦»ã€‚  
ï¼ˆè¿™ä¸ªå…¶å®æˆ‘æœ‰ç‚¹æ²¡å¤ªå¬æ¸…ï¼Œå®é™…æ•°å­—åº”è¯¥æ˜¯ 100 ç±³ä»¥ä¸Šï¼‰

7 . ARKit å¦‚ä½•åš markerï¼Ÿ

ç­”ï¼šARKit ä¸ä¼šæä¾›è¿™æ ·çš„èƒ½åŠ›ï¼Œå¦‚æœæƒ³å®ç°çš„ï¼Œå¯ä»¥ç”¨ ARKit æä¾›çš„ç‰¹å¾ç‚¹æ¥è·‘è‡ªå·±çš„è®¡ç®—æœºè§†è§‰ã€‚  
ï¼ˆç†Ÿæ‚‰è®¡ç®—æœºè§†è§‰çš„åŒå­¦åº”è¯¥éƒ½æ˜ç™½ï¼Œå…¶å® marker å°±æ˜¯ä¸€ç§ç®€å•çš„å›¾åƒè¯†åˆ«ï¼Œå¦‚æœ ARKit æä¾›çš„ç‰¹å¾ç‚¹å¯é çš„è¯ï¼Œå®Œå…¨å¯ä»¥è‡ªå·±åšç‰¹å¾åŒ¹é…ã€‚ç°åœºé—®äº†è‹¹æœå·¥ç¨‹å¸ˆï¼Œä»–ä»¬çš„ç‰¹å¾ç‚¹æ˜¯ä»€ä¹ˆç‰¹å¾ï¼Œä»–ä»¬ä¸æ„¿å›ç­”ï¼Œä¸è¿‡çœ‹ä½¿ç”¨åœºæ™¯çš„è¯ï¼Œåº”è¯¥æ˜¯ä¸€ç§è¾¹ç¼˜æ•æ„Ÿçš„ä½ç»´ç‰¹å¾ï¼Œåº”è¯¥ç±»ä¼¼ PCA + SURFï¼‰ã€‚

8 . ARKit åˆé€‚æ”¯æŒ A8ï¼Ÿæ€§èƒ½å¦‚ä½•ï¼Ÿ

ç­”ï¼šæ”¯æŒ A8 å¤„ç†å™¨å¹¶ä¸åœ¨è®¡åˆ’ä¸­ï¼ˆè¿™é‡ŒæŒ‡çš„æ˜¯ç©ºé—´å®šä½èƒ½åŠ›ï¼ŒA8 åªæ”¯æŒç©ºé—´æ–¹å‘è¿½è¸ªï¼‰ï¼ŒARKit çš„å¤§éƒ¨åˆ†è®¡ç®—éƒ½æ˜¯åœ¨ CPU ä¸Šå¤„ç†çš„ï¼Œåœ¨ A8 å¤„ç†å™¨ä¸Šçš„æ€§èƒ½æŸè€—åœ¨ 15% ~ 25%, åœ¨ A9 å¤„ç†å™¨ä¸Šçš„æ€§èƒ½æŸè€—åœ¨ 10% ~ 15%ã€‚  
ï¼ˆçœ‹ä»–ä»¬çš„æ„æ€ï¼Œå¤§é‡çš„è®¡ç®—ï¼Œåœ¨ A8 ä¸Šåº”è¯¥æ˜¯æ¯”è¾ƒä½æ•ˆçš„ï¼Œè§£é‡Šäº†ä¸ºä»€ä¹ˆ A8 ä¸Šçš„è¿½è¸ªèƒ½åŠ›æ˜¯é˜‰å‰²ç‰ˆçš„ã€‚æ€§èƒ½åº”è¯¥è¯´è¿˜ä¸é”™ï¼Œä¸æ¸¸æˆç±»ä¼¼ï¼‰

9 . å¦‚ä½•è¿½è¸ªå®é™…çš„ç‰©ä½“ï¼Ÿ

ç­”ï¼šå¯ä»¥åœ¨å·²è¯†åˆ«çš„ç‰©ä½“ä½ç½®ä¸Šï¼Œæ·»åŠ ä¸€ä¸ª node, è¿™æ ·å°±èƒ½åœ¨ä¹‹åçš„å¤„ç†ä¸­ä¸€ç›´ä¿æŒè¿™ä¸ªç‰©ä½“çš„è¿½è¸ªã€‚  
ï¼ˆè¿™æ¬¡çš„ wrokShopï¼Œè‹¹æœå¤§é‡æåˆ°ä»–ä»¬çš„ç‰¹å¾ç‚¹ï¼Œå¦‚æœä»–ä»¬çœŸçš„è¶³å¤Ÿé‡è§†çš„è¯ï¼Œåº”è¯¥å¼€æ”¾ç‰¹å¾æ£€æµ‹çš„è¿‡ç¨‹ä¸ç‰¹å¾å‘é‡ï¼Œå¸Œæœ›åæœŸèƒ½å¤Ÿå¼€æ”¾å§ï¼‰

10 . å¦‚ä½•è¿æ¥ä¸¤ä¸ªä¸åŒ ARKit ä¸–ç•Œï¼Ÿ

ç­”ï¼šARKit æ²¡æœ‰è®¡åˆ’æ”¯æŒè¿™äº›ï¼Œæ¯”è¾ƒ tricky çš„åšæ³•æ˜¯å°†ä¸¤ä¸ªæ‰‹æœºç´§æŒ¨ç€å¯åŠ¨ ARKitã€‚  
ï¼ˆè¿™ä¸ªä¹Ÿæ˜¯å¾ˆå¤šå‚ä¼šè€…å…³æ³¨çš„é—®é¢˜ï¼Œç›¸ä¿¡ä¸å°‘äººå·²ç»æœ‰äº†è‡ªå·±çš„è§£å†³æ–¹æ¡ˆï¼Œè¿™é‡Œæˆ‘åæœŸä¼šå‡ºä¸€ç¯‡æ–‡ç« è®²è§£ã€‚ï¼‰

AR ç›¸å…³
-----

### æ¸²æŸ“

AR è¯´åˆ°åº•è¿˜æ˜¯ä¸€ç§æ¸¸æˆæŠ€æœ¯ï¼ŒAR æä¾›äº†å®šä½ã€æ£€æµ‹å¹³é¢çš„åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¹¶æ²¡æœ‰æš´éœ²å‡ºæ¥ä¾›æˆ‘ä»¬è‡ªå®šä¹‰ï¼Œé‚£ä¹ˆåªèƒ½åœ¨æ¸²æŸ“æ–¹é¢åšå‡ºå·®å¼‚ã€‚  
ç›®å‰ ARKit æ”¯æŒçš„ 3D æ¸²æŸ“å¼•æ“ï¼Œæœ‰ sceneKitï¼ŒUnity3Dï¼ŒUEã€‚åä¸¤è€…éƒ½æ˜¯æˆç†Ÿçš„æ¸¸æˆå¼•æ“ï¼Œèƒ½å¤Ÿæä¾›å®Œæ•´çš„æ¸¸æˆåŠŸèƒ½ï¼Œä½†æ²¡æœ‰æˆ‘ä»¬æ²¡æœ‰ä½¿ç”¨ï¼Œä¸»è¦å› ä¸ºï¼š

1.  ä¸Šæ‰‹è¾ƒæ…¢ï¼ŒiOS11 9 æœˆä¸­æ—¬å°±è¦å‘å¸ƒäº†ï¼Œæ—¶é—´ç´§ä¿ƒã€‚
2.  æ¥å…¥ Unity3D ä¼šç»™å®‰è£…åŒ…é€ æˆå¾ˆå¤§å‹åŠ›ï¼Œæˆæœ¬å¤§çº¦ 10Mã€‚

æœ€ç»ˆå†³å®šè¿˜æ˜¯ç”¨ sceneKitï¼Œä¸»è¦å‡ºäºä¸€ä¸‹è€ƒè™‘ï¼š

1.  ARKit ç›®å‰å¯¹ Unity3Dï¼ŒUE çš„æ”¯æŒæ²¡æœ‰ sceneKit å¥½ã€‚
2.  sceneKit ç”¨ OC å†™ï¼Œå¯ä»¥ OCSã€‚
3.  sceneKit æ˜¯ç³»ç»ŸåŠ¨æ€åº“ï¼Œå¯¹å®‰è£…åŒ…å‹åŠ›ä¸å¤§ã€‚
4.  sceneKit è™½ç„¶èƒ½åŠ›å¼±ï¼Œä½†æ˜¯å¯¹äº AR æ¥è¯´è¶³å¤Ÿäº†ï¼ŒAR æ¯•ç«Ÿæ‰“é€ ä¸äº†å¤æ‚çš„æ¸¸æˆã€‚

### åæ ‡ç³»

ARKit å’Œ OpenGL ä¸€æ ·ï¼Œä½¿ç”¨å³æ‰‹åæ ‡ç³», è¿™ä¸ªæ–°å»ºä¸€ä¸ª camera å°±å¯ä»¥çœ‹å‡ºæ¥ã€‚

![](http://upload-images.jianshu.io/upload_images/680728-92da8e81f4b7b4fc.png) camera -w500

### å®šä½

å°†æ¨¡å‹åŠ è½½åˆ°ç©ºé—´ä¸­ï¼Œéœ€è¦ 6 ä¸ªè‡ªç”±åº¦ï¼ˆ6DOFï¼‰çš„ä¿¡æ¯æ¥æŒ‡å®šæ¨¡å‹çš„è¡¨ç°ï¼š

![](http://upload-images.jianshu.io/upload_images/680728-01fbef58ed8e5395.png) 6DOF

åˆ†åˆ«æ˜¯æ²¿ä¸‰ä¸ªåæ ‡è½´çš„å¹³ç§»ä¸æ—‹è½¬ã€‚  
å¯ä»¥ä½¿ç”¨æ—‹è½¬çŸ©é˜µã€æ¬§æ‹‰è§’ã€å››å…ƒæ•°æ¥å®šä¹‰ç©ºé—´æ—‹è½¬ï¼ŒARKit çš„è¿™ä¸‰ç§æ–¹å¼å‡æœ‰è¿ç”¨ã€‚

*   æ—‹è½¬çŸ©é˜µ

è¿™ä¸ªå¥½ç†è§£ï¼Œä½¿ç”¨æ—‹è½¬çš„å˜æ¢çŸ©é˜µå³å¯ï¼Œç»´åº¦ 4*4ï¼Œå®šä¹‰ä¸€æ¬¡æ—‹è½¬éœ€è¦ 16 ä¸ªæ•°ã€‚

*   æ¬§æ‹‰è§’

æŠŠç©ºé—´æ—‹è½¬åˆ†è§£æˆç»•ä¸‰ä¸ªå±€éƒ¨åæ ‡è½´çš„å¹³é¢æ—‹è½¬ï¼Œåˆ†åˆ«æ˜¯ pitch(ä¿¯ä»°è§’ï¼Œç»• x è½´)ï¼Œyawï¼ˆåèˆªè§’ï¼Œç»• y è½´ï¼‰ï¼Œrollï¼ˆç¿»æ»šè§’ï¼Œç»• z è½´ï¼‰ï¼Œç„¶åä»¥ä¸€å®šé¡ºåºåšæ—‹è½¬ï¼ˆsceneKit ä¸­æ˜¯ roll -> yew -> pitchï¼‰ï¼Œæ¬§æ‹‰è§’æ˜¯ä½¿ç”¨ä¸‰ä¸ª 3*3 çŸ©é˜µè¿ä¹˜å®ç°ï¼Œè€Œä¸”å­˜åœ¨ä¸‡å‘é”çš„é—®é¢˜ã€‚

![](http://upload-images.jianshu.io/upload_images/680728-d2d49cbc5a550e39.png) rotation matirx

å½“ pitch ä¸º 90Â° æ—¶ï¼Œpitch ä¸ yew çš„æ—‹è½¬è½´é‡åˆäº†ï¼Œè¿™æ—¶é£æœºä¸§å¤±äº†ä¸€ä¸ªæ—‹è½¬çš„ç»´åº¦ã€‚

![](http://upload-images.jianshu.io/upload_images/680728-3d5ad27cb380cee8.png) eulars1 angle

![](http://upload-images.jianshu.io/upload_images/680728-865233b8ade6054f.png) eulars2 angle

*   å››å…ƒæ•°

å°†ä¸‰ç»´ç©ºé—´çš„æ—‹è½¬è¡¨ç¤ºæˆå››ç»´ç©ºé—´çš„è¶…çƒé¢ä¸Šä½ç§», æ¦‚å¿µæœ‰ç‚¹å¤æ‚ã€‚ç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬åªéœ€è¦æ—‹è½¬è½´ ![](https://math.jianshu.com/math?formula=%5Coverrightarrow%7Bu%7D%3D%20(x%2C%20y%2C%20z)) ï¼Œå’Œè§’åº¦ ğ›‰ æ¥æ„é€ ä¸€ä¸ªå•ä½å››å…ƒæ•° q:  

![](http://upload-images.jianshu.io/upload_images/680728-83bf8cc74dbef051.png) quaternion

é‚£ä¹ˆæ—‹è½¬å¯ä»¥å®šä½ä¸ºï¼š  

![](http://upload-images.jianshu.io/upload_images/680728-36b67b1d9bc6d8eb.png) quaternion result

å¯¹ä»»ä½•éœ€è¦æ—‹è½¬çš„ç‚¹ , å°†å®ƒæ‰©å±•æˆä¸€ä¸ªçº¯å››å…ƒæ•° , ä»£å…¥ä¸Šé¢çš„å…¬å¼ï¼Œå°±å¯ä»¥å¾—åˆ°æ—‹è½¬åçš„ç‚¹ã€‚

### è¿½è¸ª

visual-inertial odometry : åŸºäºè§†è§‰å’Œæƒ¯æ€§çš„æµ‹é‡æ–¹æ³•ï¼Œæƒ¯æ€§æ•°æ®æ˜¯æŒ‡è§’é€Ÿåº¦å’ŒåŠ é€Ÿåº¦ï¼Œè¿™äº›éƒ½ç”±`Core Motion`æä¾›ï¼ŒåŠ ä¸Šå›¾åƒç‰¹å¾ï¼Œèƒ½å¤Ÿæ›´å‡†ç¡®åœ°å»ºç«‹ SLAM ç³»ç»Ÿã€‚ARKit ä¼šå°†æå–åˆ°çš„ç‰¹å¾ç‚¹æ˜ å°„çš„ç©ºé—´ä¸­ï¼Œä¹Ÿå°±æ˜¯è¯´ç‰¹å¾ç‚¹æ˜¯ç”±ä¸‰ç»´åæ ‡çš„ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨ç‰¹å¾ç‚¹æ¥ç¡®å®šå›¾åƒä¸­ç‰©ä½“çš„è¿œè¿‘ã€‚å®æµ‹æ•ˆæœä¸é”™ï¼Œè¯¯å·®åœ¨åˆ†ç±³ä»¥å†…ã€‚