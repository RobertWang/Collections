> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s/hEKnYu3pSZTQ_RwJ3Q6q1g)

• 与用户相关的服务 • 与视频发布相关的服务 • 与点赞和评论相关的服务 • 推荐服务

与用户相关的服务
========

• **注册：** 用户将在应用程序中注册。• **登录：** 它将对凭证进行身份验证，并向应用程序发送响应。• **登出：** 用户将从应用程序中注销。• **关注：** 如果用户想要关注或取消关注其他用户，则可以通过此服务完成。

为了存储与用户相关的数据，我们将使用基于 SQL 的数据库，如 **MYSQL** 或 **PostgreSQL**，因为与用户相关的数据（例如追踪关注者）将会是关联数据，所以这是一个适当的选择。

为了优化数据库性能，我们将使用主从架构。主数据库用于执行写操作，从数据库用于执行读操作。要了解有关此内容的更多信息，可以阅读文章**如何优化数据库性能并扩展它？[3]**

![](https://mmbiz.qpic.cn/sz_mmbiz_png/b8r1Kxg2cLLLAjzafK2xvW59C5861H4jjfBuCGz9ZAXqIibGpiaIZ2feLpmr9gVN7XpTC3N4GsTwV7GMMBgVKsXQ/640?wx_fmt=png) 

与视频发布相关的服务
==========

这是一个包含与视频发布相关服务的服务，如下所示：

为了存储与帖子相关的数据，我们将使用基于 NoSQL 的数据库，如 **MongoDB**。对于每个用户，可能会有成千上万的帖子，这将导致大量数据。

为了实现最佳性能，扩展数据库可能会很困难。NoSQL 数据库支持水平分片，这有助于我们在不影响性能的情况下扩展数据库。要了解有关数据库分片的更多信息，可以阅读文章**关于数据库分片的一切 | 扩展数据库 [4]**。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/b8r1Kxg2cLLLAjzafK2xvW59C5861H4jTTxYxCU5diaXUZ4Ok9ibVZqvXDsxTUMIzeSgvloEx5gzT7SPOlWMWFUg/640?wx_fmt=png) 

现在让我们讨论视频服务的流程。应用程序将发出 API 调用，API Gateway 将管理这些 API。它将为视频服务路由请求。

请求将通过负载均衡器进行，负载均衡器下将有多个视频服务实例。根据负载，它将决定哪个实例将处理请求。一旦请求被处理，负载均衡器将将响应发送回 API 网关，然后再发送回应用程序。

### 如何使文件在全球范围内可访问而不增加下载时间？

### 我们能进一步优化以减少下载时间吗？

还有一个挑战需要解决，即原始视频的大小可能较大，因此如果将大文件发送回客户端，则下载时间会更长，这会影响用户体验。

文件一旦上传到云存储，您可以在数据库中存储文件路径。然后将帖子 / 视频详细信息发送到**消息队列系统**，如 **Kafka** 或 **RabbitMQ**。

云存储中提取文件并进行处理。处理完成后，这些新的视频文件将发送到 **CDN**。

### 如何访问压缩的视频文件？

视频发布 API 只会返回文件名，而要访问文件，应用程序将在 URL 本身中添加分辨率细节，例如 **/media//**。

当访问此 URL 时，它将经过 API 网关，并从 URL 中提取分辨率和文件名详细信息。然后它将在缓存系统（Redis）**中检查，如果文件不可用，则将访问 CDN** 并通过它获取文件。然后将其添加到缓存中，以便如果再次请求相同文件，则不必从 **CDN** 获取。

点赞和评论相关的服务
==========

这是一个包含与视频点赞和评论相关服务的服务。正如名称所示，通过此服务，我们可以为特定帖子更新点赞和评论。与上面讨论的其他流程相同。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/b8r1Kxg2cLLLAjzafK2xvW59C5861H4j3ia60bg1JHib2P1TAzXRmD5ak1mEPTCuoQaMEKGPjgwGGsWOvicoM425A/640?wx_fmt=png) 

推荐服务
====

通过此服务，基于用户偏好推荐一系列帖子。幕后有很多其他事情正在进行。让我们看看幕后运行的流程。

![](https://mmbiz.qpic.cn/sz_mmbiz_png/b8r1Kxg2cLLLAjzafK2xvW59C5861H4jRSf2DeoF91WZntKkQJACBKmkwjzl7PVehWMEicSok2P9VjOj0zS3vfw/640?wx_fmt=png) 

然后，创建一个帖子后，它将被发送到**消息队列系统**，然后消费者将提取数据并将数据更新到**大数据（Hadoop）**中。

将为机器学习服务（如 **PyTorch** 和 **Tensorflow**）设置单独的服务器，在这里它将从大数据中提取数据并训练模型。推荐服务将使用此 AI 模型为给定用户推荐帖子。

结论
==