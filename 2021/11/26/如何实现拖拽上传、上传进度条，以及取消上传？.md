> æœ¬æ–‡ç”± [ç®€æ‚¦ SimpRead](http://ksria.com/simpread/) è½¬ç ï¼Œ åŸæ–‡åœ°å€ [juejin.cn](https://juejin.cn/post/7024657484409208863)*   dragover - è¢«æ‹–åŠ¨çš„å¯¹è±¡è¿›å…¥ç›®æ ‡å®¹å™¨æ—¶è§¦å‘
*   dragleave - è¢«æ‹–åŠ¨çš„å¯¹è±¡ç¦»å¼€ç›®æ ‡å®¹å™¨æ—¶è§¦å‘
*   drop - è¢«æ‹–åŠ¨çš„å¯¹è±¡è¿›å…¥ç›®æ ‡å®¹å™¨ï¼Œé‡Šæ”¾é¼ æ ‡é”®æ—¶è§¦å‘

äº†è§£äº†è¿™å‡ ä¸ªäº‹ä»¶ï¼Œå†å®ç°æ‹–æ‹½ä¸Šä¼ å°±ç›¸å½“å®¹æ˜“äº†ã€‚å…ˆä¸Šæ•ˆæœå›¾ï¼š

#### æ•ˆæœå±•ç¤º

![](https://p6-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d785f86b41a040969984bde1e67ed22f~tplv-k3u1fbpfcp-watermark.awebp?) ![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/316b9e4d1c4a454f93b902a23fa99555~tplv-k3u1fbpfcp-watermark.awebp?) å½“è¢«æ‹–åŠ¨çš„å¯¹è±¡è¿›å…¥ç›®æ ‡å®¹å™¨æ—¶ï¼Œå®¹å™¨è¾¹æ¡†å˜çº¢ã€‚å½“æ‹–å‡ºç›®æ ‡å®¹å™¨ï¼Œæˆ–è€…é‡Šæ”¾é¼ æ ‡é”®æ—¶ï¼Œå®¹å™¨è¾¹æ¡†ç½®ç°ã€‚å½“é‡Šæ”¾é¼ æ ‡é”®æ—¶ï¼Œè·å–æ‹–åŠ¨å¯¹è±¡çš„æ–‡ä»¶ä¿¡æ¯ã€‚

#### ä»£ç å®ç°

```
<template>
  <div ref="drag" class="drag">
    <div class="drag-icon-box">
      <!-- é‡‡ç”¨çš„æ˜¯ element-ui çš„å›¾æ ‡ -->
      <i class="el-icon-upload"></i> 
    </div>
    <div class="drag-message">
      <span class="drag-message-title">å°†æ–‡ä»¶æ‹–åŠ¨åˆ°æ­¤å¤„ï¼Œæˆ–</span>
      <label for="file" class="drag-message-label">
        <input
          class="drag-message-input"
          type="file"
          id="file"
          
          @change="handleFileChange"
        />
        <span class="drag-message-manual">ç‚¹å‡»ä¸Šä¼ </span>
      </label>
    </div>
  </div>
</template>

<script>
export default {
  data() {
    return {
      file: null
    }
  },
  async mounted() {
    // ç»™å®¹å™¨ç»‘å®šç›¸å…³çš„æ‹–æ‹½äº‹ä»¶
    this.bindEvents()
  },
  methods: {
    bindEvents() {
      const drag = this.$refs.drag
      // è¢«æ‹–åŠ¨çš„å¯¹è±¡è¿›å…¥ç›®æ ‡å®¹å™¨
      drag.addEventListener('dragover', e => {
        e.preventDefault()
        drag.style.borderColor = 'red'
      })
      // è¢«æ‹–åŠ¨çš„å¯¹è±¡ç¦»å¼€ç›®æ ‡å®¹å™¨
      drag.addEventListener('dragleave', e => {
        e.preventDefault()
        drag.style.borderColor = '#eee'
      })
      // è¢«æ‹–åŠ¨çš„å¯¹è±¡è¿›å…¥ç›®æ ‡å®¹å™¨ï¼Œé‡Šæ”¾é¼ æ ‡é”®
      drag.addEventListener('drop', e => {
        e.preventDefault()
        drag.style.borderColor = '#eee'
        const fileList = e.dataTransfer.files
        this.file = fileList[0]
        this.uploadFile()
      })
    },
    async uploadFile() {
      const form = new FormData()
      form.append('name', 'file')
      form.append('file', this.file)
      const res = await axios.post('/upload', form)
    },
    handleFileChange(e) {
      const file = e.target.files[0]
      if (!file) return
      this.file = file
      this.uploadFile()
    }
  }
}
</script>

<style lang="scss" scoped>
.drag {
  width: 660px;
  height: 300px;
  border: 2px dashed;
  border-color: #a3a3a3;
  border-radius: 5px;
  margin: 0 auto;
  display: flex;
  flex-direction: column;
  justify-content: center;
  align-items: center;
  flex-wrap: wrap;
  .drag-icon-box {
    width: 100%;
    height: 60px;
    text-align: center;
    font-size: 50px;
    line-height: 60px;
    color: #606266;
  }
  .drag-message {
    width: 100%;
    height: 50px;
    line-height: 50px;
    text-align: center;
    .drag-message-title {
      font-size: 14px;
      color: #606266;
    }
    .drag-message-label {
      width: 120px;
      height: 50px;
      height: auto;
      position: relative;
      overflow: hidden;
      .drag-message-input {
        position: absolute;
        left: -100px;
        top: -100px;
        z-index: -1;
        display: none;
      }
      .drag-message-manual {
        font-size: 14px;
        color: #4b87ff;
        cursor: pointer;
      }
    }
  }
}
</style>
å¤åˆ¶ä»£ç 
```

### ä¸Šä¼ è¿›åº¦æ¡

è¿›åº¦æ¡å¯ä»¥è¯´æ˜¯æœ€æ™®éçš„ä¸€ç§éœ€æ±‚ï¼Œç‰¹åˆ«æ˜¯å¤§æ–‡ä»¶ä¸Šä¼ çš„æ—¶å€™ã€‚å®ç°æ–¹æ³•ä¹Ÿæ¯”è¾ƒç®€å•ï¼Œåˆ©ç”¨ axios çš„ `onUploadProgress` æ–¹æ³•å°±å¯ä»¥äº†ã€‚

#### æ•ˆæœå±•ç¤º

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/800719aa93c342afb7c09905ec336242~tplv-k3u1fbpfcp-watermark.awebp?)

#### ä»£ç å®ç°

```
<div>
  <!-- é‡‡ç”¨çš„æ˜¯ element-ui çš„è¿›åº¦æ¡ç»„ä»¶ -->
  <el-progress
    :stroke-width="20"
    :text-inside="true"
    :percentage="uploadProgress"
  ></el-progress>
</div>

<script>
export default {
  data() {
    return {
      file: null,
      uploadProgress: 0
    }
  },
  methods: {
    async uploadFile() {
      const form = new FormData()
      form.append('name', 'file')
      form.append('file', this.file)
      const res = await axios.post('/uploadfile', form, {
        onUploadProgress: progress => {
          this.uploadProgress = Number(
            ((progress.loaded / progress.total) * 100).toFixed(2)
          )
        }
      })
    },
    handleFileChange(e) {
      const file = e.target.files[0]
      if (!file) return
      this.file = file
      this.uploadFile()
    }
  }
}
</script>
å¤åˆ¶ä»£ç 
```

### å–æ¶ˆä¸Šä¼ 

å½“ä¸Šä¼ å¾ˆæ…¢ç­‰çš„æ‰æ€¥æ—¶ï¼Œæˆ–è€…æ‰‹ä¸€æŠ–ï¼Œä¸Šä¼ äº†ä¸€ä¸ªä¸è¯¥ä¸Šä¼ çš„è§†é¢‘ï¼ˆä½ æ‡‚çš„ï¼‰ï¼Œåœ¨ä¸Šä¼ æœªå®Œæˆçš„æƒ…å†µä¸‹ï¼Œèƒ½å¦è¿›è¡Œå–æ¶ˆå‘¢ï¼Ÿç­”æ¡ˆå½“ç„¶æ˜¯å¯ä»¥çš„ã€‚

#### æ•ˆæœå±•ç¤º

![](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/37458090086a4e8b88ab2f22d9dc1653~tplv-k3u1fbpfcp-watermark.awebp?) å…¶å®å–æ¶ˆä¸Šä¼ å°±æ˜¯å–æ¶ˆ _ajax_ è¯·æ±‚ï¼Œå¯ä»¥åˆ©ç”¨ _axios_ çš„ `cancel token` è¿›è¡Œå–æ¶ˆã€‚

æ–¹æ³•ä¸€ï¼šä½¿ç”¨ `CancelToken.source` å·¥å‚æ–¹æ³•åˆ›å»º `cancel token`

```
const CancelToken = axios.CancelToken;
const source = CancelToken.source();

axios.post('/upload', form, {
  cancelToken: source.token
})

source.cancel();
å¤åˆ¶ä»£ç 
```

æ–¹æ³•äºŒï¼šé€šè¿‡ä¼ é€’ä¸€ä¸ª executor å‡½æ•°åˆ°Â `CancelToken`Â çš„æ„é€ å‡½æ•°æ¥åˆ›å»º `cancel token`

```
const CancelToken = axios.CancelToken;
let cancel;

axios.post('/upload', form, {
  cancelToken: new CancelToken(function executor(c) {
    cancel = c;
  })
});

cancel();
å¤åˆ¶ä»£ç 
```

æœ‰å…´è¶£çš„åŒå­¦å¯ä»¥è¯•ä¸€è¯•ï¼Œå°†ä»¥ä¸Šæ–¹æ³•èå…¥åˆ°è‡ªå·±çš„é¡¹ç›®ä¸­ã€‚

### æ€»ç»“

okï¼Œä»¥ä¸Šå°±æ˜¯ä¸Šä¼ éœ€æ±‚ä¸­æœ€å¸¸è§çš„ä¸€äº›åœºæ™¯ï¼Œæ— è®ºæ˜¯æ‹–æ‹½ä¸Šä¼ è¿˜æ˜¯ç²˜è´´ä¸Šä¼ ï¼Œæœ€ä¸»è¦çš„æ˜¯é€šè¿‡ç›¸åº”çš„äº‹ä»¶æ‹¿åˆ°æ–‡ä»¶ä¿¡æ¯ã€‚è€Œè¿›åº¦æ¡å’Œå–æ¶ˆä¸Šä¼ åˆ™æ˜¯åˆ©ç”¨ _axios_ çš„ _api_ è¿›è¡Œå®ç°ï¼Œ_axios_ è¿˜æœ‰ä¼—å¤šå®ç”¨çš„é…ç½®é€‰é¡¹ï¼Œå¤§å®¶å¯ä»¥è‡ªå·±ç ”ç©¶ä¸€å“ˆã€‚

æ¬¢è¿åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œæ˜é‡‘å®˜æ–¹å°†åœ¨[æ˜åŠ›æ˜Ÿè®¡åˆ’](https://juejin.cn/post/7012210233804079141 "https://juejin.cn/post/7012210233804079141")æ´»åŠ¨ç»“æŸåï¼Œåœ¨è¯„è®ºåŒºæŠ½é€ 100 ä»½æ˜é‡‘å‘¨è¾¹ã€‚å¦‚æœæ–‡ç« å¯¹ä½ æœ‰æ‰€å¸®åŠ©ï¼Œä¸è¦å¿˜äº†ç‚¹ä¸ªèµå‘¦~

å¬è¯´å–œæ¬¢ç‚¹èµçš„äººè¿æ°”éƒ½ä¸å·®ï¼Œç›¸ä¿¡ä»Šå¹´çš„ä½ ä¸€å®šé€¢è€ƒå¿…è¿‡ï¼Œé€¢å¥–å¿…ä¸­ğŸ˜˜