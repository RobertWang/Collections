> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s?__biz=MjM5ODYxMDA5OQ==&mid=2651968287&idx=1&sn=9579823d656b4a0fa9be789d20762207&chksm=bd2d66c38a5aefd507cdf3876796584dab8b4e1c864fca6d779dc46a6968a22a0f3cb7fb6820&mpshare=1&scene=1&srcid=0714IY8xlRqrQfI6D4cJanp1&sharer_sharetime=1626229057951&sharer_shareid=7fece245937ac96f04f0fb8e1311fff1#rd)

（1）今日投放**地域**是 “北京 - 上地”；

（3）定向**人群**为 “女”，“30 岁以下”；

**（5）竞价**设置的是 0.2 元；

这些数据，当然通过业务端存储到了数据层，即数据库和缓存里。

用户产生了平台浏览行为，网站除了展示自然内容，还要展示广告内容。被展现的广告不能太离谱，太离谱用户也不会点击。

合适的广告，必须符合 “**语义相关性**”，即**基础检索**属性（广告属性）必须符合（**广告能否满足用户的需求**，满足了点击率才高），这个工作是通过 BS-basic search 检索服务完成的。

步骤三：用户属性与广告主属性匹配，广告精筛实施。

（1）用户**性别**为 “女”；

（3）用户**访问 IP** 是 “北京”；

经过步骤 2 和步骤 3 的初筛和精筛之后，待选的 N 条广告既能满足用户当前的需求，用户亦能满足广告主的筛选需求，但实际情况是，广告位只有 3 个，怎么办呢？就需要我们对 N 条广告进行综合打分排序（**满足平台的需求**，广告平台要多赚钱嘛）。

有人说按照竞价排序 bid，出价高的打分高（这是大家对竞价排名最大的误解，竞价是按照 CPC 收费）。

出价高，但没人点击，广告平台没有收益；点击率高，但出价低，广告平台还是没有收益。**最终应该按照广告的出价与 CTR 的乘积作为综合打分排序的依据，bid*CTR**。

无论如何，N 条广告，根据 bid * 预估 CTR 进行综合打分排序后，返回了打分最高的 3 个广告（广告位只有 3 个）。

步骤五：展现端展示了广告，用户点击了广告。

这些日志（一般会实施 AB 测），也是算法效果好坏评估的重要依据，根据效果逐步优化改进算法。

用户既然点击了广告，平台就要对投放广告的广告主进行**扣费**了，扣费前当然要经过反作弊系统的过滤（主要是恶意点击），扣费后信息会实时反映到数据层，费用扣光后，广告就要从数据层下线。

![](https://mmbiz.qpic.cn/mmbiz/YrezxckhYOyibgqU1ghRj2UnSXyd7EBK4bIicxicMjVBg0YxmkiaNdbdkkBBhj1H3TUxgdONG4QOYYHwFXAnrsc4HQ/640)

从系统分层架构上看，智能广告系统分为三层：

**（2）服务层**：为了实现智能广告的业务逻辑，提供的通用服务，此处又主要分为**四大类服务**：

- 检索服务 AS：语义相关性检索；

- 反作弊服务：不是每次点击都扣费，要经过反作弊，去除恶意点击（相对独立，未在架构图中画出）；

**总结**

（1）**广告主投放与设置广告；**

 - 通过**广告属性**，进行 “语义相关性” 初筛，通过 BS 完成；

（3）**记录展现日志，点击日志，进行扣费；**

（1）广告满足用户需求（初筛）；

（3）平台利益最大化（bid*CTR 综合排序）；

**广告的排序**不是由出价 (bid) 决定的，而是由出价 (bid)* 点击率(ctr) 决定的。

希望这一分钟没有浪费。

近期文章：