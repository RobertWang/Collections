> 本文由 [简悦 SimpRead](http://ksria.com/simpread/) 转码， 原文地址 [mp.weixin.qq.com](https://mp.weixin.qq.com/s?src=11×tamp=1623119154&ver=3117&signature=Kk7GTYjSvDNh7eiZW6p7Ze7hYsauqwKRlkYJqSz68NW5-IttwrYKtlqikKc6vnB1Wtv6bgYotOb-Ejh2UeHXEkNDPED45YhLLU1Mafpm27YGH6i6R0YrgsoQsGVP3KTY&new=1)

_转自：https://www.cnblogs.com/aaronax/p/5703842.html_

_作者：几木人_

Iperf 是一个网络性能测试工具。Iperf 可以测试 TCP 和 UDP 带宽质量。Iperf 可以测量最大 TCP 带宽，具有多种参数和 UDP 特性。

Iperf 可以报告带宽，延时抖动和数据包丢失。利用 Iperf 这一特性，可以用来测试一些网络设备如路由器，防火墙，交换机等的性能。

Iperf 还有一个图形界面程序叫做 Jperf ，使用 Jperf 程序简化了复杂命令行参数的构造，而且它还保存测试结果，同时实时图形化显示结果。

当然，Jperf 可以测试 TCP 和 UDP 带宽质量。Jperf 可以测量最大 TCP 带宽，具有多种参数和 UDP 特性。Jperf 可以报告带宽，延迟抖动和数据包丢失。

Linux 环境下，可以提高测试准确性。

**Iperf 功能介绍：**

1）TCP

*   测量网络带宽
    
*   报告 MSS/MTU 值的大小和观测值
    
*   支持 TCP 窗口值通过套接字缓冲
    
*   当 P 线程或 Win32 线程可用时，支持多线程。客户端与服务端支持同时多重连接
    

2）UDP

*   客户端可以创建指定带宽的 UDP 流
    
*   测量丢包
    
*   测量延迟
    
*   支持多播
    
*   当 P 线程可用时，支持多线程。客户端与服务端支持同时多重连接（不支持 Windows）
    
*   在适当的地方，选项中可以使用 K 和 M，使输出更友好
    
*   可以指定运行的总时间，甚至可以设置传输的数据总量
    
*   服务器支持多重连接，而不是等待一个单线程测试
    
*   在指定时间间隔重复显示网络带宽，波动和丢包情况
    
*   服务器端可作为 Windows 服务运行
    
*   使用典型数据流来测试链接层压缩对于可用带宽的影响
    
*   支持传送指定文件，可以定性和定量测试
    

**Iperf 使用方法：**

**1. 安装 Iperf**

*   Windows 版，直接将解压出来的 iperf.exe 和 cygwin1.dll 复制到 %systemroot% 目录即可。
    
*   Linux 版，请使用如下命令安装：
    

> gunzip  -c iperf-<version>.tar.gz | tar -xvf     这一步是解压，根据具体情况可以灵活处理，
> 
> cd  iperf 目录
> 
> ./configure;　　make && make install;

2. 使用

*   参数介绍
    

　　-f, --format  格式化带宽输出，就是使用标准的，K 还是 M.

　　-i,--interval  设置每次报告之间的时间间隔，单位为秒。

　　-l,--len　　　设置读写缓冲区的长度。TCP 方式默认为 8KB，UDP 方式默认为 1470 字节。

　　-m，--print_mss 输出 TCP MSS 值（通过 TCP_MAXSEG 支持）。MSS 值一般比 MTU 值小 40 字节。

　　-p, --port 　设置端口，与服务器端的监听端口一直，默认是 5001 端口，与 ttcp 的一样

　　-u,  --udp　使用 UDP 方式而不是 TCP 方式。参看 -b 选项

　　-w,　--window　设置套接字缓冲区为指定大小。对于 TCP 方式，此设置为 TCP 窗口大小。对于 UDP 方式，此设置为接收 UDP 数据包的缓冲区大小，限制可以接收数据包的最大值。

　　-B， --bind host　绑定到主机的多个地址中的一个。对于客户端来说，这个参数设置了出栈接口。对于服务器端来说，这个参数设置入栈接口。这个参数只用于具有多网络接口的主机。在 Iperf 的 UDP 模式下，此参数用于绑定和加入一个多播组。使用范围 224.0.0.0 至 239.255.255.255 的多播地址。

　　-C， --compatibility　与低版本的 Iperf 使用时，可以使用兼容模式。不需要两端同时使用兼容模式，但是强烈推荐两端同时使用兼容模式。某些情况下，使用某些数据流可以引起 1.7 版本的服务器端崩溃或引起非预期的连接尝试。

　　-M， --mss　通过 TCP_MAXSEG 选项尝试设置 TCP 最大信息段的值。MSS 值的大小通常是 TCP/IP 头减去 40 字节。在以太网中，MSS 值为 1460 字节（MTU1500 字节）。

　　-N,　--nodelay　设置 TCP 无延迟选项，禁用 Nagle's 运算法则。通常情况此选项对于交互程序，例如 telnet， 是禁用的。

　　-V　　绑定一个 IPv6 地址   
(服务器端：$ iperf -s -V　　客户端： $ iperf -c <Server IPv6  Address> -V)

· 服务器端专用选项

　　-s, --server　　Iperf 服务器模式

　　-D，　　unix 平台下 Iperf 作为后台守护进程运行

　　-R　　卸载 Iperf

　　-o　　重定向输出到指定文件

　　-c, --client host  如果 Iperf 运行在服务器模式，并且用 -c 参数指定一个主机，那么 Iperf 将只接受指定主机的连接。此参数不能工作于 UDP 模式。　　

　　-P， --parallel   服务器关闭之前保持的连接数。默认是 0，这意味着永远接受连接

· 客户端专用选项

　　-b,  --bandwidth　　UDP 模式使用的带宽，单位 bits/sec 。此选项与 - u 选项相关，默认值是 1 Mbit/sec

　　-c,  --clietn host　运行 Iperf 的客户端模式，连接到指定的 Iperf 服务器端。

　　-d,  --dualtest  运行双测试模式。这将使服务器端反向连接到客户端，使用 - L 参数中指定的端口（或默认使用客户端连接到服务器端的端口）。这些在操作的同时就立即完成了。如果你想要一个交互的测试，请尝试 - r 参数。

　　-n，--num　传送的缓冲器数量。通常情况，Iperf 按照 10 秒钟发送数据。-n 参数跨越此限制，按照指定次数发送指定长度的数据，而不论该操作耗费多少时间。

　　-r,  --tradeoff　往复测试模式。当客户端到服务器端的测试结束时，服务器端通过 -l 选项指定的端口（或默认为客户端连接到服务器的端口），反向连接至客户端。当客户端连接终止时，反向连接随即开始。如果需要同时进行双向测试，请尝试 - d 参数。

　　-t,  --time　设置传输的总时间。Iperf 在指定的时间内，重复的发送指定长度的数据包。默认是 10 秒钟。参数 -l 与 -n 选项。

　　-L， --listenport 指定服务器端反向连接到客户端时使用的端口。默认使用客户端连接至服务端的端口。

　　-P， --parallel　线程数，指定客户端与服务端之间使用的线程数。默认是 1 线程。需要客户端与服务器端同时使用此参数。

　　-S，　--tos　　出栈数据包的服务类型。许多路由器忽略 TOS 字段。你可以指定这个值，使用以 “0x” 开始的 16 进制数，或以 “0” 开始的 8 进制数或 10 进制数。

　　-T， --ttl　出栈多播数据包的 TTL 值。这本质上就是数据通过路由器的跳数。默认是 1，连接本地。

　　-F　使用特定的数据流测量带宽，例如指定的文件。$ iperf -c <server address> -F <filename>

　　-I  与 - F 一样，由标准输入输出文件输入数据

**实例：**

*   在服务端运行 iperf 
    

　　　　命令　　iperf -s  -p 12345 -i  1  -m 

　　　　以在本机端口 12345 上启用 iperf

*   在客户端运行 iperf，输入命令 iperf -c server-ip -p server-port -i 1 -t 10 -w 20K,
    

　　　　-c：客户端模式，后接服务器 ip

　　　　-p: 后接服务器监听的端口

　　　　-i: 设置带宽报告的时间间隔，单位为秒

　　　　-t: 设置测试的时长，单位为秒

　　　　-w: 设置 tcp 窗口的大小，一般默认。

Interval 表示时间间隔，Transfer 表示时间间隔里面传输的数据量。Bandwidth 是时间间隔里的传输速率。最后一行是本次测试的统计。并可以看出平均带宽大小。

1. 测试多线程 TCP

在客户端添加 -P 参数即可测试多线程的 TCP 性能，如下为使用两个线程的测试情况。

　　iperf -c  192.168.1.1 -p12345 -i 1 -t 3  -P 2

　　iperf -s  -p12345 -m -i 1

2. 测试单线程 UDP（默认带宽）

*   在服务端运行 iperf ， 输入命令 iperf -s -u -p12345 -i 1 以本机端口 12345 上启用 iperf，并运行于 UDP 模式；
    
*   在客户端运行 iperf， 输入命令 iperf -c server-ip  -p  server-port -i 1  -t 10 -b, 其中参数说明如下：
    

　　-c: 客户端模式，后接服务器 IP

　　-p: 后接服务器监听的端口

　　-i: 设置宽带报告的时间间隔，单位为秒

　　-t: 设置测试的时长，单位为秒

　　-b: 设置 udp 的发送带宽，单位 bit/s

其中，jitter 为抖动，lost/total 为丢包数量，Datagrams 为包数量。

1. 测试单线程 UDP（带宽为 10Mbit/s）

设置客户端带宽为 10M 即可，使用参数 - b 指定。

2. 测试 UDP 的双向传输

客户端使用参数 - d 以运行双测试模式，客户端会与服务端进行 udp 往返测试。可以使用 - L 参数指定本端双测试监听的端口。

命令： iperf -c 192.168.1.1 -p12345 -i 1 -t 3 -u -b 10m -d -l 30000

3. 测试 UDP 往复传输

与双向传输类似，使用参数 -r 以运行交互模式，仍然可以使用 -L 参数指定交互的端口

iperf -c 192.168.1.1 -p12345 -i 1 -t 5 -u -b 10M -r -L 30000

4. 分布式测试

使用多台电脑或使用一台电脑的多个 IP 地址测试。当使用一台电脑的多个 ip 地址测试时，可以使用 - B 命令绑定网卡的某一个 ip 地址以测试。

**Jperf 2.0 简介**

Jperf 是将 Iperf 命令行图形化的 JAVA 程序；

使用 Jperf 程序能简化了复杂命令行参数的构造，而且它还保存测试结果，同时实时图形化显示结果。Jperf 可以测试 TCP 和 UDP 带宽质量。Jperf 可以测量最大 TCP 带宽，具有多种参数和 UDP 特定。Jperf 可以报告带宽，延迟抖动和数据包丢失。

运行环境：需安装 JREjxpiinstall.exe
